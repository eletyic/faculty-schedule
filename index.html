<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Faculty Schedule System</title>

<!-- Include SheetJS library for Excel processing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Include html2canvas and jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ========== SEVEN-THEME SYSTEM ========== */
/* Theme CSS Variables - Applied to entire application */
:root {
    /* Default Navy Theme */
    --theme-primary: #052976;
    --theme-secondary: #1a4d9e;
    --theme-accent: #20CE76;
    --theme-dark: #031b4d;
    --theme-light: #e8eef7;
    --theme-primary-bg: rgba(5, 41, 118, 0.03);
    --theme-teaching-bg: #e3ebf7;
    --theme-oh-bg: #E8F5E9;
    --theme-oh-border: #4CAF50;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #3A1FFF;
}

/* 1. NAVY THEME (Default RCJY) */
[data-theme="navy"], body:not([data-theme]) {
    --theme-primary: #052976;
    --theme-secondary: #1a4d9e;
    --theme-accent: #20CE76;
    --theme-dark: #031b4d;
    --theme-light: #e8eef7;
    --theme-primary-bg: rgba(5, 41, 118, 0.03);
    --theme-teaching-bg: #e3ebf7;
    --theme-oh-bg: #E8F5E9;
    --theme-oh-border: #4CAF50;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #3A1FFF;
}

/* 2. CYAN THEME */
[data-theme="cyan"] {
    --theme-primary: #0097A7;
    --theme-secondary: #00ACC1;
    --theme-accent: #FF6F00;
    --theme-dark: #006064;
    --theme-light: #E0F7FA;
    --theme-primary-bg: rgba(0, 151, 167, 0.03);
    --theme-teaching-bg: #E0F7FA;
    --theme-oh-bg: #FFF8E1;
    --theme-oh-border: #FFA000;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #00838F;
}

/* 3. GREEN THEME */
[data-theme="green"] {
    --theme-primary: #2E7D32;
    --theme-secondary: #43A047;
    --theme-accent: #1976D2;
    --theme-dark: #1B5E20;
    --theme-light: #E8F5E9;
    --theme-primary-bg: rgba(46, 125, 50, 0.03);
    --theme-teaching-bg: #E8F5E9;
    --theme-oh-bg: #E3F2FD;
    --theme-oh-border: #1976D2;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #388E3C;
}

/* 4. BLUE THEME */
[data-theme="blue"] {
    --theme-primary: #1565C0;
    --theme-secondary: #1976D2;
    --theme-accent: #FF6F00;
    --theme-dark: #0D47A1;
    --theme-light: #E3F2FD;
    --theme-primary-bg: rgba(21, 101, 192, 0.03);
    --theme-teaching-bg: #E3F2FD;
    --theme-oh-bg: #FFF3E0;
    --theme-oh-border: #F57C00;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #1E88E5;
}

/* 5. PURPLE THEME */
[data-theme="purple"] {
    --theme-primary: #6A1B9A;
    --theme-secondary: #7B1FA2;
    --theme-accent: #00C853;
    --theme-dark: #4A148C;
    --theme-light: #F3E5F5;
    --theme-primary-bg: rgba(106, 27, 154, 0.03);
    --theme-teaching-bg: #F3E5F5;
    --theme-oh-bg: #E8F5E9;
    --theme-oh-border: #388E3C;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #8E24AA;
}

/* 6. GOLD THEME */
[data-theme="gold"] {
    --theme-primary: #BF8C00;
    --theme-secondary: #D4A017;
    --theme-accent: #3949AB;
    --theme-dark: #8B6914;
    --theme-light: #FFF8E1;
    --theme-primary-bg: rgba(191, 140, 0, 0.03);
    --theme-teaching-bg: #FFF8E1;
    --theme-oh-bg: #E8EAF6;
    --theme-oh-border: #3949AB;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #F9A825;
}

/* 7. CREAM/CLASSIC THEME */
[data-theme="cream"] {
    --theme-primary: #5D4037;
    --theme-secondary: #6D4C41;
    --theme-accent: #558B2F;
    --theme-dark: #3E2723;
    --theme-light: #EFEBE9;
    --theme-primary-bg: rgba(93, 64, 55, 0.03);
    --theme-teaching-bg: #EFEBE9;
    --theme-oh-bg: #F1F8E9;
    --theme-oh-border: #558B2F;
    --theme-text-on-primary: #ffffff;
    --theme-modal-accent: #795548;
}

/* Theme Selector Panel */
.theme-selector-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 251, 255, 0.98));
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 16px;
    padding: 15px;
    box-shadow: 0 16px 64px rgba(5, 41, 118, 0.2), 0 4px 16px rgba(0, 0, 0, 0.1);
    z-index: 9998;
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.theme-selector-panel.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
}

.theme-selector-title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 12px;
    color: var(--theme-primary);
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--theme-light);
}

.theme-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
}

.theme-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border: 2px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
    font-weight: 500;
    font-size: 12px;
    font-family: inherit;
}

.theme-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.theme-btn.active {
    border-color: var(--theme-primary);
    background: var(--theme-light);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.theme-color-preview {
    width: 20px;
    height: 20px;
    border-radius: 5px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    flex-shrink: 0;
}

/* Hide theme panel during print/PDF export */
@media print {
    .theme-selector-panel {
        display: none !important;
    }
}

/* Themed header titles */
.header-title {
    color: var(--theme-primary) !important;
}

/* Office Hours section header */
.oh-section-header {
    color: var(--theme-accent);
}

/* Themed type selector in multiple schedules */
.themed-type-select {
    color: var(--theme-primary) !important;
}

/* ========== ANIMATIONS ========== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideOutRight {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

/* ========== iOS-STYLE BUTTONS ========== */
.ios-button {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 16px;
    background: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    position: relative;
}

.ios-button:hover {
    transform: translateY(-2px);
}

.ios-button:active {
    transform: translateY(0) scale(0.95);
}

.ios-button-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15),
                0 1px 3px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.ios-button:hover .ios-button-icon {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2),
                0 2px 6px rgba(0, 0, 0, 0.12);
    transform: scale(1.05);
}

.ios-button-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%);
    border-radius: inherit;
}

.ios-button-label {
    font-size: 12px;
    font-weight: 500;
    color: #333;
    letter-spacing: 0.2px;
}

/* ========== FLOATING DROPDOWN MENU (CRYSTAL STYLE) ========== */
.floating-menu-container {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 9999;
}

.floating-menu-button {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.95));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 16px;
    padding: 12px 24px;
    font-size: 15px;
    font-weight: 600;
    color: var(--theme-primary);
    cursor: pointer;
    box-shadow: 0 8px 32px rgba(5, 41, 118, 0.15),
                0 2px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 10px;
    letter-spacing: 0.5px;
}

.floating-menu-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 48px rgba(5, 41, 118, 0.25),
                0 4px 12px rgba(0, 0, 0, 0.15);
    background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(240, 248, 255, 1));
}

.floating-menu-button:active {
    transform: translateY(0) scale(0.98);
}

.floating-menu-icon {
    font-size: 18px;
    transition: transform 0.3s ease;
}

.floating-menu-container.active .floating-menu-icon {
    transform: rotate(180deg);
}

.floating-menu-dropdown {
    position: absolute;
    top: 60px;
    left: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 251, 255, 0.98));
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: 16px;
    padding: 8px;
    min-width: 220px;
    box-shadow: 0 16px 64px rgba(5, 41, 118, 0.2),
                0 4px 16px rgba(0, 0, 0, 0.1);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.floating-menu-container.active .floating-menu-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
}

.floating-menu-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
}

.floating-menu-item:hover {
    background: linear-gradient(135deg, rgba(5, 41, 118, 0.08), rgba(33, 150, 243, 0.08));
    transform: translateX(4px);
}

.floating-menu-item:active {
    transform: translateX(2px) scale(0.98);
}

.floating-menu-item-icon {
    font-size: 20px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(240, 248, 255, 0.6));
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.floating-menu-divider {
    height: 1px;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(5, 41, 118, 0.1) 20%, 
        rgba(5, 41, 118, 0.1) 80%, 
        transparent);
    margin: 6px 0;
}

/* Hide menu when printing/exporting */
@media print {
    /* Hide floating menu and all interactive elements */
    .floating-menu-container {
        display: none !important;
    }
    
    /* Hide the faculty edit pen button specifically - AGGRESSIVE HIDING */
    #toggleFacultyBtn {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        width: 0 !important;
        height: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        border: none !important;
        position: absolute !important;
        left: -9999px !important;
    }
    
    /* Hide all buttons */
    button {
        display: none !important;
    }
    
    /* Hide merged cell action buttons */
    .merged-cell-edit,
    .merged-cell-delete,
    .merged-cell-unmerge,
    .merged-cell-actions {
        display: none !important;
    }
    
    /* Hide all cancel/delete buttons */
    .btn-cancel,
    .simple-cancel {
        display: none !important;
    }
    
    /* Hide merge toolbar */
    #mergeToolbar {
        display: none !important;
    }
    
    /* Hide checkboxes */
    input[type="checkbox"] {
        display: none !important;
    }
    
    /* Keep borders on faculty/course inputs for print - MUST come first */
    input.course-code-input,
    input.course-name-input,
    input.faculty-input-keep,
    select.faculty-input-keep {
        border: 1px solid #999 !important;
        background: white !important;
        border-radius: 4px !important;
    }
    
    /* Hide all input fields - but keep borders on faculty inputs */
    input[type="text"]:not(.faculty-input-keep):not(.course-name-input):not(.course-code-input),
    input[type="number"]:not(.faculty-input-keep),
    select:not(.faculty-input-keep),
    textarea {
        border: none !important;
        background: transparent !important;
        pointer-events: none !important;
    }
    
    /* Hide type selectors */
    .type-selector {
        display: none !important;
    }
    
    /* Hide session length selectors */
    .session-length-selector {
        display: none !important;
    }
    
    /* Hide teaching fields controls */
    .teaching-fields button,
    .teaching-header button {
        display: none !important;
    }
    
    /* Hide all edit icons/pens */
    .edit-icon,
    .delete-icon,
    [class*="icon"],
    [class*="pen"] {
        display: none !important;
    }
    
    /* Ensure merged teaching cancel buttons are hidden */
    .merged-teaching .btn-cancel {
        display: none !important;
    }
    
    /* Hide any hover elements */
    *:hover {
        cursor: default !important;
    }
}

.pdf-export-mode .floating-menu-container {
    display: none !important;
}

/* Additional PDF export mode rules */
.pdf-export-mode #toggleFacultyBtn {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    width: 0 !important;
    height: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    position: absolute !important;
    left: -9999px !important;
}

.pdf-export-mode .container {
    box-sizing: border-box !important;
    width: 100% !important;
    max-width: 100% !important;
    padding: 1rem !important;
    margin: 0 auto !important;
    border: 1px solid white !important;
    border-left-width: 4px !important;
    border-right-width: 4px !important;
    border-radius: 12px !important;
    overflow: hidden !important;
}

.pdf-export-mode .header,
.pdf-export-mode .department-info,
.pdf-export-mode .faculty-info,
.pdf-export-mode .schedule-table-wrapper,
.pdf-export-mode .legend,
.pdf-export-mode .summary,
.pdf-export-mode .footer {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    margin-bottom: 0.75rem !important;
    border: 1px solid var(--theme-primary) !important;
    border-left-width: 4px !important;
    border-right-width: 4px !important;
    border-radius: 12px !important;
}

.pdf-export-mode .legend {
    border-color: var(--theme-accent) !important;
}
    border: none !important;
    overflow: hidden !important;
}

.pdf-export-mode .schedule-table-wrapper {
    padding: 0 !important;
}

.pdf-export-mode .schedule-table {
    margin: 0 !important;
    width: 100% !important;
    table-layout: fixed !important;
}

.pdf-export-mode .header::before,
.pdf-export-mode .department-info::before,
.pdf-export-mode .faculty-info::before,
.pdf-export-mode .schedule-table-wrapper::after,
.pdf-export-mode .legend::before,
.pdf-export-mode .summary::before,
.pdf-export-mode .footer::before {
    display: none !important;
}

.pdf-export-mode .summary,
.pdf-export-mode .footer,
.pdf-export-mode .header,
.pdf-export-mode .faculty-info,
.pdf-export-mode .department-info,
.pdf-export-mode .legend,
.pdf-export-mode .schedule-table-wrapper {
    
}

.pdf-export-mode button,
.pdf-export-mode .btn-cancel,
.pdf-export-mode .simple-cancel,
.pdf-export-mode input[type="checkbox"],
.pdf-export-mode .type-selector,
.pdf-export-mode .session-length-selector,
.pdf-export-mode .merged-teaching .btn-cancel {
    display: none !important;
}

/* Ensure course inputs show borders during PDF export */
.pdf-export-mode .course-row input,
.pdf-export-mode .course-code-input,
.pdf-export-mode .course-name-input,
.pdf-export-mode .faculty-info input,
.pdf-export-mode .faculty-info select,
.pdf-export-mode input.course-code-input,
.pdf-export-mode input.course-name-input {
    border: 1px solid #999 !important;
    background: white !important;
    border-radius: 4px !important;
}

/* Specifically target course inputs with high specificity */
body.pdf-export-mode .course-row input.course-code-input,
body.pdf-export-mode .course-row input.course-name-input,
body.pdf-export-mode input.faculty-input-keep {
    border: 1px solid #999 !important;
    background: white !important;
    border-radius: 4px !important;
    padding: 0.4rem !important;
}

/* iOS Button Color Variants */
.ios-button-blue .ios-button-icon {
    background: linear-gradient(135deg, #007AFF 0%, #0051D5 100%);
    color: white;
}

.ios-button-green .ios-button-icon {
    background: linear-gradient(135deg, #34C759 0%, #248A3D 100%);
    color: white;
}

.ios-button-red .ios-button-icon {
    background: linear-gradient(135deg, #FF3B30 0%, #D70015 100%);
    color: white;
}

.ios-button-orange .ios-button-icon {
    background: linear-gradient(135deg, #FF9500 0%, #FF6700 100%);
    color: white;
}

.ios-button-purple .ios-button-icon {
    background: linear-gradient(135deg, #AF52DE 0%, #8944AB 100%);
    color: white;
}

.ios-button-gray .ios-button-icon {
    background: linear-gradient(135deg, #8E8E93 0%, #636366 100%);
    color: white;
}

.ios-button-teal .ios-button-icon {
    background: linear-gradient(135deg, #5AC8FA 0%, #007AFF 100%);
    color: white;
}

/* iOS Button Container */
.ios-button-group {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    padding: 12px;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

/* ========== CELL MERGING STYLES ========== */
.merged-cell {
    position: relative;
}

.merged-cell-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100%;
    padding: 12px;
    position: relative;
}

.merged-cell-header {
    font-weight: bold;
    font-size: 1.1rem;
    color: #1565c0;
    margin-bottom: 8px;
    text-align: center;
}

.merged-cell-time {
    font-size: 0.9rem;
    color: #424242;
    background: rgba(255, 255, 255, 0.8);
    padding: 4px 12px;
    border-radius: 12px;
    margin-bottom: 8px;
}

.merged-cell-info {
    font-size: 0.85rem;
    color: #616161;
    text-align: center;
    line-height: 1.4;
}

.merged-cell-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.merged-cell:hover .merged-cell-actions {
    opacity: 1;
}

.merged-cell-btn {
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
}

.merged-cell-edit {
    background: #007AFF;
    color: white;
}

.merged-cell-delete {
    background: #FF3B30;
    color: white;
}

.merged-cell-unmerge {
    background: #8E8E93;
    color: white;
}

.merged-cell-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.merge-indicator {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #007AFF;
    color: white;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 6px;
    font-weight: bold;
}

/* Continuation cell styles */
.merged-continuation {
    opacity: 0.3;
    pointer-events: none;
    position: relative;
}

.merged-continuation::after {
    content: 'â†‘';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    color: black;
}


/* Unmerge tooltip */
.unmerge-tooltip {
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.merged-cell-unmerge:hover .unmerge-tooltip {
    opacity: 1;
}

/* ========== BATCH SELECTION MODE STYLES ========== */
.cell-selected {
    position: relative;
    z-index: 5;
}

.cell-checkbox:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* Auto-extend preview on hover */
.auto-extend-preview {
    transition: all 0.15s ease;
    cursor: pointer;
}

.auto-extend-preview-blocked {
    cursor: not-allowed;
}

/* Batch selection toolbar scrollbar */
#mergeToolbar::-webkit-scrollbar {
    width: 6px;
}

#mergeToolbar::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#mergeToolbar::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

#mergeToolbar::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Animation for completed sets */
@keyframes setComplete {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

.set-complete-animation {
    animation: setComplete 0.3s ease;
}

/* ========== NAVIGATION & LANDING PAGE STYLES ========== */
.page-container {
    display: none;
}

.page-container.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

/* Landing page background with gradient */
body {
    font-family: Calibri, Arial, sans-serif;
    padding: 0;
    margin: 0;
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 50%, var(--theme-accent) 100%);
    min-height: 100vh;
}

.landing-page {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    padding: 0;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    top: 50%;
    transform: translateY(5%);
}

/* Header section with logo and gradient */
.landing-header {
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
    padding: 3rem 2rem 2rem 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.landing-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: rgba(32, 206, 118, 0.1);
    border-radius: 50%;
}

.landing-header::after {
    content: '';
    position: absolute;
    bottom: -30%;
    left: -5%;
    width: 250px;
    height: 250px;
    background: rgba(32, 206, 118, 0.08);
    border-radius: 50%;
}

.landing-logo {
    width: 180px;
    height: auto;
    margin: 0 auto 1.5rem;
    padding: 1.5rem;
    background: white;
    border-radius: 1.25rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    position: relative;
    z-index: 1;
    transition: transform 0.3s ease;
}

.landing-logo:hover {
    animation: pulse 0.6s ease;
    transform: scale(1.1);
}

.landing-page h1 {
    color: white;
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    font-weight: bold;
    position: relative;
    z-index: 1;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.landing-subtitle {
    color: var(--theme-accent);
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
}

.landing-page p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
    margin-bottom: 0;
    position: relative;
    z-index: 1;
}

/* Main content area */
.landing-content {
    padding: 3rem 2rem;
}

.section-title {
    text-align: center;
    color: var(--theme-primary);
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 2.5rem;
    position: relative;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, var(--theme-primary), var(--theme-accent));
    border-radius: 2px;
}

.button-container {
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
    max-width: 900px;
    margin: 0 auto;
}

.option-button {
    flex: 1;
    min-width: 280px;
    max-width: 400px;
    padding: 2.5rem 2rem;
    background: white;
    border: 3px solid #e0e0e0;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: fadeIn 0.8s ease;
}

.option-button:nth-child(1) {
    animation: slideInLeft 0.8s ease;
}

.option-button:nth-child(2) {
    animation: slideInRight 0.8s ease;
}

.option-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 0;
}

.option-button:hover::before {
    opacity: 1;
}

.option-button:hover {
    border-color: var(--theme-primary);
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 40px rgba(5, 41, 118, 0.3);
}

.option-button:hover h2,
.option-button:hover p {
    color: white;
}

.option-button:hover .icon {
    transform: scale(1.1) rotateY(360deg);
}

.option-button h2 {
    color: var(--theme-primary);
    font-size: 1.8rem;
    margin-bottom: 1rem;
    font-weight: bold;
    transition: color 0.3s ease;
    position: relative;
    z-index: 1;
}

.option-button .icon {
    font-size: 5rem;
    margin-bottom: 1.5rem;
    transition: transform 0.6s ease;
    position: relative;
    z-index: 1;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
}

.option-button p {
    color: #666;
    font-size: 1rem;
    line-height: 1.6;
    transition: color 0.3s ease;
    position: relative;
    z-index: 1;
}

/* Feature badge */
.feature-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--theme-accent), #17a05f);
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: bold;
    margin-top: 1rem;
    position: relative;
    z-index: 1;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

/* Footer section */
.landing-footer {
    background: #f8f9fa;
    padding: 1.5rem;
    text-align: center;
    color: var(--theme-primary);
    font-size: 0.9rem;
    border-top: 1px solid #e0e0e0;
}

.landing-footer a {
    color: var(--theme-primary);
    text-decoration: none;
    font-weight: 600;
}

.landing-footer a:hover {
    color: var(--theme-accent);
}

/* Responsive design */
@media screen and (max-width: 768px) {
    .landing-page {
        margin: 1rem;
        border-radius: 16px;
        transform: none;
    }
    
    .landing-header {
        padding: 2rem 1rem 1.5rem 1rem;
    }
    
    .landing-page h1 {
        font-size: 1.8rem;
    }
    
    .landing-content {
        padding: 2rem 1rem;
    }
    
    .option-button {
        min-width: 100%;
    }
    
    .section-title {
        font-size: 1.3rem;
    }
}

/* ========== MULTIPLE SCHEDULE PAGE STYLES ========== */
/* User Guide Page */
.user-guide-page {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    padding: 2rem;
    min-height: 100vh;
}

.user-guide-page h1 {
    color: var(--theme-primary);
    font-size: 2rem;
    margin-bottom: 1.5rem;
    text-align: center;
    border-bottom: 3px solid var(--theme-accent);
    padding-bottom: 1rem;
}

.guide-section {
    background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--theme-primary);
    box-shadow: 0 2px 8px rgba(5, 41, 118, 0.08);
}

.guide-section h2 {
    color: var(--theme-primary);
    font-size: 1.3rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.guide-section h3 {
    color: var(--theme-secondary);
    font-size: 1.1rem;
    margin: 1rem 0 0.5rem 0;
}

.guide-section p, .guide-section li {
    color: #444;
    line-height: 1.7;
    margin-bottom: 0.5rem;
}

.guide-section ul {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
}

.guide-section ol {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
}

.guide-step {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

.guide-step-number {
    background: var(--theme-primary);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.guide-step-content {
    flex: 1;
}

.keyboard-shortcut {
    display: inline-block;
    background: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 2px 8px;
    font-family: monospace;
    font-size: 0.9rem;
    margin: 0 2px;
}

.tip-box {
    background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
    border-left: 4px solid var(--theme-accent);
    padding: 1rem;
    border-radius: 0 8px 8px 0;
    margin: 1rem 0;
}

.tip-box::before {
    content: 'ðŸ’¡ Tip: ';
    font-weight: bold;
    color: var(--theme-accent);
}

.warning-box {
    background: linear-gradient(135deg, #fff3e0 0%, #fff8e1 100%);
    border-left: 4px solid #ff9800;
    padding: 1rem;
    border-radius: 0 8px 8px 0;
    margin: 1rem 0;
}

.warning-box::before {
    content: 'âš ï¸ Note: ';
    font-weight: bold;
    color: #ff9800;
}


@media print {
    .back-button,
    .landing-page,
    .no-print,
    div.non-teaching-hours-section {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        border: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        left: -9999px !important;
    }
}

/* ========== ORIGINAL SCHEDULE STYLES (UNCHANGED) ========== */
* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: Calibri, Arial, sans-serif;
            padding: 1.25rem;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: white;
            padding: 1.875rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        @media print {
            html {
                font-size: 9px;
            }
            
            @page {
                size: A4 landscape;
                margin: 0.3cm 0.5cm;
            }
            
            .container {
                padding: 0.1rem;
                padding-top: 100px !important;
                box-shadow: none;
                max-width: 100%;
                width: 100%;
                page-break-inside: avoid;
            }
            
            body {
                padding: 0;
                background: white;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Prevent page breaks */
            .header, .faculty-info, .schedule-table, .legend, .summary, .footer {
            overflow: visible;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            table {
                page-break-inside: avoid !important;
            }
            
            /* Hide input placeholders */
            input::placeholder {
                color: transparent !important;
            }
            
            /* Hide action buttons when printing */
            #actionButtons {
                display: none !important;
            }
            
            /* Hide Add Course button and course management buttons */
            #addCourseBtn {
                display: none !important;
                visibility: hidden !important;
            }
            
            .course-row button {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Hide elements that should be hidden like when locked */
            .btn-cancel,
            .simple-cancel {
                display: none !important;
            }
            
            .type-selector:not(.selected) {
                display: none !important;
            }
            
            .department-info,
            .semester-info {
                display: none !important;
            }
            
            /* MOBILE PRINT FIX - Force proper layout */
            .faculty-info-wrapper {
                overflow: visible !important;
                border: none !important;
            }
            
            .schedule-table-wrapper {
                overflow: visible !important;
                border: none !important;
                box-shadow: none !important;
            }
            
            .schedule-table-wrapper::before {
                display: none !important;
            }
            
            .schedule-table {
                min-width: auto !important;
                width: 100% !important;
                table-layout: auto !important;
            }
            
            .schedule-table th,
            .schedule-table td {
                font-size: 0.65rem !important;
                padding: 0.12rem !important;
            }
            
            /* Reset sticky positioning for print */
            .schedule-table th.first,
            .schedule-table td.first {
                position: static !important;
                box-shadow: none !important;
            }
            
            /* Ensure table fits on one page */
            .faculty-info {
                padding: 0.3rem !important;
            }
            
            .header {
                padding: 0.3rem 0.5rem !important;
                margin-bottom: 0 !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                background: white !important;
                z-index: 1000 !important;
                height: 130px !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: flex-start !important;
            }
            
            .header > div {
                max-width: 35% !important;
            }
            
            .header h1 {
                font-size: 0.9rem !important;
            }
            
            .course-row {
                padding: 0.2rem !important;
                margin-bottom: 0.2rem !important;
            }
        }
        
        /* Mobile Responsive Styles - Optimized Table */
        @media screen and (max-width: 768px) {
            body {
                padding: 0.25rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .header {
                padding: 0.75rem 0.5rem;
                margin-bottom: 1rem;
            }
            
            .header h1 {
                font-size: 0.85rem !important;
                line-height: 1.3;
            }
            
            .header img {
                width: 100px !important;
                top: 5px !important;
                right: 5px !important;
            }
            
            /* Stack faculty info vertically */
            .faculty-info-wrapper {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
                border: 2px solid #20CC73;
                border-radius: 8px;
                margin: 1rem 0;
            }
            
            /* Add scroll hint for faculty info */
            .faculty-info-wrapper::before {
                content: 'â† Swipe to see all fields â†’';
                display: block;
                text-align: center;
                padding: 0.4rem;
                background: #20CC73;
                color: white;
                font-size: 0.7rem;
                font-weight: bold;
                position: sticky;
                left: 0;
                z-index: 10;
            }
            
            .schedule-locked .faculty-info-wrapper::before {
                display: none;
            }
            
            .faculty-info > div[style*="display: flex"] {
                min-width: 700px !important;
                flex-direction: row !important;
                gap: 1rem !important;
            }
            
            .faculty-info {
                padding: 0.75rem !important;
                overflow-x: visible !important;
            }
            
            .faculty-info input,
            .faculty-info label {
                font-size: 0.85rem !important;
            }
            
            /* Course rows - maintain structure inside scrollable parent */
            .course-row {
                min-width: auto !important;
                grid-template-columns: 150px 1fr auto !important;
                gap: 0.5rem !important;
                padding: 0.5rem;
                background: #f9f9f9;
                border-radius: 4px;
                margin-bottom: 0.5rem;
            }
            
            /* Make table wrapper scrollable with better UX */
            .schedule-table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border: 2px solid var(--theme-primary);
                border-radius: 8px;
                margin: 1rem 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            /* Add scroll hint */
            .schedule-table-wrapper::before {
                content: 'â† Swipe to see all time slots â†’';
                display: block;
                text-align: center;
                padding: 0.5rem;
                background: var(--theme-primary);
                color: white;
                font-size: 0.75rem;
                font-weight: bold;
                position: sticky;
                left: 0;
                z-index: 10;
            }
            
            .schedule-locked .schedule-table-wrapper::before {
                display: none;
            }
            
            /* Optimize table for touch */
            .schedule-table {
                min-width: 900px;
                font-size: 0.75rem !important;
                touch-action: pan-x pan-y;
            }
            
            .schedule-table th,
            .schedule-table td {
                padding: 0.4rem 0.3rem !important;
                font-size: 0.7rem !important;
                min-height: 50px;
            }
            
            /* Larger touch targets for inputs/selects in table */
            .schedule-table select,
            .schedule-table input[type="text"] {
                min-height: 36px !important;
                font-size: 0.75rem !important;
                padding: 0.3rem !important;
                touch-action: manipulation;
            }
            
            /* Larger buttons in cells */
            .schedule-table .btn-cancel,
            .schedule-table .simple-cancel {
                min-width: 32px !important;
                min-height: 32px !important;
                font-size: 1rem !important;
                padding: 0.25rem !important;
            }
            
            /* Day column sticky on mobile */
            .schedule-table th.first,
            .schedule-table td.first {
                position: sticky;
                left: 0;
                background: white;
                z-index: 5;
                box-shadow: 2px 0 4px rgba(0,0,0,0.1);
            }
            
            .schedule-table thead th.first {
                z-index: 11;
            }
            
            /* Stack action buttons vertically */
            #actionButtons > div {
                max-width: 100% !important;
            }
            
            #actionButtons > div > div {
                grid-template-columns: 1fr !important;
            }
            
            #actionButtons button {
                font-size: 0.9rem !important;
                padding: 0.75rem !important;
                height: auto !important;
            }
            
            /* Footer stack */
            .footer {
            overflow: visible;
                flex-direction: column !important;
                gap: 1rem !important;
            }
            
            .footer > div {
                width: 100% !important;
            }
            
            /* Legend and summary */
            .legend,
            .summary {
            overflow: visible;
                font-size: 0.75rem !important;
                padding: 0.75rem !important;
            }
            
            .legend-grid,
            .summary-grid {
                grid-template-columns: 1fr !important;
                gap: 0.5rem !important;
            }
            
            /* Department and semester info */
            .department-info,
            .semester-info {
                padding: 0.75rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .department-row,
            .semester-row {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            
            .semester-field {
                width: 100% !important;
                min-width: 100% !important;
            }
            
            #departmentSelect {
                min-width: 100% !important;
                width: 100% !important;
            }
            
            /* Improve modal on mobile */
            .modal-content {
                width: 95% !important;
                max-width: 95% !important;
                padding: 1rem !important;
            }
            
            .modal-field input,
            .modal-field select {
                font-size: 0.9rem !important;
                padding: 0.6rem !important;
            }
            
            /* Merge toolbar */
            .merge-toolbar {
                width: 95% !important;
                left: 2.5% !important;
                padding: 0.75rem !important;
            }
            
            .merge-toolbar button {
                font-size: 0.85rem !important;
                padding: 0.6rem 1rem !important;
            }
        }
        
        /* Extra small devices - further optimize */
        @media screen and (max-width: 480px) {
            html {
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 0.75rem !important;
            }
            
            .header img {
                width: 80px !important;
            }
            
            .schedule-table {
                min-width: 800px;
            }
            
            .schedule-table th,
            .schedule-table td {
                padding: 0.3rem 0.2rem !important;
                font-size: 0.65rem !important;
                min-height: 45px;
            }
        }
        
        /* Landscape orientation optimization */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .schedule-table-wrapper::before {
                padding: 0.25rem;
                font-size: 0.65rem;
            }
            
            .schedule-table th,
            .schedule-table td {
                min-height: 40px;
            }
        }
        
        /* Hide buttons during PDF export */
        .pdf-export-mode #addCourseBtn,
        .pdf-export-mode .course-row button {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -9999px !important;
        }
        
        .header {
            position: relative;
            text-align: center;
            margin-bottom: 1.875rem;
            padding: 1.25rem 1.5rem;
            background: var(--theme-primary-bg);
            border-radius: 12px;
        }
        
        .header::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        .header .main-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--theme-primary) !important;
            margin: 0;
        }
        
        .header .sub-title {
            display: inline-block;
            margin: 0.375rem 0 0 0;
            font-size: 0.8125rem;
            font-weight: 600;
            color: white !important;
            background: var(--theme-primary);
            padding: 0.25rem 0.625rem;
            border-radius: 4px;
        }
        
        /* Legacy support */
        .header h1.header-title {
            font-size: 1.125rem;
            font-weight: bold;
            color: var(--theme-primary) !important;
            margin: 0.3125rem 0;
        }
        
        .header .subtitle {
            color: var(--theme-primary) !important;
            font-weight: 600;
        }
        
        @media print {
            .header {
                margin-bottom: 0.3rem;
                padding: 0.5rem;
            }
            
            .header h1 {
                font-size: 1.3rem;
                margin: 0.1rem 0;
                line-height: 1.2;
            }
        }
        
        #departmentDisplay {
            color: #0066cc;
            font-size: 1.0625rem;
        }
        
        @media print {
            #departmentDisplay {
                font-size: 1.25rem;
            }
        }
        
        .department-info {
            position: relative;
            background: var(--theme-primary-bg);
            padding: 0.75rem 1.25rem;
            margin-bottom: 0.9375rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .department-info::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        @media print {
            .department-info {
                padding: 0.4rem 0.8rem;
                margin-bottom: 0.5rem;
            }
        }
        
        .department-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.9375rem;
            flex-wrap: wrap;
        }
        
        .department-row label {
            font-weight: bold;
            font-size: 0.875rem;
            color: #1F618D;
        }
        
        @media print {
            .department-row label {
                font-size: 1.1rem;
            }
        }
        
        #departmentSelect {
            padding: 0.5rem 0.9375rem;
            border: none;
            font-size: 0.875rem;
            border-radius: 5px;
            background: white;
            font-weight: bold;
            color: #1F618D;
            cursor: pointer;
            min-width: 350px;
        }
        
        @media print {
            #departmentSelect {
                font-size: 1.1rem;
                padding: 0.3rem 0.6rem;
            }
        }
        
        #departmentSelect:focus {
            outline: none;
            border-color: #2874A6;
            box-shadow: 0 0 5px rgba(88, 173, 226, 0.5);
        }
        
        .semester-info {
            background: white;
            padding: 0.9375rem;
            margin-bottom: 1.25rem;
            border-left: 4px solid var(--theme-secondary);
            border-right: 4px solid var(--theme-secondary);
            border-radius: 0;
        }
        
        @media print {
            .semester-info {
                padding: 0.5rem;
                margin-bottom: 0.6rem;
            }
        }
        
        .semester-row {
            display: flex;
            gap: 1.25rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .semester-field {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 200px;
        }
        
        .semester-field label {
            font-weight: bold;
            font-size: 0.8125rem;
            white-space: nowrap;
        }
        
        @media print {
            .semester-field label {
                font-size: 1rem;
            }
        }
        
        .semester-field select,
        .semester-field input {
            padding: 0.5rem;
            border: 1px solid #999;
            font-size: 0.8125rem;
            border-radius: 4px;
            flex: 1;
        }
        
        @media print {
            .semester-field select,
            .semester-field input {
                font-size: 1rem;
                padding: 0.3rem;
            }
        }
        
        .btn-auto-year {
            background: #2196F3;
            color: white;
            border: none;
            padding: 0.5rem 0.9375rem;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
        }
        
        @media print {
            .btn-auto-year {
                font-size: 0.9rem;
                padding: 0.3rem 0.6rem;
            }
        }
        
        .btn-auto-year:hover {
            background: #1976D2;
        }
        
        #semesterYearDisplay {
            color: #0066cc;
            font-size: 1rem;
        }
        
        @media print {
            #semesterYearDisplay {
                font-size: 1.2rem;
            }
        }
        

        .faculty-info-wrapper {
            overflow-x: visible;
        }
        
        .faculty-info {
            position: relative;
            background: var(--theme-primary-bg);
            padding: 0.9375rem;
            margin-bottom: 1.25rem;
            border-radius: 12px;
        }
        
        .faculty-info::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        @media print {
            .faculty-info {
                padding: 0.3rem;
                margin-bottom: 0.3rem;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        .info-row {
            display: flex;
            gap: 1.875rem;
            margin-bottom: 0.625rem;
            font-size: 0.875rem;
            font-weight: bold;
        }
        
        @media print {
            .info-row {
                gap: 0.6rem;
                margin-bottom: 0.2rem;
                font-size: 1.05rem;
            }
        }
        
        .info-field {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }
        
        .info-field label {
            white-space: nowrap;
        }
        
        .info-field input {
            padding: 0.4rem 0.3125rem; /* Increased padding */
            border: 1px solid #999;
            font-size: 0.875rem;
            flex: 1;
            text-transform: uppercase;
            min-height: 32px; /* Minimum height */
            line-height: 1.3; /* Better line spacing */
            box-sizing: border-box;
        }
        
        .faculty-input-keep {
            padding: 0.5rem 0.4rem; /* Increased padding */
            border: 1px solid #999;
            font-size: 0.875rem;
            text-transform: uppercase;
            min-height: 34px; /* Minimum height */
            line-height: 1.3; /* Better line spacing */
            box-sizing: border-box;
        }
        
        .info-field-vertical {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .info-field-vertical label {
            font-weight: bold;
            font-size: 0.875rem;
            color: #333;
        }
        
        .info-field-vertical input {
            padding: 0.5rem 0.4rem; /* Increased padding */
            border: 1px solid #999;
            font-size: 0.875rem;
            text-transform: uppercase;
            min-height: 34px; /* Minimum height */
            line-height: 1.3; /* Better line spacing */
            box-sizing: border-box;
        }
        
        @media print {
            .info-field input {
                font-size: 1.05rem;
                padding: 0.15rem;
            }
            
            .info-field-vertical input {
                font-size: 1.05rem;
                padding: 0.2rem;
            }
            
            .faculty-input-keep {
                font-size: 1.05rem;
                padding: 0.2rem;
            }
        }
        
        .schedule-table-wrapper {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.25rem;
        }
        
        .schedule-table-wrapper::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        .schedule-table {
            background: var(--theme-primary-bg);
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            font-size: 0.6875rem;
            table-layout: fixed;
        }
        
        /* Column Optimization Styles - When Total Hours = 40 */
        .schedule-table.columns-optimized {
            table-layout: auto;
        }
        
        .schedule-table.columns-optimized th:not(.first),
        .schedule-table.columns-optimized td:not(.first) {
            min-width: 120px;
            width: auto;
        }
        
        .schedule-table.columns-optimized .merged-teaching {
            font-size: 1.1em;
        }
        
        .schedule-table.columns-optimized .merged-teaching .cell-content > div {
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .schedule-table.columns-optimized .merged-teaching-content {
            font-size: 0.9rem;
        }
        
        @media print {
            .schedule-table.columns-optimized th:not(.first),
            .schedule-table.columns-optimized td:not(.first) {
                min-width: 100px;
            }
            
            .schedule-table.columns-optimized .merged-teaching .cell-content > div {
                font-size: 0.85rem;
            }
            
            .schedule-table.columns-optimized .merged-teaching-content {
                font-size: 0.8rem;
            }
        }
        
        .schedule-table tr {
            height: 60px;
            max-height: 60px;
        }
        
        @media print {
            .schedule-table {
                font-size: 0.9rem;
                margin-bottom: 0.3rem;
            }
            
            .schedule-table tr {
                height: 42px !important;
                max-height: 42px !important;
            }
        }
        
        .schedule-table th,
        .schedule-table td {
            border: 1px solid #333 !important;
            padding: 0.25rem;
            text-align: center;
            vertical-align: middle;
            position: relative;
        }
        
        @media print {
            .schedule-table th,
            .schedule-table td {
                border: 1px solid #333 !important;
                padding: 0.25rem;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        .schedule-table th {
            background: rgba(188, 148, 112, 0.125); /* Beige/Sand @ 50% */
            font-weight: bold;
            color: #001F3F;
            border-bottom: none !important;
        }
        
        .day-cell {
            background: rgba(5, 41, 118, 0.03) !important;
            font-weight: bold;
            font-size: 0.875rem;
            width: 60px;
            color: #001F3F;
        }
        
        @media print {
                        .day-cell {
            background: rgba(5, 41, 118, 0.03) !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            font-size: 1.15rem;
}
        }
        
        .time-header {
            background-color: rgba(5, 41, 118, 0.03)!important;
            font-weight: bold;
            font-size: 0.875rem;
            min-width: 70px;
            max-width: 70px;
            color: #001F3F;
        }
        
        @media print {
            .time-header {
                font-size: 0.85rem;
                min-width: 50px;
                max-width: 50px;
                line-height: 1.1;
            }
        }
        
        .time-header.first {
            width: 60px;
        }
        
        .schedule-cell {
            overflow: visible;

            min-height: 60px;
            height: 60px;
            background: white;
            cursor: pointer;
            position: relative;
            padding: 3px;
        }
        
        @media print {
            .schedule-cell {
                min-height: 42px;
                height: 42px;
                padding: 2px;
            }
        }
        
        .cell-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 2px;
            position: relative;
        }
        
        .cell-content.teaching-mode .type-selector {
            display: none;
        }
        
        .cell-content .teaching-fields {
            display: none;
            flex-direction: column;
            gap: 2px;
        }
        
        .cell-content.teaching-mode .teaching-fields {
            display: flex;
        }
        
        .cell-content .simple-display {
            display: none;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 0.875rem;
            font-weight: bold;
            color: #1565c0;
            position: relative;
        }
        
        @media print {
            .cell-content .simple-display {
                font-size: 1.05rem;
            }
        }
        
        .cell-content.simple-mode .type-selector {
            display: none;
        }
        
        .cell-content.simple-mode .simple-display {
            display: flex;
        }
        
        .simple-cancel {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #ff4444;
            color: white;
            border: none;
            padding: 1px 4px;
            cursor: pointer;
            font-size: 8px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .simple-cancel:hover {
            background: #cc0000;
        }
        
        .activity-display {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            position: relative;
            gap: 2px;
        }
        
        .cell-content.activity-mode .type-selector {
            display: none;
        }
        
        .cell-content.activity-mode .activity-display {
            display: flex;
        }
        
        .activity-select {
            width: 90%;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 0.6875rem;
            padding: 0.1875rem;
            background: white;
            text-transform: uppercase;
            cursor: pointer;
            font-weight: bold;
            color: #1565c0;
        }
        
        @media print {
            .activity-select {
                font-size: 1rem;
            }
        }
        
        .activity-label {
            font-size: 0.8125rem;
            font-weight: bold;
            color: #1565c0;
        }
        
        @media print {
            .activity-label {
                font-size: 1.1rem;
            }
        }
        
        .teaching-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1px 2px;
        }
        
        .teaching-label {
            display: none;
        }
        
        .session-length-selector {
            display: flex;
            gap: 2px;
            justify-content: center;
            margin-bottom: 2px;
        }
        
        .length-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 8px;
            border-radius: 2px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .length-btn:hover:not(:disabled) {
            background: #1976D2;
        }
        
        .length-btn.active {
            background: #0D47A1;
        }
        
        .length-btn:disabled {
            background: #cccccc;
            color: #888888;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .merged-teaching {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            padding: 5px;
        }
        
        .merged-teaching .cell-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 3px;
            pointer-events: none;
            width: 100%;
        }
        
        .merged-teaching .cell-content > div {
            line-height: 1.3;
            text-transform: uppercase;
        }
        
        .merged-teaching .btn-cancel {
            display: block !important;
            pointer-events: auto;
        }
        
        .schedule-locked .merged-teaching .btn-cancel {
            display: none !important;
        }
        
        .cell-merged-occupied {
            pointer-events: none;
            position: relative;
        }
        
        /* First cell: Top, Bottom, Left borders only (no right border) */
        td.cell-merged-first {
            border-top: 1px solid #333 !important;
            border-bottom: 1px solid #333 !important;
            border-left: 1px solid #333 !important;
            border-right: none !important;
        }
        
        /* Middle cells: Top and Bottom borders only (no left or right borders) */
        td.cell-merged-occupied {
            border-top: 1px solid #333 !important;
            border-bottom: 1px solid #333 !important;
            border-left: none !important;
            border-right: none !important;
        }
        
        /* Last cell: Top, Bottom, Right borders only (no left border) */
        td.cell-merged-last {
            border-top: 1px solid #333 !important;
            border-bottom: 1px solid #333 !important;
            border-left: none !important;
            border-right: 1px solid #333 !important;
        }
        
        .cell-merged-occupied::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 5;
        }
        
        .btn-cancel {
            background: #ff4444;
            color: white;
            border: none;
            padding: 1px 4px;
            cursor: pointer;
            font-size: 8px;
            border-radius: 2px;
            font-weight: bold;
        }
        
        .btn-cancel:hover {
            background: #cc0000;
        }
        
        .schedule-cell select {
            width: 100%;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 0.5625rem;
            padding: 0.25rem 0.125rem; /* Increased vertical padding */
            min-height: 22px; /* Minimum height */
            background: white;
            text-transform: uppercase;
            cursor: pointer;
            font-weight: bold;
            color: #0066cc;
            line-height: 1.2; /* Better line spacing */
            box-sizing: border-box; /* Include padding in height calculation */
        }
        
        .schedule-cell select.selected {
            color: transparent;
            background: #e8f5e9;
        }
        
        .schedule-cell select.selected option {
            color: #000;
        }
        
        .schedule-cell input {
            width: 100%;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 0.5625rem;
            padding: 0.25rem 0.125rem; /* Increased vertical padding */
            min-height: 20px; /* Minimum height to prevent overlap */
            background: white;
            text-transform: uppercase;
            line-height: 1.2; /* Better line spacing */
            box-sizing: border-box; /* Include padding in height calculation */
        }
        
        @media print {
            .schedule-cell select,
            .schedule-cell input {
                font-size: 0.8rem;
                padding: 0.1rem;
            }
        }
        
        .schedule-cell input:focus, .schedule-cell select:focus {
            outline: 2px solid #4CAF50;
            background: #ffffcc;
        }
        
        .schedule-cell input::placeholder {
            color: #999;
            font-size: 0.5rem;
        }
        
        @media print {
            .schedule-cell input::placeholder {
                font-size: 0.65rem;
            }
        }
        
        .break-cell {
            background: #e8e8e8 !important;
            font-weight: bold;
            font-size: 0.6875rem;
        }
        
        #addCourseBtn:hover {
            background: #1db564;
        }
        
        .course-row button:hover {
            background: #c0392b;
        }
        
        @media print {
            #addCourseBtn {
                display: none;
            }
            
            .course-row button {
                display: none;
            }
        }
        
        @media print {
            .break-cell {
                font-size: 1rem;
            }
        }
        
        .legend {
            position: relative;
            margin: 1.25rem 0;
            padding: 0.9375rem;
            background: white;
            border-radius: 12px;
            font-size: 0.8125rem;
        }
        
        .legend::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-accent);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        @media print {
            .legend {
                margin: 0.2rem 0;
                padding: 0.3rem;
                font-size: 0.9rem;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        .legend-row {
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        @media print {
            .legend-row {
                margin-bottom: 0.08rem;
                font-size: 0.88rem;
                line-height: 1.1;
            }
        }
        
        .summary {
            overflow: visible;
            position: relative;
            margin-top: 1.25rem;
            padding: 0.9375rem;
            background: var(--theme-primary-bg);
            border-radius: 12px;
        }
        
        .summary::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        @media print {
            .summary {
            overflow: visible;
                margin-top: 0.2rem;
                padding: 0.3rem;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: auto auto auto auto;
            gap: 0.5rem 1rem;
            align-items: center;
        }
        
        @media print {
            .summary-grid {
                gap: 0.3rem 0.8rem;
            }
        }
        
        .summary-col {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }
        
        @media print {
            .summary-col {
                gap: 0.25rem;
            }
        }
        
        .summary-row-label {
            font-size: 0.8125rem;
            font-weight: bold;
            color: #333;
        }
        
        @media print {
            .summary-row-label {
                font-size: 0.88rem;
                line-height: 1.2;
            }
        }
        
        .summary-row-value {
            font-size: 0.875rem;
            font-weight: bold;
            color: var(--theme-primary);
        }
        
        @media print {
            .summary-row-value {
                font-size: 0.95rem;
                line-height: 1.2;
            }
        }
        
        .summary-row-total {
            font-size: 0.875rem;
        }
        
        @media print {
            .summary-row-total {
                font-size: 1rem;
                padding-top: 0.3rem !important;
                margin-top: 0.3rem !important;
            }
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8125rem;
            font-weight: bold;
        }
        
        @media print {
            .summary-row {
                margin-bottom: 0.1rem;
                font-size: 1rem;
                line-height: 1.1;
            }
        }
        
        .summary-value {
            color: var(--theme-primary);
            font-size: 0.875rem;
            font-weight: bold;
        }
        
        @media print {
            .summary-value {
                font-size: 1.1rem;
            }
        }
        
        .footer {
            overflow: visible;
            position: relative;
            margin-top: 1.25rem;
            padding: 0.9375rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            background: var(--theme-primary-bg);
        }
        
        .footer::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 1px solid var(--theme-primary);
            border-left-width: 4px;
            border-right-width: 4px;
            pointer-events: none;
        }
        
        @media print {
            .footer {
            overflow: visible;
                margin-top: 0.2rem;
                padding-top: 0.2rem;
                font-size: 0.95rem;
                page-break-inside: avoid;
            }
            
            .footer > div:last-child {
                display: none;
            }
            
            .footer input {
                font-size: 1rem !important;
                padding: 0.1rem 0.3rem !important;
            }
        }
        
        .btn-clear, .btn-export, .btn-lock {
            background: #ff4444;
            color: white;
            border: none;
            padding: 0.625rem 1.25rem;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            margin-left: 0.625rem;
            font-size: 0.875rem;
        }
        
        @media print {
            .btn-clear, .btn-export, .btn-lock {
                font-size: 1rem;
            }
        }
        
        .btn-export {
            background: var(--theme-primary);
        }
        
        .btn-lock {
            background: #5FC4F5;
        }
        
        .btn-lock.locked {
            background: var(--theme-primary);
        }
        
        .btn-clear:hover {
            background: #041f5e;
        }
        
        .btn-export:hover {
            background: #6a38a8;
        }
        
        .btn-lock:hover {
            background: #4ab0e0;
        }
        
        .btn-lock.locked:hover {
            background: #041f5e;
        }
        
        .schedule-locked .btn-cancel,
        .schedule-locked .simple-cancel {
            display: none !important;
        }
        
        .schedule-locked #addCourseBtn,
        .schedule-locked .course-row button,
        
        .schedule-locked .type-selector:not(.selected) {
            display: none !important;
        }
        
        .schedule-locked .department-info,
        .schedule-locked .semester-info {
            display: none !important;
        }
        
        .cell-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #4CAF50;
            color: white;
            padding: 1px 4px;
            font-size: 0.5rem;
            border-radius: 2px;
        }
        
        @media print {
            .cell-indicator {
                font-size: 0.65rem;
            }
        }
        
        .filled-cell {
            background: #e3f2fd !important;
        }
        
        /* Merge Mode Styles */
        .merge-mode-active .schedule-cell {
            cursor: pointer;
        }
        
        .cell-checkbox {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            z-index: 50;
            display: none;
        }
        
        .merge-mode-active .cell-checkbox {
            display: block;
        }
        
        .cell-selected {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }
        
        .merged-cell {
            background: white !important;
            border: 2px solid var(--theme-modal-accent) !important;
            border-left: 6px solid var(--theme-modal-accent) !important;
            vertical-align: middle !important;
            font-weight: bold;
            position: relative;
            height: 60px !important;
            max-height: 60px !important;
            min-height: 60px !important;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(58, 31, 255, 0.15);
        }
        
        .merged-cell-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2px;
            height: 100%;
            padding: 3px;
            text-align: center;
            max-height: 60px;
            overflow: hidden;
        }
        
        .merged-cell input,
        .merged-cell select {
            margin: 1px 0;
            text-align: center;
            font-size: 10px;
            padding: 2px;
            border: 1px solid #2196F3;
            background: white;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        @media print {
            .cell-checkbox {
                display: none !important;
            }
            
            .merged-cell {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                height: 42px !important;
                max-height: 42px !important;
                min-height: 42px !important;
                overflow: hidden !important;
            }
            
            .merged-cell-content {
                max-height: 42px !important;
                overflow: hidden !important;
                gap: 1px;
                padding: 2px;
            }
            
            .merged-cell input,
            .merged-cell select {
                border: none;
                font-size: 0.8rem;
                background: transparent;
            }
        }
        
        .merge-toolbar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border: 2px solid #2196F3;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }
        
        .merge-toolbar.active {
            display: block;
        }
        
        .merge-toolbar button {
            margin: 5px;
            padding: 10px 15px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-merge-confirm {
            background: var(--theme-modal-accent);
            color: white;
        }
        
        .btn-merge-cancel {
            background: #f44336;
            color: white;
        }
        
        .btn-merge-confirm:hover {
            background: var(--theme-primary);
        }
        
        .btn-merge-cancel:hover {
            background: #da190b;
        }
        
        @media print {
            .merge-toolbar {
                display: none !important;
            }
        }
        
        /* Modal Popup Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            min-width: 400px;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideInLeft 0.3s ease;
        }
        
        /* Unified Modal Specific Styles */
        #unifiedModalContent {
            max-width: 600px;
        }
        
        #teachingFieldsSection,
        #officeHoursFieldsSection,
        #breakFieldsSection,
        #chFieldsSection,
        #nsFieldsSection,
        #activityFieldsSection,
        #durationSection {
            animation: fadeIn 0.4s ease;
        }
        
        .modal-header {
            font-size: 18px;
            font-weight: bold;
            color: var(--theme-modal-accent);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-field {
            margin-bottom: 15px;
        }
        
        .modal-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #000418;
        }
        
        .modal-field input,
        .modal-field select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--theme-modal-accent);
            border-radius: 5px;
            font-size: 14px;
            text-transform: uppercase;
            box-sizing: border-box;
        }
        
        .modal-field input:focus,
        .modal-field select:focus {
            outline: none;
            border-color: var(--theme-primary);
            box-shadow: 0 0 5px rgba(58, 31, 255, 0.3);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .modal-btn-save {
            background: var(--theme-modal-accent);
            color: white;
        }
        
        .modal-btn-save:hover {
            background: var(--theme-primary);
        }
        
        .session-length-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .length-btn {
            flex: 1;
            min-width: 70px;
            padding: 10px 15px;
            background: white;
            border: 2px solid var(--theme-modal-accent);
            color: var(--theme-modal-accent);
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .length-btn:hover:not(:disabled) {
            background: #E6F2FF;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(58, 31, 255, 0.3);
        }
        
        .length-btn.active {
            background: var(--theme-modal-accent);
            color: white;
        }
        
        .length-btn:disabled {
            background: #f5f5f5;
            border-color: #d0d0d0;
            color: #b0b0b0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .length-btn:disabled:hover {
            background: #f5f5f5;
            transform: none;
            box-shadow: none;
        }
        
        .modal-btn-cancel {
            background: #f44336;
            color: white;
        }
        
        .modal-btn-cancel:hover {
            background: #da190b;
        }
        
        @media print {
            .modal-overlay {
                display: none !important;
            }
        }
        
        @media print {
            .header img {
                max-width: 200px !important;
                height: auto !important;
            }
        }
    
        .resize-handle {
            position: absolute;
            top: 0;
            right: -3px;
            width: 6px;
            height: 100%;
            cursor: ew-resize;
            z-index: 20;
            background: transparent;
        }
        .merged-teaching.resizing {
            border-style: dashed;
        }
        

/* Hide standalone legend section */
.legend {
    display: none !important;
}

/* Responsive legend inside summary */
@media (max-width: 768px) {
    .summary > div > div {
        flex-direction: column !important;
        gap: 10px !important;
    }
}


/* Header Cells */
.day-header {
    background-color: rgba(5, 41, 118, 0.03)!important;
    font-weight: bold;
}

.time-header {
    background-color: rgba(5, 41, 118, 0.03)!important;
    font-weight: bold;
}

.schedule-table th {
    background-color: rgba(5, 41, 118, 0.03)!important;
}


/* RCJY Cell Background Colors - Revised Visible Shades */

.type-LAB {
    background-color: rgba(92, 196, 245, 0.05)!important;
}

.merged-teaching.type-LAB {
    background-color: rgba(92, 196, 245, 0.05)!important;
}

.type-LEC {
    background-color: rgba(38, 85, 239, 0.05)!important;
}

.merged-teaching.type-LEC {
    background-color: rgba(38, 85, 239, 0.05)!important;
}

.type-TUT {
    background-color: rgba(92, 196, 245, 0.03)!important;
}

.merged-teaching.type-TUT {
    background-color: rgba(92, 196, 245, 0.03)!important;
}

.type-TRANSFER_KNOWLEDGE {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 185, 15, 0.1))!important;
    border-left: 4px solid #FFD700 !important;
}

.merged-teaching.type-TRANSFER_KNOWLEDGE {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 185, 15, 0.1))!important;
    border-left: 4px solid #FFD700 !important;
}

/* Merged cell styling for multi-hour sessions */
.merged-teaching-content {
    position: relative;
    z-index: 5;
}

.merged-continuation-cell {
    position: relative;
}

.merged-continuation-cell .cell-content {
    opacity: 0.3;
    pointer-events: none;
}

/* Make continuation cells less prominent */
.merged-continuation {
    pointer-events: none;
}

.type-ACTIVITY {
    background-color: rgba(129, 69, 205, 0.05)!important;
}

.merged-teaching.type-ACTIVITY {
    background-color: rgba(129, 69, 205, 0.05)!important;
}

.type-PC {
    background-color: rgba(129, 69, 205, 0.05)!important;
}

.merged-teaching.type-PC {
    background-color: rgba(129, 69, 205, 0.05)!important;
}

.type-BREAK {
    background-color: rgba(255, 193, 7, 0.05)!important;
}

.merged-teaching.type-BREAK {
    background-color: rgba(255, 193, 7, 0.05)!important;
}

.type-NS {
    background-color: rgba(0, 0, 0, 0.03)!important;
}

.merged-teaching.type-NS {
    background-color: rgba(0, 0, 0, 0.03)!important;
}

.type-OH {
    background-color: rgba(32, 206, 115, 0.05)!important;
}

.merged-teaching.type-OH {
    background-color: rgba(32, 206, 115, 0.05)!important;
}

.type-CH {
    background-color: rgba(185, 148, 112, 0.05)!important;
}

.merged-teaching.type-CH {
    background-color: rgba(185, 148, 112, 0.05)!important;
}

/* Header Cells */
.day-header {
    background-color: rgba(5, 41, 118, 0.03)!important;
    font-weight: bold;
}

.time-header {
    background-color: rgba(5, 41, 118, 0.03)!important;
    font-weight: bold;
}

.schedule-table th {
    background-color: rgba(5, 41, 118, 0.03)!important;
}


        @media screen and (max-width: 768px) {
            .header {
                flex-direction: column !important;
                align-items: center !important;
                text-align: center !important;
                padding: 5rem 0.5rem 0.75rem !important;
            }
            
            .header > div {
                width: 100% !important;
                text-align: center !important;
                align-items: center !important;
            }
            
            .header img {
                width: 80px !important;
                top: 5px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
            }
            
            .header h1 {
                font-size: 0.85rem !important;
                line-height: 1.3;
            }
        }
        
        @media screen and (max-width: 480px) {
            .header img {
                width: 70px !important;
            }
            
            .header h1 {
                font-size: 0.75rem !important;
            }
        }
        
        @media print {
            .header {
                display: flex !important;
                justify-content: space-between !important;
                align-items: flex-start !important;
                padding: 0.2rem 0.4rem !important;
                margin-bottom: 0 !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                background: white !important;
                z-index: 1000 !important;
                height: 105px !important;
            }
            
            .header > div {
                max-width: 35% !important;
            }
            
            .header h1 {
                font-size: 0.75rem !important;
                margin: 0.08rem 0 !important;
                line-height: 1.15 !important;
            }
            
            .header img {
                width: 85px !important;
                position: absolute !important;
                top: 8px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
            }
        }
</style>
</head>
<body>

<!-- ========== LANDING PAGE ========== -->
<div class="page-container landing-page active" id="landingPage">
    <!-- Header Section with Logo -->
    <div class="landing-header">
        <img src="data:image/png;base64,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" alt="Royal Commission Logo" class="landing-logo" />
        <!-- Subtitle removed as requested -->
        <h1>Faculty Scheduling System</h1>
    </div>
    
    <!-- Main Content -->
    <div class="landing-content">
        <div class="button-container">
            <div class="option-button" onclick="showIndividualSchedule()">
                <div class="icon">
                    <svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect x="15" y="20" width="70" height="65" rx="5" fill="#052976" opacity="0.1"/>
                        <rect x="15" y="15" width="70" height="70" rx="5" fill="none" stroke="#052976" stroke-width="3"/>
                        <line x1="30" y1="15" x2="30" y2="25" stroke="#20CE76" stroke-width="3" stroke-linecap="round"/>
                        <line x1="50" y1="15" x2="50" y2="25" stroke="#20CE76" stroke-width="3" stroke-linecap="round"/>
                        <line x1="70" y1="15" x2="70" y2="25" stroke="#20CE76" stroke-width="3" stroke-linecap="round"/>
                        <rect x="25" y="35" width="12" height="10" rx="2" fill="#052976"/>
                        <rect x="44" y="35" width="12" height="10" rx="2" fill="#20CE76"/>
                        <rect x="63" y="35" width="12" height="10" rx="2" fill="#052976"/>
                        <rect x="25" y="52" width="12" height="10" rx="2" fill="#20CE76"/>
                        <rect x="44" y="52" width="12" height="10" rx="2" fill="#052976"/>
                        <rect x="63" y="52" width="12" height="10" rx="2" fill="#20CE76"/>
                        <rect x="25" y="69" width="12" height="10" rx="2" fill="#052976"/>
                    </svg>
                </div>
                <h2>Build Schedule</h2>
                <p>Create a single faculty member's schedule with an interactive drag-and-drop interface. Perfect for quick edits and real-time updates.</p>
                <span class="feature-badge">Interactive Builder</span>
            </div>
            <div class="option-button" onclick="showUserGuide()">
                <div class="icon">
                    <svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <rect x="20" y="10" width="60" height="75" rx="4" fill="#052976" opacity="0.1"/>
                        <rect x="20" y="10" width="60" height="75" rx="4" fill="none" stroke="#052976" stroke-width="3"/>
                        <line x1="30" y1="25" x2="70" y2="25" stroke="#052976" stroke-width="3" stroke-linecap="round"/>
                        <line x1="30" y1="38" x2="65" y2="38" stroke="#20CE76" stroke-width="2" stroke-linecap="round"/>
                        <line x1="30" y1="48" x2="60" y2="48" stroke="#20CE76" stroke-width="2" stroke-linecap="round"/>
                        <line x1="30" y1="58" x2="55" y2="58" stroke="#20CE76" stroke-width="2" stroke-linecap="round"/>
                        <line x1="30" y1="68" x2="50" y2="68" stroke="#20CE76" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="72" cy="78" r="12" fill="#20CE76"/>
                        <text x="72" y="83" text-anchor="middle" fill="white" font-size="16" font-weight="bold">?</text>
                    </svg>
                </div>
                <h2>User Guide</h2>
                <p>Learn how to use the Faculty Schedule System effectively. Step-by-step instructions, tips, and keyboard shortcuts.</p>
                <span class="feature-badge">Documentation</span>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="landing-footer">
        <p>Â© 2025 Yanbu Industrial College - Royal Commission Yanbu Colleges & Institutes. All Rights Reserved.</p>
    </div>
</div>

<!-- ========== INDIVIDUAL SCHEDULE PAGE (ORIGINAL - COMPLETELY UNCHANGED) ========== -->
<div class="page-container" id="individualSchedulePage">

<!-- Floating Dropdown Menu -->
<div class="floating-menu-container" id="floatingMenu">
    <button class="floating-menu-button" onclick="toggleFloatingMenu()">
        <span class="floating-menu-icon">â–¼</span>
        <span>MENU</span>
    </button>
    <div class="floating-menu-dropdown">
        <button class="floating-menu-item" onclick="showLandingPage(); closeFloatingMenu();">
            <div class="floating-menu-item-icon">ðŸ </div>
            <span>Home</span>
        </button>
        <div class="floating-menu-divider"></div>
        <button class="floating-menu-item" onclick="addCourseRow(); closeFloatingMenu();">
            <div class="floating-menu-item-icon">âž•</div>
            <span>Add Course</span>
        </button>
        <button class="floating-menu-item" onclick="openUnifiedModal('SUNDAY', 0); closeFloatingMenu();">
            <div class="floating-menu-item-icon">ðŸ“…</div>
            <span>Schedule</span>
        </button>
        <div class="floating-menu-divider"></div>
        <button class="floating-menu-item" onclick="toggleThemePanel(); closeFloatingMenu();">
            <div class="floating-menu-item-icon">ðŸŽ¨</div>
            <span>Theme</span>
        </button>
        <button class="floating-menu-item" onclick="lockAndExport(); closeFloatingMenu();">
            <div class="floating-menu-item-icon">ðŸ“„</div>
            <span>PDF</span>
        </button>
    </div>
</div>

<!-- Theme Selector Panel -->
<div class="theme-selector-panel" id="themeSelectorPanel">
    <div class="theme-selector-title">
        ðŸŽ¨ Select Theme
    </div>
    <div class="theme-grid">
        <button class="theme-btn active" onclick="setTheme('navy')" data-theme-btn="navy">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #052976, #1a4d9e);"></div>
            Navy
        </button>
        <button class="theme-btn" onclick="setTheme('cyan')" data-theme-btn="cyan">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #0097A7, #00ACC1);"></div>
            Cyan
        </button>
        <button class="theme-btn" onclick="setTheme('green')" data-theme-btn="green">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #2E7D32, #43A047);"></div>
            Green
        </button>
        <button class="theme-btn" onclick="setTheme('blue')" data-theme-btn="blue">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #1565C0, #1976D2);"></div>
            Blue
        </button>
        <button class="theme-btn" onclick="setTheme('purple')" data-theme-btn="purple">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #6A1B9A, #7B1FA2);"></div>
            Purple
        </button>
        <button class="theme-btn" onclick="setTheme('gold')" data-theme-btn="gold">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #BF8C00, #D4A017);"></div>
            Gold
        </button>
        <button class="theme-btn" onclick="setTheme('cream')" data-theme-btn="cream" style="grid-column: span 2;">
            <div class="theme-color-preview" style="background: linear-gradient(135deg, #5D4037, #6D4C41);"></div>
            Cream / Classic
        </button>
    </div>
</div>

<div class="container">
<div class="header" style="margin-bottom:1.875rem; padding:1rem 1.5rem; display: flex; justify-content: space-between; align-items: center;">
    <!-- Left side content -->
    <div style="text-align: left; flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: flex-start;">
        <h1 class="main-title">Royal Commission Yanbu Colleges &amp; Institutes</h1>
        <span id="departmentHeader" class="sub-title">Electrical Engineering Department</span>
    </div>
    
    <!-- Logo in the center - defines header height -->
    <img alt="Royal Commission Logo" src="data:image/webp;base64,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" style="width:110px; height:auto; flex-shrink:0; margin: 0 2rem; background: white; padding: 1rem; border-radius: 1rem; box-shadow: 0 4px 16px rgba(0,0,0,0.15);"/>
    
    <!-- Right side content -->
    <div style="text-align: right; flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: flex-end;">
        <h1 class="main-title">Faculty Schedule</h1>
        <span id="semesterYearDisplay" class="sub-title">First Semester 1447(471)</span>
    </div>
</div>
<div class="department-info">
<div class="department-row">
<label for="departmentSelect">Department:</label>
<select id="departmentSelect" class="faculty-input-keep" onchange="updateDepartmentDisplay()">
<option value="Chemical Engineering">Chemical Engineering</option>
<option value="Computer Science and Engineering">Computer Science and Engineering</option>
<option selected="" value="Electrical Engineering">Electrical Engineering</option>
<option value="Management Science">Management Science</option>
<option value="Mechanical Engineering">Mechanical Engineering</option>
</select>

<label for="semesterType" style="margin-left: 1.5rem;">Semester:</label>
<select id="semesterType" class="faculty-input-keep" onchange="updateSemesterDisplay()" style="padding: 0.5rem 0.9375rem; border: none; font-size: 0.875rem; border-radius: 5px; background: white; font-weight: bold; color: #1F618D; cursor: pointer; min-width: 200px;">
<option value="First">First Semester</option>
<option value="Second">Second Semester</option>
<option value="Summer">Summer Semester</option>
</select>

<label for="hijriYear" style="margin-left: 1.5rem;">Hijri Year:</label>
<input id="hijriYear" class="faculty-input-keep" onchange="updateSemesterDisplay()" placeholder="e.g., 1446" type="text" style="padding: 0.5rem 0.9375rem; border: none; font-size: 0.875rem; border-radius: 5px; background: white; font-weight: bold; color: #1F618D; width: 120px;"/>

<label for="gregorianCode" style="margin-left: 1.5rem;">TERM CODE:</label>
<input id="gregorianCode" class="faculty-input-keep" onchange="updateSemesterDisplay()" placeholder="e.g., 471" type="text" style="padding: 0.5rem 0.9375rem; border: none; font-size: 0.875rem; border-radius: 5px; background: white; font-weight: bold; color: #1F618D; width: 100px;"/>

<button class="btn-auto-year" onclick="autoSetYears()" style="margin-left: 1.5rem;">ðŸ”„ Auto Set Current Years</button>
</div>
</div>
<div class="faculty-info-wrapper">
<div class="faculty-info">
    <div style="display: flex; gap: 2rem; align-items: flex-start;">
        <!-- Left side: Inline layout (label beside input) -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 0.75rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label style="font-weight: bold; font-size: 0.875rem; min-width: 120px;">Faculty Name:</label>
                <input id="facultyRank" placeholder="Rank" type="text" style="width: 60px; padding: 0.4rem; border: 1px solid #ccc; font-size: 0.875rem; border-radius: 4px; text-align: center;" class="faculty-input-keep"/>
                <input id="facultyName" type="text" placeholder="Enter faculty name" style="flex: 1; padding: 0.4rem; border: 1px solid #ccc; font-size: 0.875rem; border-radius: 4px;" class="faculty-input-keep"/>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label style="font-weight: bold; font-size: 0.875rem; min-width: 120px;">Email:</label>
                <input id="email" placeholder="Email address" type="text" style="flex: 1;" class="faculty-input-keep"/>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label style="font-weight: bold; font-size: 0.875rem; min-width: 120px;">Office Location:</label>
                <input id="officeLocation" placeholder="Office" type="text" style="flex: 1;" class="faculty-input-keep"/>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label style="font-weight: bold; font-size: 0.875rem; min-width: 120px;">Phone:</label>
                <input id="phone" placeholder="Phone number" type="text" style="flex: 1;" class="faculty-input-keep"/>
            </div>
        </div>
        
        <!-- Right side: Dynamic Courses -->
        <div style="flex: 2;">
            <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 0.5rem;">
                <button id="addCourseBtn" class="ios-button ios-button-green" type="button" style="display: none;">
                    <div class="ios-button-icon" style="width: 40px; height: 40px; font-size: 20px;">
                        <span>âž•</span>
                    </div>
                    <div class="ios-button-label">Add Course</div>
                </button>
            </div>
            <div id="coursesContainer" style="display: flex; flex-direction: column; gap: 0.5rem;">
                <!-- Course rows will be added here dynamically -->
            </div>
            

        </div>
    </div>
</div>
</div>

<div class="schedule-table-wrapper">
<table class="schedule-table">
<thead>
<tr>
<th class="time-header first">DAY</th>
<th class="time-header">07:15<br/>08:05</th>
<th class="time-header">08:15<br/>09:05</th>
<th class="time-header">09:15<br/>10:05</th>
<th class="time-header">10:15<br/>11:05</th>
<th class="time-header">11:15<br/>12:05</th>
<th class="time-header">12:15<br/>13:05</th>
<th class="time-header">13:15<br/>14:05</th>
<th class="time-header">14:15<br/>15:05</th>
<th class="time-header">15:15<br/>16:05</th>
<th class="time-header">16:15<br/>17:05</th>
<th class="time-header">17:15<br/>18:05</th>
<th class="time-header">18:15<br/>19:05</th>
<th class="time-header">19:15<br/>20:05</th>
<th class="time-header">20:15<br/>21:05</th>
<th class="time-header">21:15<br/>22:05</th>
<th class="time-header">22:15<br/>23:05</th>
</tr>
</thead>
<tbody id="scheduleBody">
</tbody>
</table>
</div>
<div class="summary">
<div class="summary-grid">
<!-- Column 1: Labels -->
<div class="summary-col">
<div class="summary-row-label">Total Teaching Hours:</div>
<div class="summary-row-label">Total Non Teaching Duties Hours:</div>
<div class="summary-row-label">No. of Courses:</div>
</div>

<!-- Column 2: Values -->
<div class="summary-col">
<div class="summary-row-value"><span id="teachingHours">0</span> Hours</div>
<div class="summary-row-value"><span id="nonTeachingHours">0</span> Hours</div>
<div class="summary-row-value"><span id="numCourses">0</span> Courses</div>
</div>

<!-- Column 3: Labels -->
<div class="summary-col">
<div class="summary-row-label">Total NS Hours:</div>
<div class="summary-row-label">Total CH Hours:</div>
<div class="summary-row-label">Total Office Hours:</div>
<div class="summary-row-label">Internal Activity:</div>
</div>

<!-- Column 4: Values -->
<div class="summary-col">
<div class="summary-row-value"><span id="nsHours">0</span> Hours</div>
<div class="summary-row-value"><span id="chHours">0</span> Hours</div>
<div class="summary-row-value"><span id="officeHours">0</span> Hours</div>
<div class="summary-row-value"><span id="internalActivity">40</span> Hours</div>
</div>
</div>

<div class="summary-row-total" style="border-top: 2px solid #333; padding-top: 0.5rem; margin-top: 0.5rem; display: flex; justify-content: space-between; font-weight: bold;">
<span>TOTAL WEEKLY HOURS:</span>
<span class="summary-value" style="font-size: 1rem;"><span id="totalWeekly">40</span> Hours</span>
</div>

                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; font-size: 13px; line-height: 1.6;">
                        <span><strong style="color: var(--theme-primary); font-weight: bold;">BREAK</strong> <span style="color: #000;">- BREAK TIME</span></span>
                        <span style="color: #ccc;">|</span>
                        <span><strong style="color: var(--theme-primary); font-weight: bold;">NS</strong> <span style="color: #000;">- NON SCHEDULED HOURS</span></span>
                        <span style="color: #ccc;">|</span>
                        <span><strong style="color: var(--theme-primary); font-weight: bold;">OH</strong> <span style="color: #000;">- OFFICE HOURS</span></span>
                        <span style="color: #ccc;">|</span>
                        <span><strong style="color: var(--theme-primary); font-weight: bold;">CH</strong> <span style="color: #000;">- COMPENSATED HOURS</span></span>
                        <span style="color: #ccc;">|</span>
                        <span><strong style="color: var(--theme-primary); font-weight: bold;">*</strong> <span style="color: #000;">- Transfer Knowledge and Expertise</span></span>
                    </div>
                </div></div>
<div class="footer">
    <!-- Head of Department Approval Section -->
    <div style="display: flex; gap: 3rem; align-items: flex-start; width: 100%; margin-bottom: 1rem;">
        <!-- Left: Faculty Acknowledgment -->
        <div style="flex: 1;">
            <div style="font-weight: bold; font-size: 0.9rem; margin-bottom: 0.5rem;">Faculty Acknowledgment:</div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Name:</label>
                    <input id="instructorAckName" type="text" placeholder="Faculty name" 
                           style="flex: 1; padding: 0.3rem; border: 1px solid #999; font-size: 0.875rem;" 
                           class="faculty-input-keep" readonly/>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Signature:</label>
                    <div style="flex: 1; border-bottom: 1px solid #333; height: 40px;"></div>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Date:</label>
                    <input id="instructorAckDate" type="text" placeholder="DD/MM/YYYY" 
                           style="flex: 1; padding: 0.3rem; border: 1px solid #999; font-size: 0.875rem;" 
                           class="faculty-input-keep"/>
                </div>
            </div>
        </div>
        
        <!-- Right: Head of Department Approval -->
        <div style="flex: 1;">
            <div style="font-weight: bold; font-size: 0.9rem; margin-bottom: 0.5rem;">Head of Department Approval:</div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Name:</label>
                    <input id="hodName" type="text" placeholder="Head of Department name" 
                           style="flex: 1; padding: 0.3rem; border: 1px solid #999; font-size: 0.875rem;" 
                           class="faculty-input-keep"/>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Signature:</label>
                    <div style="flex: 1; border-bottom: 1px solid #333; height: 40px;"></div>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <label style="min-width: 80px; font-size: 0.875rem;">Date:</label>
                    <input id="hodDate" type="text" placeholder="DD/MM/YYYY" 
                           style="flex: 1; padding: 0.3rem; border: 1px solid #999; font-size: 0.875rem;" 
                           class="faculty-input-keep"/>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons with iOS Style -->
    <div id="actionButtons" style="padding-top: 1.5rem; border-top: 2px solid #ddd; margin-top: 1.5rem; display: none;">
        <div class="ios-button-group" style="justify-content: center;">
            <button class="ios-button ios-button-orange" onclick="lockAndExport()">
                <div class="ios-button-icon">
                    <span>ðŸ“„</span>
                </div>
                <div class="ios-button-label">PDF</div>
            </button>
        </div>
    </div>
</div>
</div>

<!-- Copyright Footer -->
<div style="text-align: center; padding: 0.5rem; background: white; color: #666; font-size: 0.75rem; border-top: 1px solid #ddd;">
    Â© 2025 Yanbu Industrial College - Royal Commission Yanbu Colleges & Institutes. All Rights Reserved.
</div>

<!-- Merge Toolbar -->
<div class="merge-toolbar" id="mergeToolbar">
<div style="margin-bottom: 10px; font-weight: bold; color: #2196F3;">Select cells to merge:</div>
<button class="btn-merge-confirm" onclick="confirmMerge()">âœ“ Merge Selected Cells</button>
<button class="btn-merge-cancel" onclick="cancelMerge()">âœ• Cancel</button>
</div>

<!-- Modal Popup for Teaching Session Input -->
<!-- UNIFIED SCHEDULING MODAL - Handles both Teaching and Non-Teaching -->
<div class="modal-overlay" id="unifiedModal">
    <div class="modal-content" id="unifiedModalContent">
        <div class="modal-header">Schedule Activity</div>
        
        <!-- STEP 1: Activity Type Selection (Always Visible) -->
        <div class="modal-field">
            <label style="font-weight: bold; font-size: 15px; color: #333;">What would you like to schedule?</label>
            <select id="unifiedActivityType" onchange="onUnifiedActivityTypeChange()" style="font-size: 14px; padding: 10px;">
                <option value="">-- Select Activity Type --</option>
                <option value="TEACHING">ðŸ“š TEACHING (Lecture/Lab/Tutorial)</option>
                <option value="OH">ðŸ• OFFICE HOURS</option>
                <option value="BREAK">â˜• BREAK</option>
                <option value="CH">ðŸ“– COMPENSATED HOURS</option>
                <option value="NS">ðŸ“‹ NON-SCHEDULED HOURS</option>
                <option value="ACTIVITY">âœ“âœ“ ACTIVITY (Committee/Meeting)</option>
            </select>
        </div>
        
        <div style="height: 1px; background: #e0e0e0; margin: 15px 0;"></div>
        
        <!-- TEACHING FIELDS (Show only when TEACHING selected) -->
        <div id="teachingFieldsSection" style="display: none;">
            <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: bold; color: #2196F3; margin-bottom: 12px;">ðŸ“š Teaching Details</div>
                
                <div class="modal-field">
                    <label>Course Code: <span style="color: red;">*</span></label>
                    <input type="text" id="unifiedCourseCode" placeholder="e.g., ELET242, EE 304" oninput="validateUnifiedFields()" />
                </div>
                
                <div class="modal-field">
                    <label>Type: <span style="color: red;">*</span></label>
                    <select id="unifiedTeachingType" onchange="validateUnifiedFields()">
                        <option value="">Select Type</option>
                        <option value="LEC">LEC - Lecture</option>
                        <option value="LAB">LAB - Laboratory</option>
                        <option value="TUT">TUT - Tutorial</option>
                    </select>
                </div>
                
                <div class="modal-field">
                    <label>Section: <span style="color: #999; font-size: 12px;">(Optional)</span></label>
                    <input type="text" id="unifiedSection" placeholder="e.g., 01, 02" />
                </div>
                
                <div class="modal-field">
                    <label>Location: <span style="color: red;">*</span></label>
                    <input type="text" id="unifiedLocation" placeholder="e.g., A/3-120B" oninput="validateUnifiedFields()" />
                </div>
                
                <div class="modal-field">
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="unifiedTransferFlag" />
                        Transfer Knowledge and Expertise
                    </label>
                    <div style="font-size:12px; color:#666; margin-left:24px;">
                        (Adds * mark to this teaching block)
                    </div>
                </div>
            </div>
        </div>
        
        <!-- OFFICE HOURS FIELDS (Show only when OH selected) -->
        <div id="officeHoursFieldsSection" style="display: none;">
            <div style="background: #f0fff4; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div class="oh-section-header" style="font-weight: bold; margin-bottom: 12px;">ðŸ• Office Hours Details</div>
                
                <div class="modal-field">
                    <label>Location: <span style="color: #999; font-size: 12px;">(Optional)</span></label>
                    <input type="text" id="unifiedOHLocation" placeholder="e.g., Office ACX-F04" />
                </div>
                
                <div class="modal-field">
                    <label>Note: <span style="color: #999; font-size: 12px;">(Optional)</span></label>
                    <input type="text" id="unifiedOHNote" placeholder="e.g., Walk-in hours, By appointment" />
                </div>
            </div>
        </div>
        
        <!-- BREAK FIELDS (Show only when BREAK selected) -->
        <div id="breakFieldsSection" style="display: none;">
            <div style="background: #fffbf0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: bold; color: #FF9500; margin-bottom: 12px;">â˜• Break Details</div>
                <div style="color: #666; font-size: 13px;">
                    âœ“ Minimal setup - just select duration below!
                </div>
            </div>
        </div>
        
        
        <!-- CH FIELDS (Show only when CH selected) -->
        <div id="chFieldsSection" style="display: none;">
            <div style="background: #f0f0ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: bold; color: var(--theme-primary); margin-bottom: 12px;">ðŸ“– Compensated Hours</div>
                <div style="color: #666; font-size: 13px;">
                    âœ“ No additional details needed - just select duration below!
                </div>
            </div>
        </div>
        
        <!-- NS FIELDS (Show only when NS selected) -->
        <div id="nsFieldsSection" style="display: none;">
            <div style="background: #f5f5ff; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: bold; color: #5c6bc0; margin-bottom: 12px;">ðŸ“‹ Non-Scheduled Hours</div>
                <div style="color: #666; font-size: 13px;">
                    âœ“ No additional details needed - just select duration below!
                </div>
            </div>
        </div>
        
        <!-- ACTIVITY FIELDS (Show only when ACTIVITY selected) -->
        <div id="activityFieldsSection" style="display: none;">
            <div style="background: #fff0f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <div style="font-weight: bold; color: var(--theme-primary); margin-bottom: 12px;">âœ“âœ“ Activity Details</div>
                
                <div class="modal-field">
                    <label>Activity Type: <span style="color: red;">*</span></label>
                    <select id="unifiedActivitySubtype" onchange="onActivitySubtypeChange()">
                        <option value="">Select Activity</option>
                        <option value="PC">PC - Program Coordination</option>
                        <option value="PAEC">PAEC - Program Assessment & Evaluation Committee</option>
                        <option value="DAC">DAC - Department Affairs Committee</option>
                        <option value="DAQC">DAQC - Department Academic Quality Committee</option>
                        <option value="DASC">DASC - Department Academic Support Committee</option>
                        <option value="CUSTOM">CUSTOM - Enter Your Own</option>
                    </select>
                </div>
                
                <div class="modal-field" id="customActivityField" style="display: none;">
                    <label>Custom Activity Name: <span style="color: red;">*</span></label>
                    <input type="text" id="unifiedCustomActivity" placeholder="Enter custom activity name" oninput="validateUnifiedFields()" />
                </div>
                
                <div class="modal-field">
                    <label>Location: <span style="color: #999; font-size: 12px;">(Optional)</span></label>
                    <input type="text" id="unifiedActivityLocation" placeholder="e.g., Meeting Room B" />
                </div>
            </div>
        </div>
        
        <!-- DURATION SELECTION (Shows after type selected and fields validated) -->
        <div id="durationSection" style="display: none;">
            <div class="modal-field">
                <label style="font-weight: bold;">Duration / Session Length:</label>
                <div class="session-length-buttons" id="unifiedDurationButtons">
                    <button class="length-btn" data-length="1" onclick="selectUnifiedDuration(1)" disabled>1 Hour</button>
                    <button class="length-btn" data-length="2" onclick="selectUnifiedDuration(2)" disabled>2 Hours</button>
                    <button class="length-btn" data-length="3" onclick="selectUnifiedDuration(3)" disabled>3 Hours</button>
                    <button class="length-btn" data-length="4" onclick="selectUnifiedDuration(4)" disabled>4 Hours</button>
                    <button class="length-btn" data-length="5" onclick="selectUnifiedDuration(5)" disabled>5 Hours</button>
                </div>
                <div id="durationHint" style="margin-top: 8px; font-size: 12px; color: #999;">
                    Select how many consecutive time slots this activity will occupy
                </div>
            </div>
            
            <div class="modal-field" style="margin-top: 15px;">
                <label style="font-weight: bold;">Number of Times:</label>
                <select id="unifiedRepeatTimes" onchange="selectRepeatTimes()" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="1" selected>1 time</option>
                    <option value="2">2 times</option>
                    <option value="3">3 times</option>
                    <option value="4">4 times</option>
                    <option value="5">5 times</option>
                    <option value="6">6 times</option>
                    <option value="7">7 times</option>
                    <option value="8">8 times</option>
                    <option value="9">9 times</option>
                    <option value="10">10 times</option>
                    <option value="11">11 times</option>
                    <option value="12">12 times</option>
                    <option value="13">13 times</option>
                    <option value="14">14 times</option>
                    <option value="15">15 times</option>
                    <option value="16">16 times</option>
                    <option value="17">17 times</option>
                    <option value="18">18 times</option>
                    <option value="19">19 times</option>
                    <option value="20">20 times</option>
                    <option value="21">21 times</option>
                    <option value="22">22 times</option>
                    <option value="23">23 times</option>
                    <option value="24">24 times</option>
                    <option value="25">25 times</option>
                    <option value="26">26 times</option>
                    <option value="27">27 times</option>
                    <option value="28">28 times</option>
                    <option value="29">29 times</option>
                    <option value="30">30 times</option>
                    <option value="31">31 times</option>
                    <option value="32">32 times</option>
                    <option value="33">33 times</option>
                    <option value="34">34 times</option>
                    <option value="35">35 times</option>
                    <option value="36">36 times</option>
                    <option value="37">37 times</option>
                    <option value="38">38 times</option>
                    <option value="39">39 times</option>
                    <option value="40">40 times</option>
                </select>
                <div style="margin-top: 8px; font-size: 12px; color: #999;">
                    How many times to apply this schedule (counter decrements with each application)
                </div>
            </div>
        </div>
        
        <!-- ACTION BUTTONS -->
        <div class="modal-buttons" style="margin-top: 20px;">
            <button class="modal-btn-cancel" onclick="closeUnifiedModal()">âœ• Cancel</button>
            <button class="modal-btn-save" id="unifiedNextButton" onclick="proceedToCellSelection()" disabled style="opacity: 0.5;">
                Next: Select Cells â†’
            </button>
        </div>
    </div>
</div>

<!-- Keep old teaching modal ID for backward compatibility, but hide it -->
<div class="modal-overlay" id="teachingModal" style="display: none;">
    <div class="modal-content">
        <!-- Old modal kept for compatibility but hidden -->
    </div>
</div>

<!-- Modal Popup for Merged Cell Input (for manual merge) -->
<div class="modal-overlay" id="mergeModal">
    <div class="modal-content">
        <div class="modal-header">Enter Course Details</div>
        
        <div class="modal-field">
            <label>Course Code:</label>
            <input type="text" id="mergeCourseCode" placeholder="e.g., ELET242" />
        </div>
        
        <div class="modal-field">
            <label>Type:</label>
            <select id="mergeType">
                <option value="">Select Type</option>
                <option value="LAB">LAB</option>
                <option value="LEC">LEC</option>
                <option value="TUT">TUT</option>
            </select>
        </div>
        
        <div class="modal-field">
            <label>Location:</label>
            <input type="text" id="mergeLocation" placeholder="e.g., A/3-120B" />
        </div>
        
        <div class="modal-buttons">
            <button class="modal-btn-save" onclick="saveModalData()">âœ“ Save</button>
            <button class="modal-btn-cancel" onclick="closeModal()">âœ• Cancel</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
        // ========== SEVEN-THEME SYSTEM ==========
        // Theme switching with localStorage persistence
        
        // Helper function to get CSS variable value at runtime
        function getThemeColor(varName) {
            return getComputedStyle(document.body).getPropertyValue(varName).trim();
        }
        
        // Get commonly used theme colors
        function getThemePrimary() { return getThemeColor('--theme-primary') || '#052976'; }
        function getThemeSecondary() { return getThemeColor('--theme-secondary') || '#1a4d9e'; }
        function getThemeAccent() { return getThemeColor('--theme-accent') || '#20CE76'; }
        function getThemeModalAccent() { return getThemeColor('--theme-modal-accent') || '#3A1FFF'; }
        
        function setTheme(themeName) {
            // Apply theme to body
            document.body.setAttribute('data-theme', themeName);
            
            // Update active button state
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`[data-theme-btn="${themeName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Save to localStorage
            localStorage.setItem('rcjy-schedule-theme', themeName);
            
            // Close theme panel after selection
            const panel = document.getElementById('themeSelectorPanel');
            if (panel) {
                panel.classList.remove('active');
            }
            
            console.log(`Theme changed to: ${themeName}`);
        }
        
        function toggleThemePanel() {
            const panel = document.getElementById('themeSelectorPanel');
            if (panel) {
                panel.classList.toggle('active');
            }
        }
        
        function closeThemePanel() {
            const panel = document.getElementById('themeSelectorPanel');
            if (panel) {
                panel.classList.remove('active');
            }
        }
        
        // Load saved theme on page load - Always default to Navy
        function loadSavedTheme() {
            // Always start with Navy theme
            setTheme('navy');
        }
        
        // Close theme panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('themeSelectorPanel');
            const isThemeBtn = e.target.closest('.theme-btn');
            const isPanel = e.target.closest('.theme-selector-panel');
            const isMenuBtn = e.target.closest('.floating-menu-item');
            
            if (panel && panel.classList.contains('active') && !isPanel && !isThemeBtn && !isMenuBtn) {
                panel.classList.remove('active');
            }
        });
        
        // Initialize theme on DOM ready
        document.addEventListener('DOMContentLoaded', loadSavedTheme);
        
        // ========== END THEME SYSTEM ==========

        // Faculty data from Excel file
        const facultyData = [{"rank":"Eng.","name":"Sami Alalwani","jobTitle":"Lecturer","office":"ACX-F139","phone":"NA","email":"hsami@rcjy.edu.sa"},{"rank":"Eng.","name":"Motaz Mohamed Deebes","jobTitle":"Lecturer","office":"ACX-F136","phone":"41896","email":"mdeebes@rcjy.edu.sa;"},{"rank":"Dr.","name":"Ali Abdullah Sayghe","jobTitle":"Assistant Professor","office":"ACX-F66","phone":"41129","email":"sayghea@rcjy.edu.sa;"},{"rank":"Dr.","name":"Abdularahman Hawsawi","jobTitle":"Lecturer","office":"NA","phone":"NA","email":"husawia@rcyci.edu.sa"},{"rank":"Eng.","name":"Mir Masood Zuberi","jobTitle":"Trainer","office":"APX-F30","phone":"41357","email":"mzuberi@rcjy.edu.sa;"},{"rank":"Eng.","name":"Mohammad Istiaq Ahmad","jobTitle":"Lecturer","office":"ACX-F71","phone":"41428","email":"ahmad1@rcjy.edu.sa;"},{"rank":"Eng.","name":"Suresh Kalidas","jobTitle":"Lecturer","office":"ACXF135","phone":"41386","email":"khalidas@rcjy.edu.sa;"},{"rank":"Eng.","name":"Mustajab Ahmad khan","jobTitle":"Lecturer","office":"ACX-F137","phone":"41398","email":"mustajab@rcjy.edu.sa;"},{"rank":"Eng.","name":"Roberto Maximo Cenidoza","jobTitle":"Lecturer","office":"ACX-F62","phone":"41457","email":"cenidozar@rcjy.edu.sa;"},{"rank":"Eng.","name":"Fawwaz Ahmed Ayesh","jobTitle":"Lecturer","office":"APX-F23","phone":"41362","email":"fayesh@rcjy.edu.sa;"},{"rank":"Dr.","name":"Fahad Ahmed Banakhr","jobTitle":"Associate Professor","office":"ACX-F143","phone":"41075","email":"banakhrf@rcjy.edu.sa;"},{"rank":"Dr.","name":"Sameer Alsibiani","jobTitle":"Assistant Professor","office":"APX-F62","phone":"41000","email":"alsibianis1@rcjy.edu.sa;"},{"rank":"Dr.","name":"Adnan Badawood","jobTitle":"Assistant Professor","office":"ACX F31","phone":"41169","email":"Badawood1@rcjy.edu.sa;"},{"rank":"Eng.","name":"Nafea Alenezi","jobTitle":"Lecturer","office":"ACX-F130","phone":"41435","email":"alenezin@rcjy.edu.sa;"},{"rank":"Dr.","name":"Ali Saad Alghamdi","jobTitle":"Assistant Professor","office":"ACX-F04","phone":"41652","email":"alghamdiasg@rcjy.edu.sa;"},{"rank":"Eng.","name":"Shameer A. Koya","jobTitle":"Lecturer","office":"AD-230","phone":"41432","email":"skoya@rcjy.edu.sa;"},{"rank":"Eng.","name":"Girish Ganpatrao Shirsikar","jobTitle":"Lecturer","office":"APX-F19","phone":"41465","email":"gshirsikar@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mohamed Ibrahim Mosaad","jobTitle":"Associate Professor","office":"ACX-F67","phone":"41596","email":"mosaadm@rcjy.edu.sa;"},{"rank":"Eng.","name":"Umasankar","jobTitle":"Lecturer","office":"APX-F25","phone":"41332","email":"aumasankar@rcjy.edu.sa;"},{"rank":"Dr.","name":"Liaqat Hayat","jobTitle":"Assistant Professor","office":"APX-F16","phone":"41200","email":"Liaqat@rcjy.edu.sa;"},{"rank":"Eng.","name":"Muhammed Kutty K.V.","jobTitle":"Trainer","office":"APX-F31","phone":"41368","email":"kuttym@rcjy.edu.sa;"},{"rank":"Dr.","name":"Nabil Saleh Rousan","jobTitle":"Assistant Professor","office":"ACX-F59","phone":"41248","email":"nrousan@rcjy.edu.sa;"},{"rank":"Eng.","name":"Moneer Almalki","jobTitle":"Lecturer","office":"APX-F56","phone":"NA","email":"malkimon@rcjy.gov.sa"},{"rank":"Eng.","name":"Nasir Ayub","jobTitle":"Trainer","office":"ACX-F138","phone":"41373","email":"nasirayub@rcjy.edu.sa;"},{"rank":"Eng.","name":"Shah Jehan","jobTitle":"Trainer","office":"APX-F65","phone":"41429","email":"shahj@rcjy.edu.sa;"},{"rank":"Eng.","name":"Arif Ali Rehman","jobTitle":"Trainer","office":"ACX-F145","phone":"41337","email":"arehman@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ahmed Bahussain","jobTitle":"Trainer","office":"ACX-F65","phone":"41452","email":"abahussain@rcjy.edu.sa;"},{"rank":"Eng.","name":"Abdullah Fawaz Abdullah","jobTitle":"Trainer","office":"YTI-4F07","phone":"41041","email":"afawaz@rcjy.edu.sa;"},{"rank":"Dr.","name":"Yahya Alfadhli","jobTitle":"Assistant Professor","office":"ACX-F134","phone":"41279","email":"fadhli@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mohammed Ahmed M. Azab","jobTitle":"Associate Professor","office":"ACX-F79","phone":"NA","email":"moustafa@rcjy.edu.sa;"},{"rank":"Dr.","name":"Suresh Kumar","jobTitle":"Assistant Professor","office":"APX-F21","phone":"41227","email":"suresh@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ronilo S. Santos","jobTitle":"Trainer","office":"ACX-F69","phone":"41372","email":"rsantos@rcjy.edu.sa;"},{"rank":"Dr.","name":"Abdalla Younes","jobTitle":"Assistant Professor","office":"ACXF146","phone":"41118","email":"younesa@rcjy.edu.sa;"},{"rank":"Dr.","name":"Ahmed Abdul Aziz Alsubhi","jobTitle":"Associate Professor","office":"ACX-F60","phone":"41377","email":"subhi@rcjy.edu.sa;"},{"rank":"Dr.","name":"Adel Mohammed Alturki","jobTitle":"Assistant Professor","office":"ACX-F78","phone":"41507","email":"alturkia@rcjy.edu.sa;"},{"rank":"Dr.","name":"Annamalai Arunagiri","jobTitle":"Assistant Professor","office":"ACXF76","phone":"41365","email":"arunagiria@rcjy.edu.sa;"},{"rank":"Dr.","name":"Bakur AlQaudi","jobTitle":"Assistant Professor","office":"ACX-F140","phone":"41367","email":"Alqaudib@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mohammed Mostafa","jobTitle":"Assistant Professor","office":"ACX-F129","phone":"41225","email":"merg@rcjy.edu.sa;"},{"rank":"Eng.","name":"John A. Acielo","jobTitle":"Trainer","office":"APX-F61","phone":"41361","email":"jacielo@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ali Al-Nahas","jobTitle":"Lecturer","office":"APX-F24","phone":"41129","email":"aleisa@RCJY.EDU.SA;"},{"rank":"Dr.","name":"Mohammed Mousa","jobTitle":"Assistant Professor","office":"ACX-F63","phone":"41379","email":"mousam1@rcjy.edu.sa;"},{"rank":"Dr.","name":"Salem Mohammed Batiyah","jobTitle":"Assistant Professor","office":"ACX-F70","phone":"41356","email":"batiyahs@rcjy.edu.sa;"},{"rank":"Dr.","name":"Musfer AlRadady","jobTitle":"Assistant Professor","office":"ACX-F 72","phone":"41251","email":"AlRadadym@rcjy.edu.sa;"},{"rank":"Eng.","name":"Zainudin Kornain","jobTitle":"Lecturer","office":"ACX-F77","phone":"41436","email":"kornainz@rcjy.edu.sa;"},{"rank":"Dr.","name":"Ayman Khalid Alhejji","jobTitle":"Associate Professor","office":"APX-F54","phone":"41121","email":"alhejjia@rcjy.edu.sa;"},{"rank":"Eng.","name":"Mohammed Sayed","jobTitle":"Lecturer","office":"APX-F66","phone":"NA","email":"sayedm1@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mohamed Mahfouz","jobTitle":"Assistant Professor","office":"ACXF80","phone":"41427","email":"mahfouzm@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mansour Abdullah Aljohani","jobTitle":"Assistant Professor","office":"ACX-F64","phone":"41030","email":"majohani@rcjy.edu.sa;"},{"rank":"Dr.","name":"Mohammed Hussain Mayyan","jobTitle":"Assistant Professor","office":"APX-F20","phone":"41235","email":"mayyan@rcjy.edu.sa;"},{"rank":"Dr.","name":"Yousuf Dawood Almoallem","jobTitle":"Assistant Professor","office":"ACX-F65","phone":"41632","email":"moallemy@rcjy.edu.sa;"},{"rank":"Dr.","name":"Latif Ismael Shaikh","jobTitle":"Assistant Professor","office":"ACX-F68","phone":"41391","email":"lshaikh@rcjy.edu.sa;"},{"rank":"Eng.","name":"Naushaad V. Moosa","jobTitle":"Lecturer","office":"APX-F32","phone":"41369","email":"moosan@rcjy.edu.sa;"},{"rank":"Eng.","name":"Imran Fazal","jobTitle":"Lecturer","office":"APX F67","phone":"41364","email":"Ifazal@rcjy.edu.sa;"},{"rank":"Dr.","name":"Azzeddine Djaiz","jobTitle":"Assistant Professor","office":"ACX-F82","phone":"41385","email":"adjaiz@rcjy.edu.sa;"},{"rank":"Eng.","name":"Loai Abdullah Al-Aswad","jobTitle":"Trainer","office":"APX-F68","phone":"41474","email":"lalaswad@rcjy.edu.sa;"},{"rank":"Eng.","name":"Almahdi Ali Ababneh","jobTitle":"Lecturer","office":"ACX-F61","phone":"41371","email":"aababneh@rcjy.edu.sa;"},{"rank":"Eng.","name":"Omar Alandejani","jobTitle":"Lecturer","office":"ACX-F144","phone":"41381","email":"oalandejani@rcjy.edu.sa;"},{"rank":"Eng.","name":"Bakheet Al-Ghamdi","jobTitle":"Trainer","office":"APX-F28","phone":"41080","email":"bakheetg@rcjy.edu.sa;"},{"rank":"Eng.","name":"Muath Aloufi","jobTitle":"Trainer","office":"ACX-F81","phone":"NA","email":"aloufim@rcjy.edu.sa;"},{"rank":"Eng.","name":"Turki Alsayed","jobTitle":"Lecturer","office":"ACX-F74","phone":"41363","email":"alsayedt@rcjy.edu.sa;"},{"rank":"Eng.","name":"Shakir Alghamdi","jobTitle":"Lecturer","office":"APX-F18","phone":"41383","email":"shakir@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ashfaq Hussain Chaudhry","jobTitle":"Lecturer","office":"YUC/E1-120","phone":"41447","email":"ashfaq@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ahmed Bakht Sultan","jobTitle":"Trainer","office":"ACX-F59","phone":"41192","email":"sultanba@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ahmed Abdallah Saleh Almalki","jobTitle":"Trainer","office":"APX-F22","phone":"41295","email":"malkiaas@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ahmed Abdulkarim Almuagili albalawi","jobTitle":"Trainer","office":"APX-F29","phone":"NA","email":"almuagiliaa@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ibrahim Salem Al Jehef","jobTitle":"Trainer","office":"APX-F33","phone":"NA","email":"juhaifis@rcjy.edu.sa;"},{"rank":"Eng.","name":"Ahmed Mana Alhashel","jobTitle":"Trainer","office":"APX-F53","phone":"4NA","email":"hashela@rcjy.edu.sa;"},{"rank":"Eng.","name":"Omar Alsalamah","jobTitle":"Trainer","office":"APX-F55","phone":"4NA","email":"Salamhom@rcjy.edu.sa;"}];

        // Course data from Excel file
        const coursesData = [{"code":"ELET101","name":"Electric Circuit I"},{"code":"ELET102","name":"Electrical Circuits II"},{"code":"ELET103","name":"Electrical Machines  I"},{"code":"ELET105","name":"Electronics  I"},{"code":"ELET201","name":"Basic Industrial Electronics"},{"code":"ELET 202","name":"Digital Electronics I"},{"code":"ELET203","name":"Control System Components"},{"code":"ELET204","name":"Industrial Electricity"},{"code":"ELET211","name":"Instrumentation Electronics"},{"code":"ELET221","name":"Electrical Installations"},{"code":"ELET222","name":"Electrical Machines  II"},{"code":"ELET230","name":"PCB Fabrication"},{"code":"ELET231","name":"Electronics II"},{"code":"ELET241","name":"Process Instrumentation"},{"code":"ELET212","name":"Microcontroller"},{"code":"ELET 223","name":"Electrical Motor Control"},{"code":"ELET224","name":"Electrical Power Systems"},{"code":"ELET225","name":"Electrical Trbl Shtg & Maint"},{"code":"ELET232","name":"Digital Electronics II"},{"code":"ELET 233","name":"Analog & Digital Comm"},{"code":"ELET234","name":"T-shooting & Maint."},{"code":"ELET235","name":"Telecommunication Systems"},{"code":"ELET242","name":"Process Control Systems"},{"code":"ELET243","name":"Inst T-Shooting & Maint"},{"code":"ELET251","name":"Maint. & Rel. Engg. in Mechat."},{"code":"ELET252","name":"Intro. to Mechat. Sys. Design"},{"code":"ELET320","name":"Co-op Training"},{"code":"ELET330","name":"Co-op Training"},{"code":"ELET340","name":"Co-op Training"},{"code":"ELET350","name":"Co-op Training"},{"code":"EE 291","name":"Electrical Circuits"},{"code":"EE 292","name":"Signals and Systems"},{"code":"EE 293","name":"Electronics"},{"code":"EE 201","name":"Electric Circuit I"},{"code":"EE 202","name":"Electronics I"},{"code":"EE 203","name":"Electronics I Lab"},{"code":"EE 204","name":"Signals and Systems"},{"code":"EE 205","name":"Electrical Circuits II"},{"code":"EE 206","name":"Electric Circuits II Lab"},{"code":"EE 301","name":"Electronics II"},{"code":"EE 302","name":"Electrical Energy Engineering"},{"code":"EE 303","name":"Electrical Energy Engineering Lab"},{"code":"EE 304","name":"Control Engineering"},{"code":"EE 305","name":"Control Engineering Lab"},{"code":"EE 331","name":"Electrical Engineering Principles and Applications"},{"code":"EE 332","name":"Electrical Engineering Principles and Applications Lab"},{"code":"EE 306","name":"Fundamentals of Electrical Engineering Design"},{"code":"EE 307","name":"Communications Engineering"},{"code":"EE 308","name":"Communications Engineering Lab"},{"code":"EE 309","name":"Digital Systems Engineering"},{"code":"EE 310","name":"Digital Systems Engineering Lab"},{"code":"EE 300","name":"Design Project I"},{"code":"EE 401","name":"Electromagnetic Waves and Applications"},{"code":"EE 402","name":"Electromagnetic Waves and Applications Lab"},{"code":"EE 406","name":"Distributed Control System and SCADA"},{"code":"EE 408","name":"Power System Analysis"},{"code":"EE 410","name":"Power Electronics"},{"code":"EE 400","name":"Design Project II"},{"code":"EE 490","name":"INTRENSHIP"}];

        const days = ['SUN', 'MON', 'TUE', 'WED', 'THU'];
        const timeSlots = [
            '07:15-08:05', '08:15-09:05', '09:15-10:05', '10:15-11:05',
            '11:15-12:05', '12:15-13:05', '13:15-14:05', '14:15-15:05',
            '15:15-16:05', '16:15-17:05', '17:15-18:05', '18:15-19:05',
            '19:15-20:05', '20:15-21:05', '21:15-22:05', '22:15-23:05'
        ];
        let scheduleData = {};
        let mergedSessions = {};
        let mergedCells = {}; // Store merged cell data
        let teachingModalData = {
            day: null,
            slot: null,
            courseCode: '',
            type: '',
            location: '',
                transferFlag: false,
            selectedLength: 0,
            selectedCells: []
        };
        let isLocked = false;
        let sessionCounter = 0;
        
        // Dynamic Courses Management
        let courseCounter = 0;
        
        function createCourseRow() {
            courseCounter++;
            
            const row = document.createElement('div');
            row.className = 'course-row';
            row.style.cssText = 'display: flex; align-items: center; gap: 0.5rem;';
            row.dataset.courseNumber = courseCounter;
            
            // Course number label (e.g., "Course #1:")
            const courseLabel = document.createElement('label');
            courseLabel.textContent = `Course #${courseCounter}:`;
            courseLabel.style.cssText = 'font-weight: bold; font-size: 0.8125rem; min-width: 90px;';
            courseLabel.className = 'course-number-label';
            
            // Course code text input (same for all departments)
            const codeInput = document.createElement('input');
            codeInput.type = 'text';
            codeInput.placeholder = 'Course Code';
            codeInput.className = 'course-code-input faculty-input-keep';
            codeInput.style.cssText = 'padding: 0.4rem; font-size: 0.8125rem; border: 1px solid #999 !important; border-radius: 4px; width: 120px; text-transform: uppercase; background: white;';
            
            // Course name input (inline, no label)
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.placeholder = 'Course Name';
            nameInput.className = 'course-name-input faculty-input-keep';
            nameInput.style.cssText = 'padding: 0.4rem; font-size: 0.8125rem; border: 1px solid #999 !important; border-radius: 4px; flex: 1; background: white;';
            
            // Build course code to name mapping from coursesData
            const courseMapping = {};
            coursesData.forEach(course => {
                courseMapping[course.code.toUpperCase()] = course.name;
            });
            
            // Auto-fill course name when code is entered (hidden mapping)
            // If code not found, leave name blank
            codeInput.addEventListener('input', function() {
                const code = this.value.trim().toUpperCase();
                if (courseMapping[code]) {
                    nameInput.value = courseMapping[code];
                } else {
                    nameInput.value = '';
                }
                updateCalculations();
            });
            
            // Also check on blur (when user finishes typing)
            codeInput.addEventListener('blur', function() {
                const code = this.value.trim().toUpperCase();
                if (courseMapping[code]) {
                    nameInput.value = courseMapping[code];
                } else {
                    nameInput.value = '';
                }
            });
            
            // Remove button
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'ios-button ios-button-red';
            removeBtn.style.cssText = 'padding: 4px 8px;';
            removeBtn.innerHTML = `
                <div class="ios-button-icon" style="width: 32px; height: 32px; font-size: 16px;">
                    <span>ðŸ—‘ï¸</span>
                </div>
                <div class="ios-button-label" style="font-size: 10px;">Remove</div>
            `;
            removeBtn.onclick = function() {
                removeCourseRow(row);
            };
            
            row.appendChild(courseLabel);
            row.appendChild(codeInput);
            row.appendChild(nameInput);
            row.appendChild(removeBtn);
            
            return row;
        }
        
        function addCourseRow() {
            const container = document.getElementById('coursesContainer');
            const newRow = createCourseRow();
            container.appendChild(newRow);
            
            // Focus on the code dropdown of the new row
            const codeInput = newRow.querySelector('.course-code-input');
            if (codeInput) {
                codeInput.focus();
            }
        }
        
        function removeCourseRow(row) {
            const container = document.getElementById('coursesContainer');
            // Keep at least one row
            if (container.children.length > 1) {
                row.remove();
                courseCounter--;
                renumberCourses();
                updateCalculations();
            } else {
                alert('At least one course row must remain.');
            }
        }
        
        // Function to renumber all course labels
        function renumberCourses() {
            const container = document.getElementById('coursesContainer');
            const rows = container.querySelectorAll('.course-row');
            rows.forEach((row, index) => {
                const label = row.querySelector('.course-number-label');
                if (label) {
                    label.textContent = `Course #${index + 1}:`;
                    row.dataset.courseNumber = index + 1;
                }
            });
            // Update counter to match actual number of rows
            courseCounter = rows.length;
        }
        
        function initializeCourses() {
            // Reset counter before adding initial course
            courseCounter = 0;
            
            // Add initial course row
            addCourseRow();
            
            // Setup add button event
            document.getElementById('addCourseBtn').addEventListener('click', addCourseRow);
        }
        
        // Hijri date conversion function (approximate)
        function gregorianToHijri(gregorianYear, gregorianMonth) {
            // Approximate conversion: Hijri year â‰ˆ Gregorian year - 578 or -579
            // October 2025 â‰ˆ Hijri 1447
            // This is a simplified approximation for academic years
            const hijriYear = gregorianYear - 578;
            return String(hijriYear); // Return only 4 digits (e.g., "1447")
        }
        
        // Get current academic year in format (XX)
        function getCurrentAcademicCode() {
            const now = new Date();
            const year = now.getFullYear();
            const lastTwoDigits = year % 100;
            return String(lastTwoDigits);
        }
        
        // Auto set current years based on system date
        function autoSetYears() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1; // 1-12
            
            // Determine semester based on month
            // August-December (8-12): First Semester (1)
            // January-May (1-5): Second Semester (2)
            // June-July (6-7): Summer Semester (3)
            let semester = 'First';
            let semesterNumber = 1;
            if (currentMonth >= 1 && currentMonth <= 5) {
                semester = 'Second';
                semesterNumber = 2;
            } else if (currentMonth >= 6 && currentMonth <= 7) {
                semester = 'Summer';
                semesterNumber = 3;
            } else {
                // August-December (8-12)
                semester = 'First';
                semesterNumber = 1;
            }
            
            // Set semester
            document.getElementById('semesterType').value = semester;
            
            // Calculate Hijri year (approximate) - returns 4 digits
            const hijriYear = gregorianToHijri(currentYear, currentMonth);
            document.getElementById('hijriYear').value = hijriYear;
            
            // Calculate TERM CODE: Last 2 digits of Hijri year + semester number
            // Example: Hijri year 1446 + First semester (1) = 461
            const hijriLastTwoDigits = parseInt(hijriYear.slice(-2));
            const termCode = hijriLastTwoDigits + '' + semesterNumber;
            document.getElementById('gregorianCode').value = termCode;
            
            updateSemesterDisplay();
        }
        
        // Update the semester display
        function updateSemesterDisplay() {
            const semester = document.getElementById('semesterType').value;
            const hijriYear = document.getElementById('hijriYear').value;
            const gregCode = document.getElementById('gregorianCode').value;
            
            let displayText = `${semester} Semester`;
            if (hijriYear) {
                displayText += ` ${hijriYear}`;
            }
            if (gregCode) {
                displayText += `(${gregCode})`;
            }
            
            document.getElementById('semesterYearDisplay').textContent = displayText;
        }
        
        // Function to populate faculty dropdown
        function populateFacultyDropdown() {
            const facultySelect = document.getElementById('facultyName');
            if (!facultySelect || facultySelect.tagName !== 'SELECT') return;
            
            // Clear existing options except the first two (-- Select Faculty -- and Other...)
            while (facultySelect.options.length > 2) {
                facultySelect.remove(2);
            }
            
            // Sort faculty by name (English names now)
            const sortedFaculty = [...facultyData].sort((a, b) => a.name.localeCompare(b.name, 'en'));
            
            // Add faculty options
            sortedFaculty.forEach(faculty => {
                const option = document.createElement('option');
                option.value = faculty.name;
                option.textContent = faculty.name;
                facultySelect.appendChild(option);
            });
        }
        
        // Function to attach faculty change listener (can be called after recreating the field)
        function attachFacultyChangeListener() {
            const facultySelect = document.getElementById('facultyName');
            if (facultySelect && facultySelect.tagName === 'SELECT') {
                facultySelect.addEventListener('change', function() {
                    const selectedName = this.value;
                    if (selectedName) {
                        const faculty = facultyData.find(f => f.name === selectedName);
                        if (faculty) {
                            // Auto-fill the fields from Excel data
                            document.getElementById('facultyRank').value = faculty.rank || '';
                            document.getElementById('email').value = faculty.email || '';
                            document.getElementById('phone').value = faculty.phone || '';
                            document.getElementById('officeLocation').value = faculty.office || '';
                        }
                    } else {
                        // Clear fields if no selection
                        document.getElementById('facultyRank').value = '';
                        document.getElementById('email').value = '';
                        document.getElementById('phone').value = '';
                        document.getElementById('officeLocation').value = '';
                    }
                });
            }
        }
        
        // Update the department display
        function updateDepartmentDisplay() {
            const department = document.getElementById('departmentSelect').value;
            
            // Update header department name
            const departmentHeader = document.getElementById('departmentHeader');
            if (departmentHeader) {
                departmentHeader.textContent = `${department} Department`;
            }
            
            // No need to switch faculty name field - it's now a simple text input for all departments
            // Just re-attach the handler to ensure uppercase and sync work
            attachFacultyOtherHandler();
            
            // Recreate all existing course rows to match new department
            const coursesContainer = document.getElementById('coursesContainer');
            if (coursesContainer && coursesContainer.children.length > 0) {
                // Save existing course data
                const existingCourses = [];
                const courseRows = coursesContainer.querySelectorAll('.course-row');
                courseRows.forEach(row => {
                    const codeInput = row.querySelector('.course-code-input');
                    const nameInput = row.querySelector('.course-name-input');
                    existingCourses.push({
                        code: codeInput ? codeInput.value : '',
                        name: nameInput ? nameInput.value : ''
                    });
                });
                
                // Clear container
                coursesContainer.innerHTML = '';
                
                // Reset counter
                courseCounter = 0;
                
                // Recreate rows with new input types
                existingCourses.forEach(course => {
                    const newRow = createCourseRow();
                    const codeInput = newRow.querySelector('.course-code-input');
                    const nameInput = newRow.querySelector('.course-name-input');
                    
                    // Restore values
                    if (codeInput) codeInput.value = course.code;
                    if (nameInput) nameInput.value = course.name;
                    
                    coursesContainer.appendChild(newRow);
                });
            }
        }
        
        // Initialize schedule
        function initSchedule() {
            const tbody = document.getElementById('scheduleBody');
            
            days.forEach((day) => {
                scheduleData[day] = {};
                const tr = document.createElement('tr');
                
                // Day cell
                const dayCell = document.createElement('td');
                dayCell.className = 'day-cell';
                dayCell.textContent = day;
                tr.appendChild(dayCell);
                
                // Time slots (16 slots)
                for (let slot = 0; slot < 16; slot++) {
                    const td = document.createElement('td');
                    td.className = 'schedule-cell';
                    td.id = `cell-${day}-${slot}`;
                    td.dataset.day = day;
                    td.dataset.slot = slot;
                    td.dataset.time = timeSlots[slot];
                    
                    // All slots are now regular editable slots
                    createCellContent(td, day, slot);
                    
                    tr.appendChild(td);
                }
                
                tbody.appendChild(tr);
            });
            
            updateCalculations();
        }
        
        function createCellContent(td, day, slot) {
            // Add checkbox for merge mode
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'cell-checkbox';
            checkbox.dataset.day = day;
            checkbox.dataset.slot = slot;
            checkbox.onchange = function() {
                if (this.checked) {
                    td.classList.add('cell-selected');
                } else {
                    td.classList.remove('cell-selected');
                }
            };
            td.appendChild(checkbox);
            
            const cellContent = document.createElement('div');
            cellContent.className = 'cell-content';
            
            // Type selector
            const select = document.createElement('select');
            select.className = 'type-selector';
            select.innerHTML = `
                <option value="">TYPE</option>
                <option value="TEACHING">TEACHING</option>
                <option value="BREAK">BREAK</option>
                <option value="CH">CH</option>
                <option value="OH">OH</option>
                <option value="ACTIVITY">ACTIVITY</option>
            `;
            select.onchange = function() {
                handleTypeChange(day, slot, this.value, cellContent);
            };
            
            // Teaching fields container
            const teachingFields = document.createElement('div');
            teachingFields.className = 'teaching-fields';
            
            // Session length selector
            const lengthSelector = document.createElement('div');
            lengthSelector.className = 'session-length-selector';
            
            for (let len = 1; len <= 4; len++) {
                const btn = document.createElement('button');
                btn.className = 'length-btn';
                btn.textContent = len + 'h';
                btn.dataset.length = len;
                if (len === 1) btn.classList.add('active');
                btn.onclick = function() {
                    lengthSelector.querySelectorAll('.length-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                };
                lengthSelector.appendChild(btn);
            }
            
            // Header with cancel button
            const teachingHeader = document.createElement('div');
            teachingHeader.className = 'teaching-header';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn-cancel';
            cancelBtn.textContent = 'âœ•';
            cancelBtn.onclick = function() {
                cancelTeaching(day, slot, cellContent);
            };
            
            teachingHeader.appendChild(cancelBtn);
            
            // Course code input
            const courseInput = document.createElement('input');
            courseInput.type = 'text';
            courseInput.placeholder = 'Course Code';
            courseInput.className = 'course-input';
            
            // Type input (lecture/lab/tutorial)
            const typeInput = document.createElement('input');
            typeInput.type = 'text';
            typeInput.placeholder = 'Type (Lec/Lab/Tut)';
            typeInput.className = 'type-input';
            
            // Location input
            const locationInput = document.createElement('input');
            locationInput.type = 'text';
            locationInput.placeholder = 'Location';
            locationInput.className = 'location-input';
            
            // Apply button
            const applyBtn = document.createElement('button');
            applyBtn.className = 'length-btn';
            applyBtn.textContent = 'Apply';
            applyBtn.style.width = '100%';
            applyBtn.onclick = function() {
                const selectedLength = lengthSelector.querySelector('.length-btn.active').dataset.length;
                applyTeachingSession(day, slot, parseInt(selectedLength), courseInput.value, typeInput.value, locationInput.value);
            };
            
            teachingFields.appendChild(lengthSelector);
            teachingFields.appendChild(teachingHeader);
            teachingFields.appendChild(courseInput);
            teachingFields.appendChild(typeInput);
            teachingFields.appendChild(locationInput);
            teachingFields.appendChild(applyBtn);
            
            // Simple display for NS, OH, CH
            const simpleDisplay = document.createElement('div');
            simpleDisplay.className = 'simple-display';
            
            const simpleCancelBtn = document.createElement('button');
            simpleCancelBtn.className = 'simple-cancel';
            simpleCancelBtn.textContent = 'âœ•';
            simpleCancelBtn.onclick = function() {
                cancelSelection(day, slot, cellContent);
            };
            
            simpleDisplay.appendChild(simpleCancelBtn);
            
            // Activity display
            const activityDisplay = document.createElement('div');
            activityDisplay.className = 'activity-display';
            
            const activityCancelBtn = document.createElement('button');
            activityCancelBtn.className = 'simple-cancel';
            activityCancelBtn.textContent = 'âœ•';
            activityCancelBtn.onclick = function() {
                cancelSelection(day, slot, cellContent);
            };
            
            const activitySelect = document.createElement('select');
            activitySelect.className = 'activity-select';
            activitySelect.innerHTML = `
                <option value="">SELECT ACTIVITY</option>
                <option value="PC">PC</option>
                <option value="PAEC">PAEC</option>
                <option value="DAC">DAC</option>
                <option value="DAQC">DAQC</option>
                <option value="DASC">DASC</option>
                <option value="CUSTOM">CUSTOM (Enter Your Own)</option>
            `;
            activitySelect.onchange = function() {
                if (this.value === 'CUSTOM') {
                    showCustomActivityInput(day, slot, activityDisplay);
                } else {
                    updateActivityDisplay(day, slot, this.value, activityDisplay);
                }
            };
            
            activityDisplay.appendChild(activityCancelBtn);
            activityDisplay.appendChild(activitySelect);
            
            // Type selector removed - only checkbox remains visible for universal selector
            cellContent.appendChild(teachingFields);
            cellContent.appendChild(simpleDisplay);
            cellContent.appendChild(activityDisplay);
            td.appendChild(cellContent);
        }
        

        function applyTeachingSession(day, startSlot, length, courseCode, type, location) {
            if (!courseCode) {
                alert('Please enter a course code');
                return;
            }
            
            // Check if we have enough slots
            if (startSlot + length > 16) {
                alert('Not enough time slots available');
                return;
            }
            
            // Check if any slot is occupied
            for (let i = 0; i < length; i++) {
                const checkSlot = startSlot + i;
                const cell = document.getElementById(`cell-${day}-${checkSlot}`);
                if (cell.classList.contains('cell-merged-occupied') || cell.dataset.sessionId) {
                    alert('Some slots are already occupied');
                    return;
                }
            }
            
            const sessionId = `session-${sessionCounter++}`;
            
            mergedSessions[sessionId] = {
                day: day,
                startSlot: startSlot,
                length: length,
                courseCode: courseCode,
                type: type,
                location: location
            };
            
            const firstCell = document.getElementById(`cell-${day}-${startSlot}`);
            const lastCell = document.getElementById(`cell-${day}-${startSlot + length - 1}`);
            const firstRect = firstCell.getBoundingClientRect();
            const lastRect = lastCell.getBoundingClientRect();
            const totalWidth = Math.round(lastRect.right - firstRect.left);

            const mergedDiv = document.createElement('div');
            mergedDiv.className = 'merged-teaching';
            mergedDiv.id = sessionId;
            mergedDiv.style.width = Math.round(totalWidth) + 'px';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn-cancel';
            cancelBtn.textContent = 'âœ•';
            cancelBtn.style.position = 'absolute';
            cancelBtn.style.top = '3px';
            cancelBtn.style.right = '3px';
            cancelBtn.style.zIndex = '100';
            cancelBtn.onclick = function(e) {
                e.stopPropagation();
                deleteMergedSession(sessionId);
            };
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'cell-content';
            
            let baseFontSize = length >= 3 ? 12 : 11;
            
            contentDiv.innerHTML = `
                <div style="font-weight: bold; font-size: ${baseFontSize + 2}px;">${courseCode.toUpperCase()}</div>
                <div style="font-size: ${baseFontSize}px;">${type.toUpperCase()}</div>
                <div style="font-size: ${baseFontSize - 1}px; color: #555;">${location.toUpperCase()}</div>
            `;
            
                        // Add resize handle
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            resizeHandle.onmousedown = function(e){ startResizeSession(e, sessionId); };
            mergedDiv.appendChild(cancelBtn);
            mergedDiv.appendChild(contentDiv);
            mergedDiv.appendChild(resizeHandle);
            firstCell.appendChild(mergedDiv);
            
            for (let i = 0; i < length; i++) {
                const cell = document.getElementById(`cell-${day}-${startSlot + i}`);
                cell.dataset.sessionId = sessionId;
                if (i > 0) {
                    cell.classList.add('cell-merged-occupied');
                }
            }
            
            const cellContent = firstCell.querySelector('.cell-content:not(.merged-teaching .cell-content)');
            if (cellContent) {
                cellContent.classList.remove('teaching-mode');
                const selector = cellContent.querySelector('.type-selector');
                if (selector) {
                    selector.value = '';
                    selector.classList.remove('selected');
                }
            }
            
            updateCalculations();
        }
        
        function deleteMergedSession(sessionId) {
            if (isLocked) return;
            
            const session = mergedSessions[sessionId];
            if (!session) return;
            
            const { day, startSlot, length } = session;
            
            const mergedElement = document.getElementById(sessionId);
            if (mergedElement) {
                mergedElement.remove();
            }
            
            for (let i = 0; i < length; i++) {
                const cell = document.getElementById(`cell-${day}-${startSlot + i}`);
                if (cell) {
                    delete cell.dataset.sessionId;
                    delete cell.dataset.breakCovered;
                    cell.classList.remove('cell-merged-occupied');
                    cell.classList.remove('cell-merged-first');
                    cell.classList.remove('cell-merged-last');
                    // Reset background color to original white/transparent
                    cell.style.backgroundColor = '';
                }
            }
            
            delete mergedSessions[sessionId];
            
            updateCalculations();
        }
        
        function handleTypeChange(day, slot, type, cellContent) {
            const cell = document.getElementById(`cell-${day}-${slot}`);
            
            if (cell.dataset.sessionId) {
                alert('This slot is part of an existing session. Please delete that session first.');
                const selector = cellContent.querySelector('.type-selector');
                if (selector) selector.value = '';
                return;
            }
            
            // UNIFIED MODAL APPROACH - Open unified modal for ALL types
            if (type && type !== '') {
                // Determine the activity type for the unified modal
                let activityType = type;
                
                // Map old types to unified types
                if (type === 'TEACHING' || type === 'TRANSFER_KNOWLEDGE') {
                    activityType = 'TEACHING';
                }
                
                // Open unified modal with pre-selected activity type
                openUnifiedModalWithType(day, slot, activityType);
                
                // Reset the selector
                const selector = cellContent.querySelector('.type-selector');
                if (selector) selector.value = '';
            }
        }
        
        // Helper function to open unified modal with pre-selected type
        function openUnifiedModalWithType(day, slot, activityType) {
            openUnifiedModal(day, slot, null);
            
            // Pre-select the activity type
            setTimeout(() => {
                document.getElementById('unifiedActivityType').value = activityType;
                onUnifiedActivityTypeChange();
            }, 50);
        }
        
        function updateActivityDisplay(day, slot, activityType, activityDisplay) {
            if (!activityType) return;
            
            const cancelBtn = activityDisplay.querySelector('.simple-cancel');
            activityDisplay.innerHTML = '';
            
            const activityLabel = document.createElement('div');
            activityLabel.className = 'activity-label';
            activityLabel.textContent = activityType;
            
            const newCancelBtn = document.createElement('button');
            newCancelBtn.className = 'simple-cancel';
            newCancelBtn.textContent = 'âœ•';
            newCancelBtn.onclick = function() {
                const cellContent = activityDisplay.parentElement;
                cancelSelection(day, slot, cellContent);
            };
            
            activityDisplay.appendChild(newCancelBtn);
            activityDisplay.appendChild(activityLabel);
            
            if (scheduleData[day]) {
                scheduleData[day][slot] = { type: 'ACTIVITY', activityType: activityType };
            }
            
            updateCalculations();
        }
        
        function cancelTeaching(day, slot, cellContent) {
            cancelSelection(day, slot, cellContent);
        }
        
        function cancelSelection(day, slot, cellContent) {
            if (isLocked) return;
            
            const cell = document.getElementById(`cell-${day}-${slot}`);
            
            const courseInput = cellContent.querySelector('.course-input');
            const typeInput = cellContent.querySelector('.type-input');
            const locationInput = cellContent.querySelector('.location-input');
            const selector = cellContent.querySelector('.type-selector');
            const simpleDisplay = cellContent.querySelector('.simple-display');
            const activityDisplay = cellContent.querySelector('.activity-display');
            
            if (courseInput) courseInput.value = '';
            if (typeInput) typeInput.value = '';
            if (locationInput) locationInput.value = '';
            if (selector) {
                selector.value = '';
                selector.classList.remove('selected');
                selector.style.display = ''; // show dropdown again when cleared
            }
            if (simpleDisplay) {
                const cancelBtn = simpleDisplay.querySelector('.simple-cancel');
                simpleDisplay.textContent = '';
                if (cancelBtn) simpleDisplay.appendChild(cancelBtn);
            }
            if (activityDisplay) {
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'simple-cancel';
                cancelBtn.textContent = 'âœ•';
                cancelBtn.onclick = function() {
                    cancelSelection(day, slot, cellContent);
                };
                
                const activitySelect = document.createElement('select');
                activitySelect.className = 'activity-select';
                activitySelect.innerHTML = `
                    <option value="">SELECT ACTIVITY</option>
                    <option value="PC">PC</option>
                    <option value="PAEC">PAEC</option>
                    <option value="DAC">DAC</option>
                    <option value="DAQC">DAQC</option>
                    <option value="DASC">DASC</option>
                `;
                activitySelect.onchange = function() {
                    updateActivityDisplay(day, slot, this.value, activityDisplay);
                };
                
                activityDisplay.innerHTML = '';
                activityDisplay.appendChild(cancelBtn);
                activityDisplay.appendChild(activitySelect);
            }
            
            cellContent.classList.remove('teaching-mode', 'simple-mode', 'activity-mode');
            cell.classList.remove('filled-cell');
            
            // Remove all type-* classes to reset background color
            cell.className = cell.className.replace(/type-\w+/g, '');
            
            // Reset background color to original white/transparent
            cell.style.backgroundColor = '';
            
            if (scheduleData[day]) {
                delete scheduleData[day][slot];
            }
            
            updateCalculations();
        }
        
        function toggleLock() {
            isLocked = !isLocked;
            const container = document.querySelector('.container');
            const lockBtn = document.querySelector('.btn-lock');
            const exportBtn = document.querySelector('.btn-export');
            
            if (isLocked) {
                container.classList.add('schedule-locked');
                lockBtn.classList.add('locked');
                lockBtn.innerHTML = '<span style="font-size: 1.1rem;">ðŸ”’</span> Unlock';
                
                // Show Export button when locked
                if (exportBtn) {
                    exportBtn.style.display = 'flex';
                }
                
                // Apply the lock state (shared helper)
                applyLockState();
                
// Hide detailed cell content so only the locked text shows
document.querySelectorAll('.cell-content').forEach(content => {
    // Skip merged teaching blocks (they show course info instead of selector text)
    if (content.closest('.merged-cell')) return;

    // DO NOT hide simple-display - it should remain visible when locked to show NS/OH/CH/BREAK
    // DO NOT hide activity-display - it should remain visible when locked to show ACTIVITY

    const teach = content.querySelector('.teaching-fields');
    if (teach) teach.setAttribute('data-hidden-by-lock', 'true');
    if (teach) teach.style.display = 'none';
});
                // Disable ALL buttons except Lock, Export PDF, and Export Excel
                document.querySelectorAll('button').forEach(btn => {
                    if (!btn.classList.contains('btn-lock') && 
                        !btn.classList.contains('btn-export')) {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                        btn.style.cursor = 'not-allowed';
                    }
                });
                
                // Hide all checkboxes
                document.querySelectorAll('.cell-checkbox').forEach(cb => {
                    cb.style.display = 'none';
                });
                
                // Disable merged cell editing
                document.querySelectorAll('.merged-cell-content').forEach(content => {
                    content.onclick = null;
                    content.style.cursor = 'default';
                });
                
                // Hide all unmerge/delete buttons
                document.querySelectorAll('.btn-cancel').forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // Hide course management buttons
                const addCourseBtn = document.getElementById('addCourseBtn');
                if (addCourseBtn) {
                    addCourseBtn.style.display = 'none';
                }
                document.querySelectorAll('.course-row button').forEach(btn => {
                    btn.style.display = 'none';
                });
                
                // Hide Save, Load, and Clear buttons when locked (keep Lock and Export visible)
                const actionButtons = document.getElementById('actionButtons');
                if (actionButtons) {
                    const buttons = actionButtons.querySelectorAll('button');
                    buttons.forEach(btn => {
                        if (!btn.classList.contains('btn-lock') && !btn.classList.contains('btn-export')) {
                            btn.style.display = 'none';
                        }
                    });
                }
                
            } else {
                container.classList.remove('schedule-locked');
                lockBtn.classList.remove('locked');
                lockBtn.innerHTML = '<span style="font-size: 1.1rem;">ðŸ“„</span> Export to PDF';
                
                // Hide Export button when unlocked
                if (exportBtn) {
                    exportBtn.style.display = 'none';
                }
                
                // Remove all text replacements and restore input fields
                document.querySelectorAll('.locked-text-replacement').forEach(span => {
                    span.remove();
                });
                
                document.querySelectorAll('input[data-replaced-by-lock="true"]').forEach(input => {
                    input.style.display = '';
                    input.removeAttribute('data-replaced-by-lock');
                });
                
                document.querySelectorAll('select[data-replaced-by-lock="true"]').forEach(select => {
                    select.style.display = '';
                    select.removeAttribute('data-replaced-by-lock');
                });
                
                
// Restore previously hidden cell content
document.querySelectorAll('.cell-content').forEach(content => {
    const simple = content.querySelector('.simple-display');
    if (simple && simple.getAttribute('data-hidden-by-lock') === 'true') {
        simple.style.display = '';
        simple.removeAttribute('data-hidden-by-lock');
    }

    const activity = content.querySelector('.activity-display');
    if (activity && activity.getAttribute('data-hidden-by-lock') === 'true') {
        activity.style.display = '';
        activity.removeAttribute('data-hidden-by-lock');
    }

    const teach = content.querySelector('.teaching-fields');
    if (teach && teach.getAttribute('data-hidden-by-lock') === 'true') {
        teach.style.display = '';
        teach.removeAttribute('data-hidden-by-lock');
    }
});
                // Enable ALL buttons
                document.querySelectorAll('button').forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '';
                    btn.style.cursor = '';
                });
                
                // Re-enable merged cell editing
                document.querySelectorAll('.merged-cell-content').forEach(content => {
                    const cell = content.closest('.merged-cell');
                    if (cell) {
                        const cellId = cell.id.replace('cell-', '');
                        const parts = cellId.split('-');
                        const day = parts[0];
                        const slot = parseInt(parts[1]);
                        content.onclick = function() {
                            editMergedCell(cell, day, slot);
                        };
                        content.style.cursor = 'pointer';
                    }
                });
                
                // Show all unmerge/delete buttons
                document.querySelectorAll('.btn-cancel').forEach(btn => {
                    btn.style.display = '';
                });
                
                // Show course management buttons
                const addCourseBtn = document.getElementById('addCourseBtn');
                if (addCourseBtn) {
                    addCourseBtn.style.display = '';
                }
                document.querySelectorAll('.course-row button').forEach(btn => {
                    btn.style.display = '';
                });
                
                // Show all action buttons when unlocked
                const actionButtons = document.getElementById('actionButtons');
                if (actionButtons) {
                    const buttons = actionButtons.querySelectorAll('button');
                    buttons.forEach(btn => {
                        btn.style.display = 'flex';
                    });
                }
            }
        }
        
        function updateCalculations() {
            let teachingCount = 0;
            let nsCount = 0;
            let chCount = 0;
            let ohCount = 0;
            let internalCount = 0; // PC, DAC, DAQC, DASC, PEAC, CUSTOM
            
            // Count hours from merged sessions BY ACTIVITY TYPE
            Object.values(mergedSessions).forEach(session => {
                const length = session.length;
                const activityType = session.activityType;
                
                if (activityType === 'TEACHING') {
                    teachingCount += length;
                } else if (activityType === 'NS') {
                    nsCount += length;
                } else if (activityType === 'CH') {
                    chCount += length;
                } else if (activityType === 'OH') {
                    ohCount += length;
                } else if (activityType === 'ACTIVITY') {
                    internalCount += length;
                }
                // BREAK is not counted in any category
            });
            
            // Count hours from old merged cells system (TEACHING only - legacy)
            Object.values(mergedCells).forEach(merged => {
                teachingCount += merged.colspan;
            });
            
            // Count hours from individual cells (scheduleData)
            days.forEach(day => {
                for (let slot = 0; slot < 16; slot++) {
                    const cell = document.getElementById(`cell-${day}-${slot}`);
                    if (!cell) continue;
                    
                    // Skip hidden cells (part of merged cells)
                    if (cell.style.display === 'none') continue;
                    
                    // Skip if it's a merged cell (already counted above)
                    if (cell.hasAttribute('data-merged')) continue;
                    
                    // Skip if cell has a session ID (already counted in mergedSessions)
                    if (cell.dataset.sessionId) continue;
                    
                    // Use scheduleData to get cell type
                    if (!scheduleData[day] || !scheduleData[day][slot]) continue;
                    
                    const type = scheduleData[day][slot].type;
                    
                    // Skip BREAK - it doesn't count towards any hours
                    if (type === 'BREAK') {
                        continue;
                    }
                    
                    // Count by type
                    if (type === 'TEACHING') {
                        teachingCount++;
                    } else if (type === 'NS') {
                        nsCount++;
                    } else if (type === 'CH') {
                        chCount++;
                    } else if (type === 'OH') {
                        ohCount++;
                    } else if (type === 'ACTIVITY') {
                        // All ACTIVITY types count as internal activity
                        internalCount++;
                    }
                }
            });
            
            // Count courses from the course grid
            const courseCodeInputs = document.querySelectorAll('.course-code-input');
            let courseCount = 0;
            courseCodeInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    courseCount++;
                }
            });
            
            // FORMULAS AS SPECIFIED:
            // Total Non Teaching Duties Hours = OH + NS + Internal Activity
            const nonTeachingDuties = ohCount + nsCount + internalCount;
            
            // Total Weekly Hours = NS + OH + Teaching + Internal Activities (CH EXCLUDED)
            const totalWeekly = nsCount + ohCount + teachingCount + internalCount;
            
            // Update display
            document.getElementById('teachingHours').textContent = teachingCount;
            document.getElementById('nsHours').textContent = nsCount;
            document.getElementById('chHours').textContent = chCount;
            document.getElementById('officeHours').textContent = ohCount;
            document.getElementById('numCourses').textContent = courseCount;
            document.getElementById('internalActivity').textContent = internalCount;
            document.getElementById('nonTeachingHours').textContent = nonTeachingDuties;
            document.getElementById('totalWeekly').textContent = totalWeekly;
            
            // Check if we need to hide/show columns based on total hours
            checkAndApplyColumnOptimization(totalWeekly);
        }
        
        // ========== COLUMN HIDING & RESIZING SYSTEM ==========
        
        function checkAndApplyColumnOptimization(totalHours) {
            if (totalHours === 40) {
                hideTrailingEmptyColumns();
            } else {
                showAllColumns();
            }
        }
        
        function hideTrailingEmptyColumns() {
            const table = document.querySelector('.schedule-table');
            if (!table) return;
            
            // Find the last non-empty column
            let lastNonEmptyColumn = -1;
            
            for (let col = 0; col < 16; col++) {
                let hasContent = false;
                
                // Check all days for this time slot
                days.forEach(day => {
                    const cell = document.getElementById(`cell-${day}-${col}`);
                    if (!cell) return;
                    
                    // Check if cell has content or is part of a merged session
                    if (cell.dataset.sessionId || 
                        cell.classList.contains('cell-merged-first') ||
                        cell.classList.contains('cell-merged-occupied') ||
                        (scheduleData[day] && scheduleData[day][col])) {
                        hasContent = true;
                    }
                });
                
                if (hasContent) {
                    lastNonEmptyColumn = col;
                }
            }
            
            // Hide columns after the last non-empty one
            const headerRow = table.querySelector('thead tr');
            const allRows = table.querySelectorAll('tr');
            
            allRows.forEach(row => {
                const cells = row.querySelectorAll('th, td');
                cells.forEach((cell, index) => {
                    // Skip the day header column (index 0)
                    if (index === 0) return;
                    
                    const columnIndex = index - 1; // Adjust for day header
                    
                    if (columnIndex > lastNonEmptyColumn) {
                        cell.style.display = 'none';
                    } else {
                        cell.style.display = '';
                    }
                });
            });
            
            // Add class to optimize column widths
            table.classList.add('columns-optimized');
            
            // Reflow merged sessions after column changes
            setTimeout(() => {
                reflowMergedSessions();
            }, 100);
        }
        
        function showAllColumns() {
            const table = document.querySelector('.schedule-table');
            if (!table) return;
            
            const allRows = table.querySelectorAll('tr');
            
            allRows.forEach(row => {
                const cells = row.querySelectorAll('th, td');
                cells.forEach(cell => {
                    cell.style.display = '';
                });
            });
            
            table.classList.remove('columns-optimized');
            
            // Reflow merged sessions after column changes
            setTimeout(() => {
                reflowMergedSessions();
            }, 100);
        }
        
        // Override print functionality to always hide trailing columns
        window.addEventListener('beforeprint', function() {
            // Lock the schedule (hides all edit buttons)
            document.body.classList.add('schedule-locked');
            
            // FORCEFULLY hide the faculty pen button
            const facultyPen = document.getElementById('toggleFacultyBtn');
            if (facultyPen) {
                facultyPen.style.display = 'none';
                facultyPen.style.visibility = 'hidden';
                facultyPen.style.opacity = '0';
                facultyPen.style.width = '0';
                facultyPen.style.height = '0';
                facultyPen.style.position = 'absolute';
                facultyPen.style.left = '-9999px';
            }
            
            // Hide ALL buttons as backup
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(btn => {
                btn.style.display = 'none';
                btn.style.visibility = 'hidden';
            });
            
            hideTrailingEmptyColumns();
            // Give browser time to apply column hiding before recalculating widths
            setTimeout(() => {
                reflowMergedSessions();
            }, 50);
        });
        
        window.addEventListener('afterprint', function() {
            // Unlock the schedule
            document.body.classList.remove('schedule-locked');
            
            // Restore the faculty pen button
            const facultyPen = document.getElementById('toggleFacultyBtn');
            if (facultyPen) {
                facultyPen.style.display = '';
                facultyPen.style.visibility = '';
                facultyPen.style.opacity = '';
                facultyPen.style.width = '';
                facultyPen.style.height = '';
                facultyPen.style.position = '';
                facultyPen.style.left = '';
            }
            
            // Restore ALL buttons
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(btn => {
                btn.style.display = '';
                btn.style.visibility = '';
            });
            
            // Check current total and restore appropriate state
            const totalWeekly = parseInt(document.getElementById('totalWeekly').textContent) || 0;
            if (totalWeekly !== 40) {
                showAllColumns();
            }
        });
        
        // Save and Load Schedule Functions
        function saveSchedule() {
            try {
                // Helper function to safely get value
                const getValue = (id) => {
                    const elem = document.getElementById(id);
                    return elem ? elem.value : '';
                };
                
                const saveData = {
                    // Faculty Info
                    facultyName: getValue('facultyName'),
                    email: getValue('email'),
                    officeLocation: getValue('officeLocation'),
                    phone: getValue('phone'),
                    
                    // Approval Info
                    instructorAckName: getValue('instructorAckName'),
                    instructorAckDate: getValue('instructorAckDate'),
                    hodName: getValue('hodName'),
                    hodDate: getValue('hodDate'),
                    
                    // Semester Info
                    semester: getValue('semesterSelect'),
                    gregorianYear: getValue('gregorianYear'),
                    hijriYear: getValue('hijriYear'),
                    department: getValue('departmentSelect'),
                    
                    // Courses
                    courses: [],
                    
                    // Schedule Data (deep copy to avoid circular references)
                    scheduleData: JSON.parse(JSON.stringify(scheduleData || {})),
                    
                    // Merged Sessions (deep copy)
                    mergedSessions: JSON.parse(JSON.stringify(mergedSessions || {})),
                    mergedCells: JSON.parse(JSON.stringify(mergedCells || {})),
                    
                    // Timestamp
                    savedAt: new Date().toISOString()
                };
                
                // Get all courses
                document.querySelectorAll('.course-row').forEach(row => {
                    const codeInput = row.querySelector('.course-code-input');
                    const nameInput = row.querySelector('.course-name-input');
                    if (codeInput && nameInput) {
                        saveData.courses.push({
                            code: codeInput.value || '',
                            name: nameInput.value || ''
                        });
                    }
                });
                
                // Save to localStorage with default key
                localStorage.setItem('instructorSchedule', JSON.stringify(saveData));
                
                // Show success message
                alert('âœ… Schedule saved successfully!\n\nYou can now close the page and come back later.\nClick "Load" to restore your work.');
                
            } catch (error) {
                console.error('Error saving schedule:', error);
                alert('âŒ Error saving schedule: ' + error.message);
            }
        }
        
        function saveScheduleAs() {
            try {
                // Prompt for save name
                const saveName = prompt('Enter a name for this save:\n\n(e.g., "Fall 2025", "Draft v2", "Final Version")', '');
                
                if (!saveName) {
                    return; // User cancelled
                }
                
                if (saveName.trim() === '') {
                    alert('âŒ Save name cannot be empty.');
                    return;
                }
                
                // Helper function to safely get value
                const getValue = (id) => {
                    const elem = document.getElementById(id);
                    return elem ? elem.value : '';
                };
                
                const saveData = {
                    // Save metadata
                    saveName: saveName.trim(),
                    
                    // Faculty Info
                    facultyName: getValue('facultyName'),
                    email: getValue('email'),
                    officeLocation: getValue('officeLocation'),
                    phone: getValue('phone'),
                    
                    // Approval Info
                    instructorAckName: getValue('instructorAckName'),
                    instructorAckDate: getValue('instructorAckDate'),
                    hodName: getValue('hodName'),
                    hodDate: getValue('hodDate'),
                    
                    // Semester Info
                    semester: getValue('semesterSelect'),
                    gregorianYear: getValue('gregorianYear'),
                    hijriYear: getValue('hijriYear'),
                    department: getValue('departmentSelect'),
                    
                    // Courses
                    courses: [],
                    
                    // Schedule Data (deep copy to avoid circular references)
                    scheduleData: JSON.parse(JSON.stringify(scheduleData || {})),
                    
                    // Merged Sessions (deep copy)
                    mergedSessions: JSON.parse(JSON.stringify(mergedSessions || {})),
                    mergedCells: JSON.parse(JSON.stringify(mergedCells || {})),
                    
                    // Timestamp
                    savedAt: new Date().toISOString()
                };
                
                // Get all courses
                document.querySelectorAll('.course-row').forEach(row => {
                    const codeInput = row.querySelector('.course-code-input');
                    const nameInput = row.querySelector('.course-name-input');
                    if (codeInput && nameInput) {
                        saveData.courses.push({
                            code: codeInput.value || '',
                            name: nameInput.value || ''
                        });
                    }
                });
                
                // Create unique key for this save
                const saveKey = 'instructorSchedule_' + saveName.trim().replace(/[^a-zA-Z0-9]/g, '_');
                
                // Save to localStorage
                localStorage.setItem(saveKey, JSON.stringify(saveData));
                
                // Update saves list
                let savesList = JSON.parse(localStorage.getItem('instructorSchedules_list') || '[]');
                if (!savesList.includes(saveKey)) {
                    savesList.push(saveKey);
                    localStorage.setItem('instructorSchedules_list', JSON.stringify(savesList));
                }
                
                // Show success message
                alert(`âœ… Schedule saved as "${saveName}"!\n\nSaved at: ${new Date().toLocaleString()}\n\nYou can load this version later from the Load menu.`);
                
            } catch (error) {
                console.error('Error saving schedule:', error);
                alert('âŒ Error saving schedule: ' + error.message);
            }
        }
        
        function loadSchedule() {
            try {
                // Get list of all saves
                const savesList = JSON.parse(localStorage.getItem('instructorSchedules_list') || '[]');
                const defaultSave = localStorage.getItem('instructorSchedule');
                
                let availableSaves = [];
                
                // Add default save if exists
                if (defaultSave) {
                    try {
                        const data = JSON.parse(defaultSave);
                        availableSaves.push({
                            key: 'instructorSchedule',
                            name: 'Default Save',
                            date: data.savedAt ? new Date(data.savedAt).toLocaleString() : 'Unknown'
                        });
                    } catch (e) {
                        // Ignore corrupt default save
                    }
                }
                
                // Add named saves
                savesList.forEach(key => {
                    const savedData = localStorage.getItem(key);
                    if (savedData) {
                        try {
                            const data = JSON.parse(savedData);
                            availableSaves.push({
                                key: key,
                                name: data.saveName || key.replace('instructorSchedule_', '').replace(/_/g, ' '),
                                date: data.savedAt ? new Date(data.savedAt).toLocaleString() : 'Unknown'
                            });
                        } catch (e) {
                            // Ignore corrupt saves
                        }
                    }
                });
                
                if (availableSaves.length === 0) {
                    alert('â„¹ï¸ No saved schedules found.\n\nComplete a schedule and click "Save" or "Save As" first.');
                    return;
                }
                
                // Build selection message
                let message = 'ðŸ“‚ Available Saves:\n\n';
                availableSaves.forEach((save, index) => {
                    message += `${index + 1}. ${save.name}\n   Saved: ${save.date}\n\n`;
                });
                message += 'Enter the number of the save to load (or click Cancel):';
                
                const selection = prompt(message, '1');
                
                if (!selection) {
                    return; // User cancelled
                }
                
                const selectedIndex = parseInt(selection) - 1;
                
                if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= availableSaves.length) {
                    alert('âŒ Invalid selection. Please enter a number from 1 to ' + availableSaves.length);
                    return;
                }
                
                const selectedSave = availableSaves[selectedIndex];
                
                if (!confirm(`âš ï¸ Load "${selectedSave.name}"?\n\nThis will replace your current work.\n\nClick OK to continue or Cancel to abort.`)) {
                    return;
                }
                
                const savedData = localStorage.getItem(selectedSave.key);
                
                // Validate JSON before parsing
                let data;
                try {
                    data = JSON.parse(savedData);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    alert('âŒ Error: Saved data is corrupted.\n\nThe saved schedule cannot be loaded.');
                    return;
                }
                
                // Validate data structure
                if (!data || typeof data !== 'object') {
                    alert('âŒ Error: Invalid saved data format.');
                    return;
                }
                
                // Helper function to safely set value
                const setValue = (id, value) => {
                    const elem = document.getElementById(id);
                    if (elem) {
                        elem.value = value || '';
                    }
                };
                
                // Restore Faculty Info
                setValue('facultyName', data.facultyName);
                setValue('email', data.email);
                setValue('officeLocation', data.officeLocation);
                setValue('phone', data.phone);
                
                // Restore Approval Info
                setValue('instructorAckName', data.instructorAckName);
                setValue('instructorAckDate', data.instructorAckDate);
                setValue('hodName', data.hodName);
                setValue('hodDate', data.hodDate);
                
                // Restore Semester Info
                setValue('semesterSelect', data.semester);
                setValue('gregorianYear', data.gregorianYear);
                setValue('hijriYear', data.hijriYear);
                setValue('departmentSelect', data.department);
                
                // Restore Courses
                const coursesContainer = document.getElementById('coursesContainer');
                if (coursesContainer) {
                    coursesContainer.innerHTML = '';
                    courseCounter = 0;
                    
                    if (data.courses && Array.isArray(data.courses) && data.courses.length > 0) {
                        data.courses.forEach(course => {
                            if (course && typeof course === 'object') {
                                const newRow = createCourseRow();
                                const codeInput = newRow.querySelector('.course-code-input');
                                const nameInput = newRow.querySelector('.course-name-input');
                                if (codeInput) codeInput.value = course.code || '';
                                if (nameInput) nameInput.value = course.name || '';
                                coursesContainer.appendChild(newRow);
                                courseCounter++;
                            }
                        });
                    } else {
                        addCourseRow();
                    }
                }
                
                // Clear existing schedule first
                scheduleData = {};
                
                // Delete all existing merged sessions
                Object.keys(mergedSessions).forEach(sessionId => {
                    const session = mergedSessions[sessionId];
                    const mergedDiv = document.getElementById(sessionId);
                    if (mergedDiv) {
                        mergedDiv.remove();
                    }
                    // Clear cell markers
                    for (let i = 0; i < session.length; i++) {
                        const cell = document.getElementById(`cell-${session.day}-${session.startSlot + i}`);
                        if (cell) {
                            cell.dataset.sessionId = '';
                            cell.classList.remove('cell-merged-occupied');
                        }
                    }
                });
                
                mergedSessions = {};
                mergedCells = {};
                
                // Restore Merged Sessions first
                if (data.mergedSessions && typeof data.mergedSessions === 'object') {
                    Object.keys(data.mergedSessions).forEach(sessionId => {
                        const session = data.mergedSessions[sessionId];
                        if (session && typeof session === 'object' && session.day && typeof session.startSlot === 'number') {
                            // Recreate the merged session
                            applyTeachingSession(
                                session.day,
                                session.startSlot,
                                session.length || 1,
                                session.courseCode || '',
                                session.type || '',
                                session.location || ''
                            );
                        }
                    });
                }
                
                // Then restore individual schedule data for non-merged cells
                if (data.scheduleData && typeof data.scheduleData === 'object') {
                    scheduleData = data.scheduleData;
                }
                
                updateCalculations();
                
                const savedDate = data.savedAt ? new Date(data.savedAt).toLocaleString() : 'Unknown';
                alert(`âœ… Schedule loaded successfully!\n\nLoaded: "${selectedSave.name}"\nSaved: ${savedDate}\n\nYou can now continue editing.`);
                
            } catch (error) {
                console.error('Error loading schedule:', error);
                alert(`âŒ Error loading schedule: ${error.message}\n\nThe saved data may be corrupted.`);
            }
        }
        
        function clearSchedule() {
            if (confirm('Are you sure you want to clear the entire schedule?')) {
                // Clear all merged sessions
                Object.keys(mergedSessions).forEach(sessionId => {
                    deleteMergedSession(sessionId);
                });
                
                // Unmerge all merged cells
                Object.keys(mergedCells).forEach(cellId => {
                    const merged = mergedCells[cellId];
                    unmergeCells(merged.day, merged.startSlot, merged.colspan);
                });
                
                // Reset all cells
                document.querySelectorAll('.cell-content').forEach(content => {
                    const selector = content.querySelector('.type-selector');
                    if (selector) {
                        selector.value = '';
                        selector.classList.remove('selected');
                    }
                    
                    content.querySelectorAll('input').forEach(inp => inp.value = '');
                    content.classList.remove('teaching-mode', 'simple-mode', 'activity-mode');
                });
                
                document.querySelectorAll('.filled-cell').forEach(cell => cell.classList.remove('filled-cell'));
                
                // Reset all cell backgrounds and remove type classes
                document.querySelectorAll('.schedule-cell').forEach(cell => {
                    cell.style.backgroundColor = '';
                    cell.className = cell.className.replace(/type-\w+/g, '');
                });
                
                document.getElementById('facultyName').value = '';
                document.getElementById('facultyRank').value = '';
                document.getElementById('officeLocation').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('email').value = '';
                
                // Clear all course rows and reset to one empty row
                const coursesContainer = document.getElementById('coursesContainer');
                coursesContainer.innerHTML = '';
                courseCounter = 0;
                addCourseRow();
                
                // Clear approval fields
                document.getElementById('instructorAckName').value = '';
                document.getElementById('instructorAckDate').value = '';
                document.getElementById('hodDate').value = '';
                
                // Reset semester info to current
                autoSetYears();
                
                updateCalculations();
            }
        }
        
        function lockAndExport() {
            // First, ensure the schedule is locked (don't toggle if already locked)
            if (!isLocked) {
                isLocked = true;
                const container = document.querySelector('.container');
                const lockBtn = document.querySelector('.btn-lock-export');
                
                container.classList.add('schedule-locked');
                
                // Update button to show it's locked
                if (lockBtn) {
                    lockBtn.innerHTML = '<span style="font-size: 1.1rem;">ðŸ”’ðŸ“„</span> Exporting...';
                    lockBtn.disabled = true;
                }
                
                // Apply the lock state (shared with toggleLock)
                applyLockState();
            }
            
            // Then export to PDF
            exportToPDF();
        }
        
        // Shared lock state application (used by toggleLock and lockAndExport)
        function applyLockState() {
            // Replace ALL input fields with plain text (EXCEPT faculty fields)
            document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
                if (input.classList.contains('faculty-input-keep')) {
                    return;
                }
                
                const value = input.value || '';
                const textSpan = document.createElement('span');
                textSpan.textContent = value;
                textSpan.className = 'locked-text-replacement';
                textSpan.style.fontWeight = input.style.fontWeight || 'normal';
                textSpan.style.fontSize = input.style.fontSize || 'inherit';
                textSpan.style.color = input.style.color || '#000';
                
                textSpan.setAttribute('data-original-input', 'true');
                input.setAttribute('data-replaced-by-lock', 'true');
                input.style.display = 'none';
                input.parentNode.insertBefore(textSpan, input);
            });
            
            // Replace ALL select dropdowns with plain text
            document.querySelectorAll('select').forEach(select => {
                const selectedOption = select.options[select.selectedIndex];
                const value = selectedOption ? selectedOption.text : '';
                
                if (select.classList.contains('type-selector') && select.value === '') {
                    select.setAttribute('data-replaced-by-lock', 'true');
                    select.style.display = 'none';
                    return;
                }
                
                if (select.classList.contains('type-selector')) {
                    const cellContent = select.closest('.cell-content');
                    if (cellContent && (cellContent.classList.contains('simple-mode') || cellContent.classList.contains('activity-mode'))) {
                        select.setAttribute('data-replaced-by-lock', 'true');
                        select.style.display = 'none';
                        return;
                    }
                }
                
                const textSpan = document.createElement('span');
                textSpan.textContent = value;
                textSpan.className = 'locked-text-replacement';
                textSpan.style.fontWeight = 'bold';
                textSpan.style.fontSize = select.style.fontSize || 'inherit';
                textSpan.style.color = select.style.color || '#000';
                
                textSpan.setAttribute('data-original-select', 'true');
                select.setAttribute('data-replaced-by-lock', 'true');
                select.style.display = 'none';
                select.parentNode.insertBefore(textSpan, select);
            });
        }
        
        
        
        
        // Note: Courses are now in grid format with multiple code/name inputs
        // Course counting will be handled by the calculation function
        
        // ============ UNIFIED MODAL FUNCTIONS ============
        
        // Global state for unified modal
        let unifiedModalData = {
            activityType: '',
            day: null,
            slot: null,
            selectedDuration: 0,
            selectedCells: [],
            // Repeat counter
            repeatTotal: 1,
            repeatRemaining: 1,
            // Teaching specific
            courseCode: '',
            teachingType: '',
            section: '',
            location: '',
            transferFlag: false,
            // Activity specific
            activitySubtype: '',
            customActivity: '',
            // OH/Other specific
            note: ''
        };
        
        // Main function to open unified modal - replaces openTeachingModal
        function openTeachingModal(day, slot, prefillData = null) {
            openUnifiedModal(day, slot, prefillData);
        }
        
        function openUnifiedModal(day, slot, prefillData = null) {
            // Reset state
            unifiedModalData = {
                activityType: prefillData?.activityType || '',
                day: day,
                slot: slot,
                selectedDuration: 0,
                selectedCells: [],
                // Reset repeat counter to default
                repeatTotal: 1,
                repeatRemaining: 1,
                courseCode: prefillData?.courseCode || '',
                teachingType: prefillData?.type || '',
                section: prefillData?.section || '',
                location: prefillData?.location || '',
                transferFlag: false,
                activitySubtype: '',
                customActivity: '',
                note: ''
            };
            
            // Clear all fields
            document.getElementById('unifiedActivityType').value = '';
            document.getElementById('unifiedCourseCode').value = prefillData?.courseCode || '';
            document.getElementById('unifiedTeachingType').value = prefillData?.type || '';
            document.getElementById('unifiedSection').value = prefillData?.section || '';
            document.getElementById('unifiedLocation').value = prefillData?.location || '';
            document.getElementById('unifiedTransferFlag').checked = false;
            document.getElementById('unifiedOHLocation').value = '';
            document.getElementById('unifiedOHNote').value = '';
            document.getElementById('unifiedActivitySubtype').value = '';
            document.getElementById('unifiedCustomActivity').value = '';
            document.getElementById('unifiedActivityLocation').value = '';
            
            // Reset repeat dropdown to 1 time
            document.getElementById('unifiedRepeatTimes').value = '1';
            
            // Hide all detail sections
            document.getElementById('teachingFieldsSection').style.display = 'none';
            document.getElementById('officeHoursFieldsSection').style.display = 'none';
            document.getElementById('breakFieldsSection').style.display = 'none';
            document.getElementById('chFieldsSection').style.display = 'none';
            document.getElementById('nsFieldsSection').style.display = 'none';
            document.getElementById('activityFieldsSection').style.display = 'none';
            document.getElementById('durationSection').style.display = 'none';
            document.getElementById('customActivityField').style.display = 'none';
            
            // Disable next button initially
            document.getElementById('unifiedNextButton').disabled = true;
            document.getElementById('unifiedNextButton').style.opacity = '0.5';
            
            // Reset duration buttons
            document.querySelectorAll('#unifiedDurationButtons .length-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('active');
            });
            
            // If prefill data suggests teaching, auto-select it
            if (prefillData && prefillData.courseCode) {
                document.getElementById('unifiedActivityType').value = 'TEACHING';
                onUnifiedActivityTypeChange();
                
                // Give a moment for fields to show, then validate
                setTimeout(() => {
                    validateUnifiedFields();
                }, 100);
            }
            
            // Show modal
            document.getElementById('unifiedModal').classList.add('active');
            document.getElementById('unifiedActivityType').focus();
        }
        
        function onUnifiedActivityTypeChange() {
            const activityType = document.getElementById('unifiedActivityType').value;
            unifiedModalData.activityType = activityType;
            
            // Hide all sections first
            document.getElementById('teachingFieldsSection').style.display = 'none';
            document.getElementById('officeHoursFieldsSection').style.display = 'none';
            document.getElementById('breakFieldsSection').style.display = 'none';
            document.getElementById('chFieldsSection').style.display = 'none';
            document.getElementById('nsFieldsSection').style.display = 'none';
            document.getElementById('activityFieldsSection').style.display = 'none';
            document.getElementById('durationSection').style.display = 'none';
            
            // Show relevant section with animation
            if (activityType === 'TEACHING') {
                document.getElementById('teachingFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                setTimeout(() => document.getElementById('unifiedCourseCode').focus(), 100);
            } else if (activityType === 'OH') {
                document.getElementById('officeHoursFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                // OH doesn't require fields, so enable duration immediately
                enableUnifiedDuration();
            } else if (activityType === 'BREAK') {
                document.getElementById('breakFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                // BREAK doesn't require fields, enable duration immediately
                enableUnifiedDuration();
            } else if (activityType === 'CH') {
                document.getElementById('chFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                enableUnifiedDuration();
            } else if (activityType === 'NS') {
                document.getElementById('nsFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                enableUnifiedDuration();
            } else if (activityType === 'ACTIVITY') {
                document.getElementById('activityFieldsSection').style.display = 'block';
                document.getElementById('durationSection').style.display = 'block';
                setTimeout(() => document.getElementById('unifiedActivitySubtype').focus(), 100);
            }
            
            // Validate fields
            validateUnifiedFields();
        }
        
        function onActivitySubtypeChange() {
            const subtype = document.getElementById('unifiedActivitySubtype').value;
            
            if (subtype === 'CUSTOM') {
                document.getElementById('customActivityField').style.display = 'block';
                setTimeout(() => document.getElementById('unifiedCustomActivity').focus(), 100);
            } else {
                document.getElementById('customActivityField').style.display = 'none';
                document.getElementById('unifiedCustomActivity').value = '';
            }
            
            validateUnifiedFields();
        }
        
        function validateUnifiedFields() {
            const activityType = document.getElementById('unifiedActivityType').value;
            let isValid = false;
            
            if (!activityType) {
                disableUnifiedDuration();
                return;
            }
            
            switch(activityType) {
                case 'TEACHING':
                    const courseCode = document.getElementById('unifiedCourseCode').value.trim();
                    const teachingType = document.getElementById('unifiedTeachingType').value;
                    const location = document.getElementById('unifiedLocation').value.trim();
                    isValid = courseCode && teachingType && location;
                    
                    if (isValid) {
                        unifiedModalData.courseCode = courseCode;
                        unifiedModalData.teachingType = teachingType;
                        unifiedModalData.section = document.getElementById('unifiedSection').value.trim();
                        unifiedModalData.location = location;
                        unifiedModalData.transferFlag = document.getElementById('unifiedTransferFlag').checked;
                    }
                    break;
                    
                case 'OH':
                case 'BREAK':
                case 'CH':
                case 'NS':
                    // These don't require additional validation
                    isValid = true;
                    break;
                    
                case 'ACTIVITY':
                    const activitySubtype = document.getElementById('unifiedActivitySubtype').value;
                    if (activitySubtype === 'CUSTOM') {
                        const customActivity = document.getElementById('unifiedCustomActivity').value.trim();
                        isValid = customActivity !== '';
                        if (isValid) {
                            unifiedModalData.activitySubtype = customActivity;
                            unifiedModalData.customActivity = customActivity;
                        }
                    } else {
                        isValid = activitySubtype !== '';
                        if (isValid) {
                            unifiedModalData.activitySubtype = activitySubtype;
                        }
                    }
                    
                    if (isValid) {
                        unifiedModalData.location = document.getElementById('unifiedActivityLocation').value.trim();
                    }
                    break;
            }
            
            if (isValid) {
                enableUnifiedDuration();
            } else {
                disableUnifiedDuration();
            }
        }
        
        function enableUnifiedDuration() {
            document.querySelectorAll('#unifiedDurationButtons .length-btn').forEach(btn => {
                btn.disabled = false;
            });
        }
        
        function disableUnifiedDuration() {
            document.querySelectorAll('#unifiedDurationButtons .length-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('active');
            });
            document.getElementById('unifiedNextButton').disabled = true;
            document.getElementById('unifiedNextButton').style.opacity = '0.5';
            unifiedModalData.selectedDuration = 0;
        }
        
        function selectUnifiedDuration(duration) {
            unifiedModalData.selectedDuration = duration;
            
            // Update button states
            document.querySelectorAll('#unifiedDurationButtons .length-btn').forEach(btn => {
                if (parseInt(btn.dataset.length) === duration) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Enable next button
            document.getElementById('unifiedNextButton').disabled = false;
            document.getElementById('unifiedNextButton').style.opacity = '1';
        }
        
        function selectRepeatTimes() {
            const repeatSelect = document.getElementById('unifiedRepeatTimes');
            const repeatTimes = parseInt(repeatSelect.value);
            unifiedModalData.repeatTotal = repeatTimes;
            unifiedModalData.repeatRemaining = repeatTimes;
        }
        
        // NEW: Batch selection data structure
        let batchSelectionData = {
            completedSets: [],      // Array of completed cell sets
            currentSet: [],         // Currently being selected
            totalSets: 0,           // Total sets needed
            cellsPerSet: 0,         // Cells per set (duration)
            setColors: [            // Colors for visual distinction
                '#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#00BCD4',
                '#E91E63', '#8BC34A', '#FF5722', '#3F51B5', '#009688',
                '#CDDC39', '#795548', '#607D8B', '#F44336', '#673AB7'
            ]
        };
        
        function proceedToCellSelection() {
            if (unifiedModalData.selectedDuration === 0) {
                alert('âš ï¸ Please select a duration first!');
                return;
            }
            
            // Initialize batch selection
            batchSelectionData = {
                completedSets: [],
                currentSet: [],
                totalSets: unifiedModalData.repeatTotal,
                cellsPerSet: unifiedModalData.selectedDuration,
                setColors: [
                    '#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#00BCD4',
                    '#E91E63', '#8BC34A', '#FF5722', '#3F51B5', '#009688',
                    '#CDDC39', '#795548', '#607D8B', '#F44336', '#673AB7'
                ]
            };
            
            // Close modal
            document.getElementById('unifiedModal').classList.remove('active');
            
            // Show toolbar
            document.getElementById('mergeToolbar').style.display = 'block';
            
            // Enable checkboxes for available cells only
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                const cell = cb.parentElement;
                // Only show checkbox if cell is not already occupied
                if (!cell.classList.contains('cell-merged-occupied') && 
                    !cell.classList.contains('merged-cell') &&
                    cell.style.display !== 'none' &&
                    !cell.dataset.sessionId) {
                    cb.style.display = 'block';
                } else {
                    cb.style.display = 'none';
                }
            });
            
            // Setup cell selection with batch mode
            enableBatchCellSelection();
        }
        
        function enableBatchCellSelection() {
            // Clear any previous selections
            document.querySelectorAll('.cell-checkbox:checked').forEach(cb => {
                cb.checked = false;
                cb.parentElement.classList.remove('cell-selected');
                cb.parentElement.style.backgroundColor = '';
            });
            
            batchSelectionData.currentSet = [];
            
            // Update toolbar with batch progress
            updateBatchToolbar();
            
            // Add click and hover listeners to cells
            document.querySelectorAll('.schedule-cell').forEach(cell => {
                const checkbox = cell.querySelector('.cell-checkbox');
                if (!checkbox) return;
                
                // Click handler on checkbox
                checkbox.onclick = function(e) {
                    e.stopPropagation();
                    handleBatchCellSelection(this);
                };
                
                // Click handler on entire cell - click anywhere to select
                cell.onclick = function(e) {
                    // Don't trigger if clicking on the checkbox itself (already handled)
                    if (e.target === checkbox) return;
                    // Don't trigger if cell is occupied
                    if (cell.classList.contains('cell-merged-occupied') || 
                        cell.classList.contains('merged-cell') ||
                        cell.style.display === 'none' ||
                        cell.dataset.sessionId) return;
                    // Trigger checkbox selection - set checked first then handle
                    if (checkbox.style.display !== 'none' && !checkbox.disabled) {
                        checkbox.checked = true;
                        handleBatchCellSelection(checkbox);
                    }
                };
                
                // Hover preview handlers
                cell.onmouseenter = function() {
                    showAutoExtendPreview(this);
                };
                
                cell.onmouseleave = function() {
                    clearAutoExtendPreview();
                };
            });
        }
        
        // Show preview of which cells will be auto-selected on hover
        function showAutoExtendPreview(cell) {
            // Don't show preview if all sets are complete
            if (batchSelectionData.completedSets.length >= batchSelectionData.totalSets) return;
            
            const checkbox = cell.querySelector('.cell-checkbox');
            if (!checkbox || checkbox.disabled) return;
            
            const day = checkbox.dataset.day;
            const slot = parseInt(checkbox.dataset.slot);
            const duration = batchSelectionData.cellsPerSet;
            
            // Check if this cell is already in a completed set
            const isInCompletedSet = batchSelectionData.completedSets.some(set => 
                set.cells.some(c => c.day === day && c.slot === slot)
            );
            if (isInCompletedSet) return;
            
            // Get the preview color (next set's color)
            const nextSetIndex = batchSelectionData.completedSets.length;
            const previewColor = batchSelectionData.setColors[nextSetIndex % batchSelectionData.setColors.length];
            
            // Check each cell that would be selected
            let canExtend = true;
            const previewCells = [];
            
            for (let i = 0; i < duration; i++) {
                const checkSlot = slot + i;
                if (checkSlot > 15) {
                    canExtend = false;
                    break;
                }
                
                const checkCell = document.getElementById(`cell-${day}-${checkSlot}`);
                if (!checkCell) {
                    canExtend = false;
                    break;
                }
                
                // Check if blocked
                const slotInCompletedSet = batchSelectionData.completedSets.some(set => 
                    set.cells.some(c => c.day === day && c.slot === checkSlot)
                );
                
                if (slotInCompletedSet || 
                    checkCell.classList.contains('cell-merged-occupied') || 
                    checkCell.classList.contains('merged-cell') ||
                    checkCell.dataset.sessionId ||
                    checkCell.style.display === 'none') {
                    canExtend = false;
                    break;
                }
                
                previewCells.push(checkCell);
            }
            
            // Apply preview styling
            previewCells.forEach(c => {
                if (canExtend) {
                    c.classList.add('auto-extend-preview');
                    c.style.outline = `2px dashed ${previewColor}`;
                    c.style.backgroundColor = previewColor + '25';
                } else {
                    c.classList.add('auto-extend-preview-blocked');
                    c.style.outline = '2px dashed #F44336';
                    c.style.backgroundColor = '#FFEBEE';
                }
            });
        }
        
        // Clear the hover preview
        function clearAutoExtendPreview() {
            document.querySelectorAll('.auto-extend-preview, .auto-extend-preview-blocked').forEach(cell => {
                // Don't clear if it's part of a completed set
                const checkbox = cell.querySelector('.cell-checkbox');
                if (checkbox && checkbox.disabled) return;
                
                cell.classList.remove('auto-extend-preview', 'auto-extend-preview-blocked');
                cell.style.outline = '';
                cell.style.backgroundColor = '';
            });
        }
        
        function getActivityLabel(type) {
            const labels = {
                'TEACHING': 'ðŸ“š Teaching Session',
                'OH': 'ðŸ• Office Hours',
                'BREAK': 'â˜• Break',
                'CH': 'ðŸ“– Compensated Hours',
                'NS': 'ðŸ“‹ Non-Scheduled Hours',
                'ACTIVITY': 'âœ“âœ“ Activity'
            };
            return labels[type] || type;
        }
        
        function updateBatchToolbar() {
            const toolbar = document.getElementById('mergeToolbar');
            const activityLabel = getActivityLabel(unifiedModalData.activityType);
            const completedCount = batchSelectionData.completedSets.length;
            const totalSets = batchSelectionData.totalSets;
            const cellsPerSet = batchSelectionData.cellsPerSet;
            
            // Build completed sets display
            let completedSetsHTML = '';
            batchSelectionData.completedSets.forEach((set, idx) => {
                const color = batchSelectionData.setColors[idx % batchSelectionData.setColors.length];
                const timeRange = getTimeRange(set.cells[0].slot, set.cells[set.cells.length - 1].slot);
                completedSetsHTML += `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 10px; background: ${color}20; border-left: 3px solid ${color}; border-radius: 4px; margin-bottom: 5px;">
                        <span style="color: ${color}; font-weight: bold;">âœ“ Set ${idx + 1}:</span>
                        <span style="color: #333;">${set.day} ${timeRange}</span>
                        <button onclick="undoCompletedSet(${idx})" style="margin-left: auto; background: #FF3B30; color: white; border: none; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Undo</button>
                    </div>
                `;
            });
            
            // Build pending sets indicators (simplified for auto-extend)
            let pendingSetsHTML = '';
            const remainingSets = totalSets - completedCount;
            if (remainingSets > 0) {
                const nextColor = batchSelectionData.setColors[completedCount % batchSelectionData.setColors.length];
                pendingSetsHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 8px 10px; background: ${nextColor}15; border: 2px dashed ${nextColor}; border-radius: 4px; margin-bottom: 5px;">
                        <span style="color: ${nextColor}; font-weight: bold;">â†’ Next:</span>
                        <span style="color: #333;">Click any starting cell (auto-extends ${cellsPerSet} slots)</span>
                    </div>
                `;
                
                if (remainingSets > 1) {
                    pendingSetsHTML += `
                        <div style="padding: 6px 10px; color: #999; font-size: 12px;">
                            + ${remainingSets - 1} more set(s) after this
                        </div>
                    `;
                }
            }
            
            const allComplete = (completedCount === totalSets);
            const themePrimary = getThemePrimary();
            const themeAccent = getThemeAccent();
            
            toolbar.innerHTML = `
                <div style="padding: 15px; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-width: 400px;">
                    <div style="font-size: 15px; font-weight: bold; margin-bottom: 10px; color: ${themePrimary}; display: flex; align-items: center; gap: 8px;">
                        ðŸ“‹ ${activityLabel}
                        <span style="font-size: 12px; background: ${themePrimary}; color: white; padding: 2px 8px; border-radius: 10px;">
                            ${cellsPerSet}h Ã— ${totalSets} times
                        </span>
                    </div>
                    
                    <div style="margin-bottom: 12px; max-height: 200px; overflow-y: auto;">
                        ${completedSetsHTML}
                        ${pendingSetsHTML}
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="applyAllBatchSets()" id="applyAllBatchBtn" 
                            ${allComplete ? '' : 'disabled'} 
                            style="flex: 1; padding: 12px; background: ${allComplete ? themeAccent : '#ccc'}; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: ${allComplete ? 'pointer' : 'not-allowed'}; font-size: 14px;">
                            âœ“ Apply All (${completedCount}/${totalSets})
                        </button>
                        <button onclick="cancelBatchSelection()" style="flex: 1; padding: 12px; background: #FF3B30; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 14px;">
                            âœ• Cancel All
                        </button>
                    </div>
                    
                    ${!allComplete ? `
                    <div style="margin-top: 10px; padding: 8px; background: #E3F2FD; border-radius: 5px; font-size: 12px; color: #1565C0;">
                        âš¡ <strong>Quick Select:</strong> Just click the STARTING cell - next ${cellsPerSet - 1} cell(s) will auto-select!
                    </div>
                    ` : `
                    <div style="margin-top: 10px; padding: 8px; background: #E8F5E9; border-radius: 5px; font-size: 12px; color: #2E7D32;">
                        âœ… <strong>All sets selected!</strong> Click "Apply All" to create all schedules at once.
                    </div>
                    `}
                </div>
            `;
        }
        
        function getTimeRange(startSlot, endSlot) {
            const timeSlots = [
                '07:15', '08:15', '09:15', '10:15', '11:15', '12:15',
                '13:15', '14:15', '15:15', '16:15', '17:15', '18:15',
                '19:15', '20:15', '21:15', '22:15'
            ];
            const endTimes = [
                '08:05', '09:05', '10:05', '11:05', '12:05', '13:05',
                '14:05', '15:05', '16:05', '17:05', '18:05', '19:05',
                '20:05', '21:05', '22:05', '23:05'
            ];
            return `${timeSlots[startSlot]}-${endTimes[endSlot]}`;
        }
        
        function handleBatchCellSelection(checkbox) {
            const cell = checkbox.parentElement;
            const day = checkbox.dataset.day;
            const slot = parseInt(checkbox.dataset.slot);
            const duration = batchSelectionData.cellsPerSet;
            
            // Only handle checking (clicking a cell to start auto-extend)
            if (!checkbox.checked) {
                // Unchecking is handled by undo button, not by clicking
                checkbox.checked = true; // Prevent unchecking via checkbox
                return;
            }
            
            // === AUTO-EXTEND LOGIC ===
            // User clicks ONE cell, we auto-select the next (duration-1) cells
            
            // Step 1: Check if starting cell is valid
            const isInCompletedSet = batchSelectionData.completedSets.some(set => 
                set.cells.some(c => c.day === day && c.slot === slot)
            );
            
            if (isInCompletedSet) {
                alert('âš ï¸ This cell is already part of a completed set!');
                checkbox.checked = false;
                return;
            }
            
            if (cell.classList.contains('cell-merged-occupied') || cell.dataset.sessionId) {
                alert('âš ï¸ This cell is already occupied!');
                checkbox.checked = false;
                return;
            }
            
            // Step 2: Check if we have enough consecutive cells available
            const cellsToSelect = [];
            let canExtend = true;
            let blockReason = '';
            
            for (let i = 0; i < duration; i++) {
                const checkSlot = slot + i;
                
                // Check if slot is within bounds (16 slots: 0-15)
                if (checkSlot > 15) {
                    canExtend = false;
                    blockReason = `Not enough slots! Only ${16 - slot} slot(s) available from this position.`;
                    break;
                }
                
                const checkCell = document.getElementById(`cell-${day}-${checkSlot}`);
                if (!checkCell) {
                    canExtend = false;
                    blockReason = `Cell not found at slot ${checkSlot}.`;
                    break;
                }
                
                const checkCheckbox = checkCell.querySelector('.cell-checkbox');
                
                // Check if cell is already in a completed set
                const slotInCompletedSet = batchSelectionData.completedSets.some(set => 
                    set.cells.some(c => c.day === day && c.slot === checkSlot)
                );
                
                if (slotInCompletedSet) {
                    canExtend = false;
                    blockReason = `Slot ${checkSlot + 1} is already part of another set.`;
                    break;
                }
                
                // Check if cell is occupied by existing schedule
                if (checkCell.classList.contains('cell-merged-occupied') || 
                    checkCell.classList.contains('merged-cell') ||
                    checkCell.dataset.sessionId ||
                    checkCell.style.display === 'none') {
                    canExtend = false;
                    blockReason = `Slot ${checkSlot + 1} is already occupied.`;
                    break;
                }
                
                cellsToSelect.push({
                    day: day,
                    slot: checkSlot,
                    element: checkCell,
                    checkbox: checkCheckbox
                });
            }
            
            // Step 3: If can't extend, show error and reset
            if (!canExtend) {
                alert(`âš ï¸ Cannot select ${duration} consecutive cells here.\n${blockReason}`);
                checkbox.checked = false;
                return;
            }
            
            // Step 4: All cells are valid - select them all and complete the set
            const currentSetIndex = batchSelectionData.completedSets.length;
            const setColor = batchSelectionData.setColors[currentSetIndex % batchSelectionData.setColors.length];
            
            // Apply visual styling to all cells
            cellsToSelect.forEach(c => {
                c.checkbox.checked = true;
                c.element.classList.add('cell-selected');
                c.element.style.backgroundColor = setColor + '60';
                c.element.style.outline = `2px solid ${setColor}`;
                c.checkbox.disabled = true; // Prevent unchecking via checkbox
            });
            
            // Add to completed sets immediately (since auto-extend guarantees valid set)
            const setData = {
                day: day,
                cells: cellsToSelect
            };
            batchSelectionData.completedSets.push(setData);
            
            // Disable checkboxes for overlapping cells
            disableOverlappingCells();
            
            // Update toolbar
            updateBatchToolbar();
            
            // Check if all sets are complete - auto-apply if done
            if (batchSelectionData.completedSets.length === batchSelectionData.totalSets) {
                // Brief delay to show the final selection, then prompt
                setTimeout(() => {
                    updateBatchToolbar(); // Update to show "Apply All" enabled
                }, 100);
            }
        }
        
        function validateCurrentSet() {
            const cells = batchSelectionData.currentSet;
            if (cells.length !== batchSelectionData.cellsPerSet) {
                return false;
            }
            
            // Sort by slot
            const sorted = [...cells].sort((a, b) => a.slot - b.slot);
            const firstDay = sorted[0].day;
            
            // All cells must be on same day
            if (!sorted.every(c => c.day === firstDay)) {
                return false;
            }
            
            // Cells must be consecutive
            for (let i = 1; i < sorted.length; i++) {
                if (sorted[i].slot !== sorted[i-1].slot + 1) {
                    return false;
                }
            }
            
            return true;
        }
        
        function resetCurrentSet() {
            batchSelectionData.currentSet.forEach(c => {
                c.checkbox.checked = false;
                c.element.classList.remove('cell-selected');
                c.element.style.backgroundColor = '';
                c.element.style.outline = '';
            });
            batchSelectionData.currentSet = [];
        }
        
        function disableOverlappingCells() {
            // Get all slots that are in completed sets
            const occupiedSlots = new Set();
            batchSelectionData.completedSets.forEach(set => {
                set.cells.forEach(c => {
                    occupiedSlots.add(`${c.day}-${c.slot}`);
                });
            });
            
            // Disable checkboxes for occupied slots
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                const key = `${cb.dataset.day}-${cb.dataset.slot}`;
                if (occupiedSlots.has(key)) {
                    cb.disabled = true;
                }
            });
        }
        
        function undoCompletedSet(setIndex) {
            if (setIndex < 0 || setIndex >= batchSelectionData.completedSets.length) return;
            
            const setToRemove = batchSelectionData.completedSets[setIndex];
            
            // Reset visual state of cells in this set
            setToRemove.cells.forEach(c => {
                c.checkbox.checked = false;
                c.checkbox.disabled = false;
                c.element.classList.remove('cell-selected');
                c.element.style.backgroundColor = '';
                c.element.style.outline = '';
            });
            
            // Remove from completed sets
            batchSelectionData.completedSets.splice(setIndex, 1);
            
            // Re-apply colors to remaining completed sets
            batchSelectionData.completedSets.forEach((set, idx) => {
                const color = batchSelectionData.setColors[idx % batchSelectionData.setColors.length];
                set.cells.forEach(c => {
                    c.element.style.backgroundColor = color + '60';
                    c.element.style.outline = `2px solid ${color}`;
                });
            });
            
            // Reset current set as well (in case user was mid-selection)
            resetCurrentSet();
            
            // Re-enable checkboxes
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                const cell = cb.parentElement;
                if (!cell.classList.contains('cell-merged-occupied') && 
                    !cell.classList.contains('merged-cell') &&
                    cell.style.display !== 'none' &&
                    !cell.dataset.sessionId) {
                    cb.disabled = false;
                }
            });
            disableOverlappingCells();
            
            // Update toolbar
            updateBatchToolbar();
        }
        
        function applyAllBatchSets() {
            if (batchSelectionData.completedSets.length !== batchSelectionData.totalSets) {
                alert('âš ï¸ Please complete all sets before applying!');
                return;
            }
            
            // Apply all sets at once
            batchSelectionData.completedSets.forEach((set, idx) => {
                const day = set.day;
                const startSlot = set.cells[0].slot;
                const length = batchSelectionData.cellsPerSet;
                
                // Create session ID
                const sessionId = `session-${sessionCounter++}`;
                
                // Create session data based on activity type
                const sessionData = {
                    day: day,
                    startSlot: startSlot,
                    length: length,
                    activityType: unifiedModalData.activityType
                };
                
                // Add type-specific data
                if (unifiedModalData.activityType === 'TEACHING') {
                    sessionData.courseCode = unifiedModalData.courseCode;
                    sessionData.type = unifiedModalData.teachingType;
                    sessionData.section = unifiedModalData.section;
                    sessionData.location = unifiedModalData.location;
                    sessionData.transferFlag = unifiedModalData.transferFlag;
                } else if (unifiedModalData.activityType === 'OH') {
                    sessionData.location = document.getElementById('unifiedOHLocation')?.value || '';
                    sessionData.note = document.getElementById('unifiedOHNote')?.value || '';
                } else if (unifiedModalData.activityType === 'ACTIVITY') {
                    sessionData.activitySubtype = unifiedModalData.activitySubtype;
                    sessionData.location = document.getElementById('unifiedActivityLocation')?.value || '';
                }
                
                // Store in mergedSessions
                mergedSessions[sessionId] = sessionData;
                
                // Create merged display
                createMergedDisplay(sessionId, day, startSlot, length);
            });
            
            // Cleanup
            cleanupBatchSelection();
            updateCalculations();
        }
        
        function cancelBatchSelection() {
            if (batchSelectionData.completedSets.length > 0 || batchSelectionData.currentSet.length > 0) {
                if (!confirm('Are you sure you want to cancel? All selections will be lost.')) {
                    return;
                }
            }
            cleanupBatchSelection();
        }
        
        function cleanupBatchSelection() {
            // Reset all visual states
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                cb.checked = false;
                cb.disabled = false;
                cb.style.display = 'none';
                cb.parentElement.classList.remove('cell-selected');
                cb.parentElement.style.backgroundColor = '';
                cb.parentElement.style.outline = '';
            });
            
            // Hide toolbar
            document.getElementById('mergeToolbar').style.display = 'none';
            
            // Reset batch data
            batchSelectionData = {
                completedSets: [],
                currentSet: [],
                totalSets: 0,
                cellsPerSet: 0,
                setColors: batchSelectionData.setColors
            };
        }
        
        // Keep old function names for backward compatibility
        function enableUnifiedCellSelection() {
            enableBatchCellSelection();
        }
        
        function cancelUnifiedSelection() {
            cleanupBatchSelection();
        }
        
        function updateCellDisplay(cell, day, slot) {
            const cellContent = cell.querySelector('.cell-content');
            if (!cellContent) return;
            
            const data = scheduleData[day][slot];
            if (!data) return;
            
            const typeClass = `type-${data.type}`;
            cell.className = `schedule-cell ${typeClass}`;
            
            let displayText = data.type;
            if (data.type === 'ACTIVITY' && data.activityType) {
                displayText = data.activityType;
            }
            
            cellContent.innerHTML = `
                <div style="font-weight: bold; font-size: 11px; color: #333;">${displayText}</div>
                <button class="simple-cancel" onclick="event.stopPropagation(); clearCell('${day}', ${slot})">Ã—</button>
            `;
        }
        
        function createMergedDisplay(sessionId, day, startSlot, length) {
            const s = mergedSessions[sessionId];
            const firstCell = document.getElementById(`cell-${day}-${startSlot}`);
            const lastCell = document.getElementById(`cell-${day}-${startSlot + length - 1}`);
            const firstRect = firstCell.getBoundingClientRect();
            const lastRect = lastCell.getBoundingClientRect();
            const totalWidth = Math.round(lastRect.right - firstRect.left);
            
            const mergedDiv = document.createElement('div');
            mergedDiv.className = 'merged-teaching';
            mergedDiv.id = sessionId;
            mergedDiv.style.width = totalWidth + 'px';
            
            // Apply type-specific class for background color
            let typeClass = '';
            if (s.activityType === 'TEACHING') {
                typeClass = `type-${s.type}`; // LAB, LEC, TUT
            } else if (s.activityType === 'ACTIVITY') {
                typeClass = 'type-ACTIVITY';
            } else {
                typeClass = `type-${s.activityType}`; // NS, CH, OH, BREAK
            }
            mergedDiv.classList.add(typeClass);
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn-cancel';
            cancelBtn.textContent = 'Ã—';
            cancelBtn.style.cssText = 'position: absolute; top: 3px; right: 3px; z-index: 100;';
            cancelBtn.onclick = function(e) {
                e.stopPropagation();
                deleteMergedSession(sessionId);
            };
            
            const content = document.createElement('div');
            content.className = 'merged-teaching-content';
            content.style.cssText = 'padding: 4px; font-size: 10px; font-weight: bold; text-align: center;';
            
            // Generate content based on activity type
            // Use SHORT names for single cells (length=1), FULL names for merged (length>1)
            // ALL TEXT MUST BE UPPERCASE
            let contentHTML = '';
            if (s.activityType === 'TEACHING') {
                contentHTML = `
                    <div style="font-size: 11px; font-weight: bold; text-transform: uppercase;">${s.courseCode}</div>
                    <div style="font-size: 9px; text-transform: uppercase;">${s.type}${s.section ? ' - ' + s.section : ''}</div>
                    <div style="font-size: 9px; text-transform: uppercase;">${s.location}</div>
                `;
            } else if (s.activityType === 'OH') {
                const ohLabel = length === 1 ? 'OH' : 'OFFICE HOURS';
                contentHTML = `
                    <div style="font-size: 11px; font-weight: bold; text-transform: uppercase;">${ohLabel}</div>
                    ${s.location ? `<div style="font-size: 9px; text-transform: uppercase;">${s.location}</div>` : ''}
                    ${s.note ? `<div style="font-size: 9px; text-transform: uppercase;">${s.note}</div>` : ''}
                `;
            } else if (s.activityType === 'NS') {
                const nsLabel = length === 1 ? 'NS' : 'NON-SCHEDULED';
                contentHTML = `<div style="font-size: 11px; font-weight: bold; text-transform: uppercase;">${nsLabel}</div>`;
            } else if (s.activityType === 'CH') {
                const chLabel = length === 1 ? 'CH' : 'COMPENSATED HOURS';
                contentHTML = `<div style="font-size: 11px; font-weight: bold; text-transform: uppercase;">${chLabel}</div>`;
            } else if (s.activityType === 'BREAK') {
                const breakLabel = length === 1 ? 'BRK' : 'BREAK';
                contentHTML = `<div style="font-size: 11px; font-weight: bold; text-transform: uppercase;">${breakLabel}</div>`;
            } else if (s.activityType === 'ACTIVITY') {
                // Activity sub-types with short (1 cell) and full (2+ cells) names
                const activityNames = {
                    'PC': { short: 'PC', full: 'PROGRAM COORDINATION' },
                    'PAEC': { short: 'PAEC', full: 'PROGRAM ASSESSMENT & EVALUATION COMMITTEE' },
                    'DAC': { short: 'DAC', full: 'DEPARTMENT AFFAIRS COMMITTEE' },
                    'DAQC': { short: 'DAQC', full: 'DEPARTMENT ACADEMIC QUALITY COMMITTEE' },
                    'DASC': { short: 'DASC', full: 'DEPARTMENT ACADEMIC SUPPORT COMMITTEE' }
                };
                
                let activityLabel;
                if (activityNames[s.activitySubtype]) {
                    activityLabel = length === 1 ? activityNames[s.activitySubtype].short : activityNames[s.activitySubtype].full;
                } else {
                    // Custom activity - use the entered name, abbreviate for 1 cell
                    activityLabel = length === 1 ? s.activitySubtype.substring(0, 4).toUpperCase() : s.activitySubtype.toUpperCase();
                }
                
                contentHTML = `
                    <div style="font-size: ${length === 1 ? '11px' : '10px'}; font-weight: bold; text-transform: uppercase;">${activityLabel}</div>
                    ${s.location ? `<div style="font-size: 9px; text-transform: uppercase;">${s.location}</div>` : ''}
                `;
            }
            
            content.innerHTML = contentHTML;
            
            mergedDiv.appendChild(cancelBtn);
            mergedDiv.appendChild(content);
            
            firstCell.appendChild(mergedDiv);
            firstCell.dataset.sessionId = sessionId;
            
            // Add cell-merged-first class to first cell (Top, Bottom, Left borders only)
            firstCell.classList.add('cell-merged-first');
            
            // Mark continuation cells
            for (let i = 1; i < length; i++) {
                const cell = document.getElementById(`cell-${day}-${startSlot + i}`);
                cell.classList.add('cell-merged-occupied');
                cell.dataset.sessionId = sessionId;
                
                // Add special class to last cell (Top, Bottom, Right borders only)
                if (i === length - 1) {
                    cell.classList.add('cell-merged-last');
                }
            }
        }
        
        function cancelUnifiedSelection() {
            // Hide toolbar
            document.getElementById('mergeToolbar').style.display = 'none';
            
            // Hide checkboxes
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                cb.style.display = 'none';
                cb.checked = false;
            });
            
            // Clear selections
            document.querySelectorAll('.cell-selected').forEach(cell => {
                cell.classList.remove('cell-selected');
            });
            
            unifiedModalData.selectedCells = [];
        }
        
        function closeUnifiedModal() {
            document.getElementById('unifiedModal').classList.remove('active');
            
            // Check for universal scheduling mode
            if (universalSchedulingMode.active) {
                endUniversalScheduling();
            }
        }
        
        function clearCell(day, slot) {
            if (scheduleData[day] && scheduleData[day][slot]) {
                delete scheduleData[day][slot];
            }
            
            const cell = document.getElementById(`cell-${day}-${slot}`);
            if (cell) {
                cell.className = 'schedule-cell';
                const cellContent = cell.querySelector('.cell-content');
                if (cellContent) {
                    cellContent.innerHTML = '';
                }
            }
            
            updateCalculations();
        }
        
        // OLD Teaching Modal Functions (kept for backwards compatibility)
        function checkTeachingFieldsComplete() {
            // Redirect to unified validation
            validateUnifiedFields();
        }
        
        function checkTeachingFieldsComplete() {
            const courseCode = document.getElementById('modalCourseCode').value.trim();
            const type = document.getElementById('modalType').value;
            const section = document.getElementById('modalSection').value.trim();
            const location = document.getElementById('modalLocation').value.trim();
            const transferFlag = document.getElementById('modalTransferFlag').checked;
            
            const lengthButtons = document.querySelectorAll('.length-btn');
            
            if (courseCode && type && location) {
                // All required fields complete - enable session length buttons
                teachingModalData.courseCode = courseCode;
                teachingModalData.type = type;
                teachingModalData.section = section;
                teachingModalData.location = location;
                teachingModalData.transferFlag = transferFlag;
                
                // Enable all length buttons - they will turn to their normal colors via CSS
                lengthButtons.forEach(btn => {
                    btn.disabled = false;
                });
            } else {
                // Fields incomplete - disable session length buttons (they stay gray)
                document.getElementById('sessionLengthInstructions').style.display = 'none';
                
                // Disable all length buttons - they will turn gray via CSS
                lengthButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.remove('active');
                });
                
                // Reset selected length
                teachingModalData.selectedLength = 0;
            }
        }
        
        function selectSessionLength(length) {
            // Validate that all required fields are filled first
            const courseCode = document.getElementById('modalCourseCode').value.trim();
            const type = document.getElementById('modalType').value;
            const location = document.getElementById('modalLocation').value.trim();
            
            if (!courseCode || !type || !location) {
                alert('âš ï¸ Please fill in Course Code, Type, and Location before selecting session length!');
                return;
            }
            
            teachingModalData.selectedLength = length;
            
            // Update button states
            document.querySelectorAll('.length-btn').forEach(btn => {
                if (parseInt(btn.dataset.length) === length) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Show instructions
            document.getElementById('remainingCells').textContent = length;
            document.getElementById('sessionLengthInstructions').style.display = 'block';
            
            // Close modal and enable cell selection mode
            document.getElementById('teachingModal').classList.remove('active');
            
            // Enable checkboxes and show merge toolbar
            document.getElementById('mergeToolbar').style.display = 'block';
            document.querySelectorAll('.cell-checkbox').forEach(cb => cb.style.display = 'block');
            
            // Add cell selection listener
            enableTeachingCellSelection();
        }
        
        function enableTeachingCellSelection() {
            // Clear any previous selections
            document.querySelectorAll('.cell-checkbox:checked').forEach(cb => {
                cb.checked = false;
                cb.parentElement.classList.remove('cell-selected');
            });
            
            teachingModalData.selectedCells = [];
            
            // Update toolbar message
            const toolbar = document.getElementById('mergeToolbar');
            
            // Check if in universal scheduling mode
            if (universalSchedulingMode.active) {
                const themeModalAccent = getThemeModalAccent();
                const themeAccent = getThemeAccent();
                toolbar.innerHTML = `
                    <div style="margin-bottom: 10px; font-weight: bold; color: ${themeModalAccent};">
                        Select ${teachingModalData.selectedLength} consecutive cells on ANY row:
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        Course: ${teachingModalData.courseCode} - ${teachingModalData.type} - ${teachingModalData.location}
                    </div>
                    <div style="font-size: 11px; color: ${themeAccent}; margin-bottom: 10px; font-weight: 600;">
                        ðŸ“… Universal Mode: Session ${universalSchedulingMode.sessionCount + 1}
                    </div>
                    <button class="btn-merge-cancel" onclick="cancelTeachingSelection()">âœ• Cancel</button>
                `;
                
                // Show checkboxes for ALL available cells (any row)
                document.querySelectorAll('.cell-checkbox').forEach(cb => {
                    const cell = cb.parentElement;
                    // Only show checkbox if cell is not filled/merged/hidden
                    if (!cell.classList.contains('filled-cell') && 
                        !cell.classList.contains('merged-cell') && 
                        cell.style.display !== 'none') {
                        cb.style.display = 'block';
                        cb.onchange = handleTeachingCellSelection;
                    } else {
                        cb.style.display = 'none';
                    }
                });
            } else {
                // Normal mode - only show same row
                const themeModalAccent = getThemeModalAccent();
                toolbar.innerHTML = `
                    <div style="margin-bottom: 10px; font-weight: bold; color: ${themeModalAccent};">
                        Select ${teachingModalData.selectedLength} consecutive cells on row ${teachingModalData.day}:
                    </div>
                    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                        Course: ${teachingModalData.courseCode} - ${teachingModalData.type} - ${teachingModalData.location}
                    </div>
                    <button class="btn-merge-cancel" onclick="cancelTeachingSelection()">âœ• Cancel</button>
                `;
                
                // Add checkbox listeners - only for the same row
                document.querySelectorAll('.cell-checkbox').forEach(cb => {
                    if (cb.dataset.day === teachingModalData.day) {
                        cb.style.display = 'block';
                        cb.onchange = handleTeachingCellSelection;
                    } else {
                        cb.style.display = 'none';
                    }
                });
            }
        }
        
        function handleTeachingCellSelection(e) {
            const checkbox = e.target;
            const day = checkbox.dataset.day;
            const slot = parseInt(checkbox.dataset.slot);
            
            if (checkbox.checked) {
                teachingModalData.selectedCells.push({ day, slot, element: checkbox.parentElement });
                checkbox.parentElement.classList.add('cell-selected');
                
                // Check if we have enough cells selected
                if (teachingModalData.selectedCells.length === teachingModalData.selectedLength) {
                    // Validate: all same day and consecutive slots
                    const firstDay = teachingModalData.selectedCells[0].day;
                    const allSameDay = teachingModalData.selectedCells.every(c => c.day === firstDay);
                    
                    if (!allSameDay) {
                        alert('Selected cells must be on the same day!');
                        checkbox.checked = false;
                        checkbox.parentElement.classList.remove('cell-selected');
                        teachingModalData.selectedCells = teachingModalData.selectedCells.filter(c => !(c.day === day && c.slot === slot));
                        return;
                    }
                    
                    const slots = teachingModalData.selectedCells.map(c => c.slot).sort((a, b) => a - b);
                    let isConsecutive = true;
                    for (let i = 1; i < slots.length; i++) {
                        if (slots[i] !== slots[i-1] + 1) {
                            isConsecutive = false;
                            break;
                        }
                    }
                    
                    if (!isConsecutive) {
                        alert('Selected cells must be consecutive (no gaps)!');
                        checkbox.checked = false;
                        checkbox.parentElement.classList.remove('cell-selected');
                        teachingModalData.selectedCells = teachingModalData.selectedCells.filter(c => !(c.day === day && c.slot === slot));
                    } else {
                        // Perfect! Update teachingModalData.day to the selected day
                        teachingModalData.day = firstDay;
                        
                        // Apply the merge
                        applyTeachingMerge();
                    }
                } else if (teachingModalData.selectedCells.length > teachingModalData.selectedLength) {
                    // Too many - uncheck this one
                    alert(`Only ${teachingModalData.selectedLength} cells needed`);
                    checkbox.checked = false;
                    checkbox.parentElement.classList.remove('cell-selected');
                    teachingModalData.selectedCells = teachingModalData.selectedCells.filter(c => !(c.day === day && c.slot === slot));
                }
            } else {
                checkbox.parentElement.classList.remove('cell-selected');
                teachingModalData.selectedCells = teachingModalData.selectedCells.filter(c => !(c.day === day && c.slot === slot));
            }
        }
        
        function applyTeachingMerge() {
            const {day, courseCode, type, section, location, selectedLength, selectedCells, transferFlag} = teachingModalData;
            const slots = selectedCells.map(c => c.slot).sort((a, b) => a - b);
            const startSlot = slots[0];
            
            // Create merged cell
            const firstCell = document.getElementById(`cell-${day}-${startSlot}`);
            
            // Set colspan
            firstCell.setAttribute('colspan', selectedLength);
            firstCell.setAttribute('data-merged', 'true');
            firstCell.classList.add('merged-cell');
            
            // Hide other cells
            for (let i = 1; i < selectedLength; i++) {
                const cellToHide = document.getElementById(`cell-${day}-${slots[i]}`);
                cellToHide.style.display = 'none';
                cellToHide.setAttribute('data-hidden-by-merge', `cell-${day}-${startSlot}`);
            }
            
            // Clear and create content
            const existingCheckbox = firstCell.querySelector('.cell-checkbox');
            firstCell.innerHTML = '';
            
            if (existingCheckbox) {
                firstCell.appendChild(existingCheckbox);
                existingCheckbox.checked = false;
                existingCheckbox.style.display = 'none';
            }
            
            // Add unmerge button
            const unmergeBtn = document.createElement('button');
            unmergeBtn.textContent = 'âœ•';
            unmergeBtn.className = 'btn-cancel';
            unmergeBtn.style.position = 'absolute';
            unmergeBtn.style.top = '3px';
            unmergeBtn.style.right = '3px';
            unmergeBtn.style.zIndex = '100';
            unmergeBtn.onclick = function(e) {
                e.stopPropagation();
                unmergeCells(day, startSlot, selectedLength);
            };
            firstCell.appendChild(unmergeBtn);
            
            // Display content
            const displayContent = document.createElement('div');
            displayContent.className = 'merged-cell-content';
            displayContent.style.cursor = 'pointer';
            displayContent.title = 'Click to edit';
            
            const courseDiv = document.createElement('div');
            courseDiv.style.fontWeight = 'bold';
            courseDiv.style.fontSize = '14px';
            courseDiv.style.color = '#001F3F';
            courseDiv.style.lineHeight = '1.3';
            // Display course code with section if provided
            courseDiv.textContent = section ? `${courseCode.toUpperCase()} (${section})` : courseCode.toUpperCase();
                        if (transferFlag) {
                courseDiv.textContent += ' *';
            }
displayContent.appendChild(courseDiv);
            
            const typeDiv = document.createElement('div');
            typeDiv.style.fontSize = '12px';
            typeDiv.style.fontWeight = 'bold';
            typeDiv.style.lineHeight = '1.3';
            typeDiv.style.color = getThemeModalAccent();
            typeDiv.textContent = type;
            displayContent.appendChild(typeDiv);
            
            const locationDiv = document.createElement('div');
            locationDiv.style.fontSize = '11px';
            locationDiv.style.color = '#666';
            locationDiv.style.lineHeight = '1.3';
            locationDiv.textContent = location.toUpperCase();
            displayContent.appendChild(locationDiv);
            
            displayContent.onclick = function() {
                editMergedCell(firstCell, day, startSlot);
            };
            
            firstCell.appendChild(displayContent);
            
            // Store data with section
            mergedCells[`cell-${day}-${startSlot}`] = {
                day: day,
                startSlot: startSlot,
                colspan: selectedLength,
                slots: slots,
                courseCode: courseCode,
                type: type,
                section: section,
                location: location,
                                transferFlag: transferFlag,
applied: true
            };
            
            // Clean up
            cancelTeachingSelection();
            updateCalculations();
            
            // Check if in universal scheduling mode
            if (universalSchedulingMode.active) {
                // Increment session count
                universalSchedulingMode.sessionCount++;
                updateUniversalSchedulingCount();
                
                // Store last scheduled position
                universalSchedulingMode.lastScheduledDay = day;
                universalSchedulingMode.lastScheduledSlot = startSlot;
                
                // Reopen teaching modal after a short delay for next session
                setTimeout(() => {
                    openUniversalTeachingModal();
                }, 800);
                return;
            }
            
            // Check if there are more days to schedule from the popup
            if (window.pendingScheduleDays && window.pendingScheduleDays.currentIndex < window.pendingScheduleDays.days.length) {
                const pending = window.pendingScheduleDays;
                pending.currentIndex++;
                
                if (pending.currentIndex < pending.days.length) {
                    // Schedule next day automatically
                    setTimeout(() => {
                        const nextDay = pending.days[pending.currentIndex];
                        addToSchedule(nextDay, pending.startTime, pending.courseCode, pending.type, pending.section, pending.location, pending.sessionLength);
                    }, 500);
                } else {
                    // All days completed
                    setTimeout(() => {
                        alert(`Course ${pending.courseCode} scheduled successfully on ${pending.days.join(', ')}!`);
                        window.pendingScheduleDays = null;
                    }, 500);
                }
            }
        }
        
        function cancelTeachingSelection() {
            // Hide checkboxes and toolbar
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                cb.style.display = 'none';
                cb.checked = false;
                cb.onchange = null;
            });
            document.querySelectorAll('.cell-selected').forEach(cell => {
                cell.classList.remove('cell-selected');
            });
            document.getElementById('mergeToolbar').style.display = 'none';
            
            // Reset teaching modal data
            teachingModalData = {
                day: null,
                slot: null,
                courseCode: '',
                type: '',
                location: '',
                transferFlag: false,
                selectedLength: 0,
                selectedCells: []
            };
        }
        
        // Auto-fill dates with current date
        window.setCurrentDates = function() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const currentDate = `${day}/${month}/${year}`;
            
            // Set instructor date
            const instructorDateField = document.getElementById('instructorAckDate');
            if (instructorDateField && !instructorDateField.value) {
                instructorDateField.value = currentDate;
            }
            
            // Set HoD date
            const hodDateField = document.getElementById('hodDate');
            if (hodDateField && !hodDateField.value) {
                hodDateField.value = currentDate;
            }
        };
        
        function closeTeachingModal() {
            document.getElementById('teachingModal').classList.remove('active');
            teachingModalData = {
                day: null,
                slot: null,
                courseCode: '',
                type: '',
                location: '',
                transferFlag: false,
                selectedLength: 0,
                selectedCells: []
            };
        }
        
        initSchedule();
        
        // Auto-set years on page load
        autoSetYears();
    
        
        // Recompute merged widths on resize
        function reflowMergedSessions() {
            Object.keys(mergedSessions).forEach(sessionId => {
                const s = mergedSessions[sessionId];
                const firstCell = document.getElementById(`cell-${s.day}-${s.startSlot}`);
                const lastCell = document.getElementById(`cell-${s.day}-${s.startSlot + s.length - 1}`);
                if (!firstCell || !lastCell) return;
                const firstRect = firstCell.getBoundingClientRect();
                const lastRect = lastCell.getBoundingClientRect();
                const width = Math.round(lastRect.right - firstRect.left);
                const mergedDiv = firstCell.querySelector(`#${sessionId}`);
                if (mergedDiv) mergedDiv.style.width = width + 'px';
            });
        }
        window.addEventListener('resize', reflowMergedSessions);
        
        
        // ---- Resize Teaching Sessions ----
        let _resizeState = null;
        
        function startResizeSession(e, sessionId){
            e.preventDefault();
            const s = mergedSessions[sessionId];
            if (!s) return;
            const firstCell = document.getElementById(`cell-${s.day}-${s.startSlot}`);
            const mergedDiv = firstCell.querySelector(`#${sessionId}`);
            if (!mergedDiv) return;
            
            // Build grid x-positions for that row (for snapping)
            const slots = [];
            for (let i = 0; i < 16; i++){
                const c = document.getElementById(`cell-${s.day}-${i}`);
                const rect = c.getBoundingClientRect();
                slots.push({index:i,left:rect.left,right:rect.right,width:rect.width,el:c});
            }
            const firstRect = firstCell.getBoundingClientRect();
            const initialRight = firstRect.left + mergedDiv.offsetWidth;
            
            _resizeState = {
                sessionId,
                startX: e.clientX,
                initialWidth: mergedDiv.offsetWidth,
                firstLeft: firstRect.left,
                slots,
                s,
                mergedDiv
            };
            document.addEventListener('mousemove', onResizeMove);
            document.addEventListener('mouseup', onResizeEnd);
            mergedDiv.classList.add('resizing');
        }
        
        function onResizeMove(e){
            if (!_resizeState) return;
            const dx = e.clientX - _resizeState.startX;
            const newWidth = Math.max(_resizeState.slots[0].width, _resizeState.initialWidth + dx);
            _resizeState.mergedDiv.style.width = newWidth + 'px';
        }
        
        function onResizeEnd(e){
            if (!_resizeState) return;
            const { firstLeft, slots, s, mergedDiv } = _resizeState;
            mergedDiv.classList.remove('resizing');
            document.removeEventListener('mousemove', onResizeMove);
            document.removeEventListener('mouseup', onResizeEnd);
            
            const rightEdge = firstLeft + mergedDiv.offsetWidth;
            // Determine how many full slots we span
            let newEndIndex = s.startSlot;
            for (let i = s.startSlot; i < 16; i++){
                if (slots[i].right <= rightEdge + 1) newEndIndex = i;
                else break;
            }
            let newLength = newEndIndex - s.startSlot + 1;
            newLength = Math.max(1, Math.min(16 - s.startSlot, newLength));
            
            // Check availability of target cells (excluding current covered cells)
            for (let i = 0; i < newLength; i++){
                const idx = s.startSlot + i;
                const cell = document.getElementById(`cell-${s.day}-${idx}`);
                if (cell.dataset.sessionId && cell.dataset.sessionId !== mergedDiv.id){
                    // occupied by another session; snap back to current length
                    newLength = s.length;
                    break;
                }
            }
            
            // If length unchanged, just reset visual width precisely and return
            if (newLength === s.length){
                const firstCell = document.getElementById(`cell-${s.day}-${s.startSlot}`);
                const lastCell = document.getElementById(`cell-${s.day}-${s.startSlot + s.length - 1}`);
                const r1 = firstCell.getBoundingClientRect();
                const r2 = lastCell.getBoundingClientRect();
                const w = Math.round(r2.right - r1.left);
                mergedDiv.style.width = w + 'px';
                _resizeState = null;
                return;
            }
            
            // Otherwise, update occupied cells and session length
            // Clear old occupied flags
            for (let i = 1; i < s.length; i++){
                const oldCell = document.getElementById(`cell-${s.day}-${s.startSlot + i}`);
                if (oldCell){
                    oldCell.classList.remove('cell-merged-occupied');
                    delete oldCell.dataset.sessionId;
                }
            }
            // Mark new occupied cells
            for (let i = 1; i < newLength; i++){
                const newCell = document.getElementById(`cell-${s.day}-${s.startSlot + i}`);
                if (newCell){
                    newCell.classList.add('cell-merged-occupied');
                    newCell.dataset.sessionId = mergedDiv.id;
                }
            }
            s.length = newLength;
            
            // Snap width exactly
            const firstCell2 = document.getElementById(`cell-${s.day}-${s.startSlot}`);
            const lastCell2 = document.getElementById(`cell-${s.day}-${s.startSlot + s.length - 1}`);
            const rr1 = firstCell2.getBoundingClientRect();
            const rr2 = lastCell2.getBoundingClientRect();
            const w2 = Math.round(rr2.right - rr1.left);
            mergedDiv.style.width = w2 + 'px';
            
            updateCalculations();
            _resizeState = null;
        }
        
        // ---- Merge Cells System ----
        let mergeMode = false;
        
        function toggleMergeMode() {
            mergeMode = !mergeMode;
            const container = document.querySelector('.container');
            const toolbar = document.getElementById('mergeToolbar');
            const mergeBtn = event.target;
            
            if (mergeMode) {
                container.classList.add('merge-mode-active');
                toolbar.classList.add('active');
                mergeBtn.textContent = 'ðŸ”— Merge Mode ON';
                mergeBtn.style.background = '#f44336';
            } else {
                container.classList.remove('merge-mode-active');
                toolbar.classList.remove('active');
                mergeBtn.textContent = 'ðŸ”— Merge Cells';
                mergeBtn.style.background = '#FF9800';
                // Uncheck all checkboxes
                document.querySelectorAll('.cell-checkbox').forEach(cb => {
                    cb.checked = false;
                    cb.parentElement.classList.remove('cell-selected');
                });
            }
        }
        
        function cancelMerge() {
            // Uncheck all checkboxes
            document.querySelectorAll('.cell-checkbox').forEach(cb => {
                cb.checked = false;
                cb.parentElement.classList.remove('cell-selected');
            });
        }
        
        function confirmMerge() {
            const selectedCells = [];
            document.querySelectorAll('.cell-checkbox:checked').forEach(cb => {
                selectedCells.push({
                    day: cb.dataset.day,
                    slot: parseInt(cb.dataset.slot),
                    element: cb.parentElement
                });
            });
            
            if (selectedCells.length < 2) {
                alert('Please select at least 2 cells to merge');
                return;
            }
            
            // Validate: all cells must be in the same row and consecutive
            const day = selectedCells[0].day;
            const slots = selectedCells.map(c => c.slot).sort((a, b) => a - b);
            
            // Check if all cells are in same row
            if (!selectedCells.every(c => c.day === day)) {
                alert('All selected cells must be in the same row (same day)');
                return;
            }
            
            // Check if cells are consecutive
            for (let i = 1; i < slots.length; i++) {
                if (slots[i] !== slots[i-1] + 1) {
                    alert('Selected cells must be consecutive (no gaps)');
                    return;
                }
            }
            
            // Check if any cell is already merged or has selected content
            for (let cell of selectedCells) {
                const cellElement = cell.element;
                
                // Check if already merged
                if (cellElement.hasAttribute('data-merged') || 
                    cellElement.querySelector('.merged-cell-content') ||
                    cellElement.style.display === 'none') {
                    alert('Some selected cells are already merged');
                    return;
                }
                
                // Check if cell has actual content (not just empty TYPE selector)
                const typeSelector = cellElement.querySelector('.type-selector');
                if (typeSelector && typeSelector.value !== '') {
                    alert('Some selected cells already have content. Please clear them first.');
                    return;
                }
            }
            
            // Store merge data temporarily and open modal
            window.pendingMerge = {
                day: day,
                firstSlot: slots[0],
                colspan: slots.length,
                slots: slots,
                selectedCells: selectedCells
            };
            
            // Clear modal fields
            document.getElementById('modalCourseCode').value = '';
            document.getElementById('modalType').value = '';
            document.getElementById('modalLocation').value = '';
            
            // Open modal
            document.getElementById('mergeModal').classList.add('active');
            document.getElementById('modalCourseCode').focus();
        }
        
        function closeModal() {
            document.getElementById('mergeModal').classList.remove('active');
            window.pendingMerge = null;
        }
        
        function saveModalData() {
            const courseCode = document.getElementById('modalCourseCode').value.trim().toUpperCase();
            const type = document.getElementById('modalType').value;
            const location = document.getElementById('modalLocation').value.trim().toUpperCase();
            
            if (!courseCode) {
                alert('Please enter a course code');
                document.getElementById('modalCourseCode').focus();
                return;
            }
            
            if (!type) {
                alert('Please select a type (LAB/LEC/TUT)');
                document.getElementById('modalType').focus();
                return;
            }
            
            if (!location) {
                alert('Please enter a location');
                document.getElementById('modalLocation').focus();
                return;
            }
            
            if (!window.pendingMerge) {
                alert('Error: No pending merge data');
                return;
            }
            
            const { day, firstSlot, colspan, slots, selectedCells } = window.pendingMerge;
            const firstCell = document.getElementById(`cell-${day}-${firstSlot}`);
            
            // Set colspan on first cell
            firstCell.setAttribute('colspan', colspan);
            firstCell.setAttribute('data-merged', 'true');
            firstCell.classList.add('merged-cell');
            firstCell.classList.remove('cell-selected');
            
            // Hide other cells
            for (let i = 1; i < slots.length; i++) {
                const cellToHide = document.getElementById(`cell-${day}-${slots[i]}`);
                cellToHide.style.display = 'none';
                cellToHide.setAttribute('data-hidden-by-merge', `cell-${day}-${firstSlot}`);
            }
            
            // Clear existing content
            const existingCheckbox = firstCell.querySelector('.cell-checkbox');
            firstCell.innerHTML = '';
            
            // Re-add checkbox
            if (existingCheckbox) {
                firstCell.appendChild(existingCheckbox);
                existingCheckbox.checked = false;
            }
            
            // Add unmerge button
            const unmergeBtn = document.createElement('button');
            unmergeBtn.textContent = 'âœ•';
            unmergeBtn.className = 'btn-cancel';
            unmergeBtn.style.position = 'absolute';
            unmergeBtn.style.top = '3px';
            unmergeBtn.style.right = '3px';
            unmergeBtn.style.zIndex = '100';
            unmergeBtn.onclick = function(e) {
                e.stopPropagation();
                unmergeCells(day, firstSlot, colspan);
            };
            firstCell.appendChild(unmergeBtn);
            
            // Create display content
            const displayContent = document.createElement('div');
            displayContent.className = 'merged-cell-content';
            displayContent.style.cursor = 'pointer';
            displayContent.title = 'Click to edit';
            
            const courseDiv = document.createElement('div');
            courseDiv.style.fontWeight = 'bold';
            courseDiv.style.fontSize = '14px';
            courseDiv.style.color = '#001F3F';
            courseDiv.style.lineHeight = '1.3';
            courseDiv.textContent = courseCode.toUpperCase();
            displayContent.appendChild(courseDiv);
            
            const typeDiv = document.createElement('div');
            typeDiv.style.fontSize = '12px';
            typeDiv.style.fontWeight = 'bold';
            typeDiv.style.lineHeight = '1.3';
            typeDiv.style.color = getThemeModalAccent();
            typeDiv.textContent = type;
            displayContent.appendChild(typeDiv);
            
            const locationDiv = document.createElement('div');
            locationDiv.style.fontSize = '11px';
            locationDiv.style.color = '#666';
            locationDiv.style.lineHeight = '1.3';
            locationDiv.textContent = location.toUpperCase();
            displayContent.appendChild(locationDiv);
            
            // Click to edit
            displayContent.onclick = function() {
                editMergedCell(firstCell, day, firstSlot);
            };
            
            firstCell.appendChild(displayContent);
            
            // Store merged cell data
            mergedCells[`cell-${day}-${firstSlot}`] = {
                day: day,
                startSlot: firstSlot,
                colspan: colspan,
                slots: slots,
                courseCode: courseCode,
                type: type,
                location: location,
                applied: true
            };
            
            // Uncheck checkboxes
            selectedCells.forEach(c => {
                const cb = c.element.querySelector('.cell-checkbox');
                if (cb) cb.checked = false;
            });
            
            // Close modal
            closeModal();
            
            updateCalculations();
        }
        
        function editMergedCell(cell, day, startSlot) {
            const cellId = `cell-${day}-${startSlot}`;
            const mergedData = mergedCells[cellId];
            
            if (!mergedData) return;
            
            // Set modal values
            document.getElementById('modalCourseCode').value = mergedData.courseCode || '';
            document.getElementById('modalType').value = mergedData.type || '';
            document.getElementById('modalLocation').value = mergedData.location || '';
            
            // Store current cell for updating
            window.pendingMerge = {
                day: day,
                firstSlot: startSlot,
                colspan: mergedData.colspan,
                slots: mergedData.slots,
                isEdit: true
            };
            
            // Open modal
            document.getElementById('mergeModal').classList.add('active');
            document.getElementById('modalCourseCode').focus();
        }
        
        
        function unmergeCells(day, startSlot, colspan) {
            const firstCell = document.getElementById(`cell-${day}-${startSlot}`);
            
            // Remove colspan and merged attributes
            firstCell.removeAttribute('colspan');
            firstCell.removeAttribute('data-merged');
            firstCell.classList.remove('merged-cell');
            
            // Show hidden cells
            for (let i = 1; i < colspan; i++) {
                const cellToShow = document.getElementById(`cell-${day}-${startSlot + i}`);
                if (cellToShow) {
                    cellToShow.style.display = '';
                    cellToShow.removeAttribute('data-hidden-by-merge');
                }
            }
            
            // Restore original cell content
            firstCell.innerHTML = '';
            createCellContent(firstCell, day, startSlot);
            
            // Remove from merged cells data
            delete mergedCells[`cell-${day}-${startSlot}`];
            
            updateCalculations();
        }
        
        // Auto-initialize semester, Hijri year, and TERM CODE on page load
        window.addEventListener('DOMContentLoaded', function() {
            autoSetYears();
            // Initialize courses after DOM is ready
            initializeCourses();
        });
        </script>


<script>
// ========== FLOATING MENU FUNCTIONS ==========
function toggleFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    menu.classList.toggle('active');
}

function closeFloatingMenu() {
    const menu = document.getElementById('floatingMenu');
    menu.classList.remove('active');
}

// Close menu when clicking outside
document.addEventListener('click', function(event) {
    const menu = document.getElementById('floatingMenu');
    if (menu && !menu.contains(event.target)) {
        closeFloatingMenu();
    }
});

// Apply background colors based on cell type
function applyCellColors() {
    const cells = document.querySelectorAll('.schedule-table td');
    cells.forEach(cell => {
        const select = cell.querySelector('.type-selector');
        if (select && select.value) {
            cell.className = cell.className.replace(/type-\w+/g, '');
            cell.classList.add('type-' + select.value);
        }
    });
}

// Apply colors on page load
document.addEventListener('DOMContentLoaded', function() {
    applyCellColors();
    setCurrentDates();
    
    // Initialize department display (updates header and faculty field)
    updateDepartmentDisplay();
    
    // Populate faculty dropdown
    populateFacultyDropdown();
    
    // Add change handler for faculty selection
    attachFacultyChangeListener();
    
});

// Apply colors when any TYPE is changed
document.addEventListener('change', function(e) {
    if (e.target.classList.contains('type-selector')) {
        const cell = e.target.closest('td');
        if (cell) {
            cell.className = cell.className.replace(/type-\w+/g, '');
            if (e.target.value) {
                cell.classList.add('type-' + e.target.value);
            }
        }
    }
});
</script>
</div>

<!-- ========== MULTIPLE SCHEDULE PAGE ========== -->
<div class="page-container user-guide-page" id="userGuidePage">
    <div style="position: fixed; top: 20px; left: 20px; z-index: 999;">
        <button class="ios-button ios-button-gray" onclick="showLandingPage()">
            <div class="ios-button-icon">
                <span>ðŸ </span>
            </div>
            <div class="ios-button-label">Home</div>
        </button>
    </div>
    
    <h1>ðŸ“– Faculty Schedule System - User Guide</h1>
    
    <!-- Getting Started -->
    <div class="guide-section">
        <h2>ðŸš€ Getting Started</h2>
        <p>Welcome to the Faculty Schedule System. This guide will help you create and manage faculty schedules efficiently.</p>
        
        <div class="guide-step">
            <div class="guide-step-number">1</div>
            <div class="guide-step-content">
                <strong>Select Faculty Information</strong>
                <p>Choose the faculty member from the dropdown or select "Other" to enter a custom name. Fill in rank, office, phone, and email details.</p>
            </div>
        </div>
        
        <div class="guide-step">
            <div class="guide-step-number">2</div>
            <div class="guide-step-content">
                <strong>Add Courses</strong>
                <p>Click "Add Course" to add courses to the faculty's load. Select from the predefined list or enter custom course codes.</p>
            </div>
        </div>
        
        <div class="guide-step">
            <div class="guide-step-number">3</div>
            <div class="guide-step-content">
                <strong>Schedule Activities</strong>
                <p>Click on any cell in the schedule grid to open the scheduling modal. Choose the activity type and fill in the required details.</p>
            </div>
        </div>
    </div>
    
    <!-- Activity Types -->
    <div class="guide-section">
        <h2>ðŸ“š Activity Types</h2>
        
        <h3>Teaching Activities</h3>
        <ul>
            <li><strong>LEC (Lecture)</strong> - Regular classroom lectures</li>
            <li><strong>LAB (Laboratory)</strong> - Hands-on lab sessions</li>
            <li><strong>TUT (Tutorial)</strong> - Small group tutorial sessions</li>
        </ul>
        
        <h3>Other Activities</h3>
        <ul>
            <li><strong>OH (Office Hours)</strong> - Student consultation time</li>
            <li><strong>CH (Compensated Hours)</strong> - Hours compensated for other duties</li>
            <li><strong>NS (Non-Scheduled)</strong> - Reserved non-scheduled time</li>
            <li><strong>BREAK</strong> - Break periods</li>
            <li><strong>ACTIVITY</strong> - Committee meetings and other activities (PC, PAEC, DAC, etc.)</li>
        </ul>
    </div>
    
    <!-- Batch Selection -->
    <div class="guide-section">
        <h2>âœ… Batch Cell Selection</h2>
        <p>Schedule multiple sessions of the same course quickly using batch selection:</p>
        
        <div class="guide-step">
            <div class="guide-step-number">1</div>
            <div class="guide-step-content">
                <strong>Open Scheduling Modal</strong>
                <p>Click any cell and fill in course details (code, type, location).</p>
            </div>
        </div>
        
        <div class="guide-step">
            <div class="guide-step-number">2</div>
            <div class="guide-step-content">
                <strong>Select Duration & Repetitions</strong>
                <p>Choose session length (1-5 hours) and how many times to schedule.</p>
            </div>
        </div>
        
        <div class="guide-step">
            <div class="guide-step-number">3</div>
            <div class="guide-step-content">
                <strong>Select Cells</strong>
                <p>Checkboxes appear on available cells. Click to select the starting cell for each session. Use auto-extend for multi-hour sessions.</p>
            </div>
        </div>
        
        <div class="tip-box">
            Hold <span class="keyboard-shortcut">Shift</span> while clicking to quickly select multiple cells in sequence.
        </div>
    </div>
    
    <!-- Themes -->
    <div class="guide-section">
        <h2>ðŸŽ¨ Themes</h2>
        <p>Customize the appearance with 7 professional color themes:</p>
        <ul>
            <li><strong>Navy</strong> - Default RCJY theme</li>
            <li><strong>Cyan</strong> - Fresh teal tones</li>
            <li><strong>Green</strong> - Nature-inspired</li>
            <li><strong>Blue</strong> - Classic blue</li>
            <li><strong>Purple</strong> - Elegant purple</li>
            <li><strong>Gold</strong> - Warm gold accents</li>
            <li><strong>Cream</strong> - Classic cream/brown</li>
        </ul>
        <p>Access themes via the floating menu (â–¼ button) â†’ Theme option.</p>
    </div>
    
    <!-- PDF Export -->
    <div class="guide-section">
        <h2>ðŸ“„ PDF Export</h2>
        <p>Generate professional PDF documents of the schedule:</p>
        
        <div class="guide-step">
            <div class="guide-step-number">1</div>
            <div class="guide-step-content">
                <strong>Lock the Schedule</strong>
                <p>Click the ðŸ”’ Lock button in the floating menu to finalize the schedule.</p>
            </div>
        </div>
        
        <div class="guide-step">
            <div class="guide-step-number">2</div>
            <div class="guide-step-content">
                <strong>Export to PDF</strong>
                <p>Click "Export to PDF" to generate and download the schedule document.</p>
            </div>
        </div>
        
        <div class="warning-box">
            Make sure all required fields are filled before exporting. The acknowledgment section requires signatures.
        </div>
    </div>
    
    <!-- Keyboard Shortcuts -->
    <div class="guide-section">
        <h2>âŒ¨ï¸ Keyboard Shortcuts</h2>
        <ul>
            <li><span class="keyboard-shortcut">Escape</span> - Close modals and cancel operations</li>
            <li><span class="keyboard-shortcut">Enter</span> - Confirm/Save in modals</li>
            <li><span class="keyboard-shortcut">Shift + Click</span> - Multi-select cells in batch mode</li>
        </ul>
    </div>
    
    <!-- Tips -->
    <div class="guide-section">
        <h2>ðŸ’¡ Pro Tips</h2>
        <ul>
            <li>Use the "Transfer Knowledge" checkbox for sessions involving knowledge transfer between faculty.</li>
            <li>The summary section automatically calculates total teaching hours, office hours, and workload.</li>
            <li>All changes are preserved in the browser - refresh won't lose your work within a session.</li>
            <li>Click on any merged cell to edit or delete it.</li>
            <li>The schedule follows a Sun-Thu week with 16 time slots per day.</li>
        </ul>
    </div>
</div>

<script>
// ========== NAVIGATION FUNCTIONS ==========
function showLandingPage() {
    document.getElementById('landingPage').classList.add('active');
    document.getElementById('individualSchedulePage').classList.remove('active');
    document.getElementById('userGuidePage').classList.remove('active');
}

function showIndividualSchedule() {
    document.getElementById('landingPage').classList.remove('active');
    document.getElementById('individualSchedulePage').classList.add('active');
    document.getElementById('userGuidePage').classList.remove('active');
}

function showUserGuide() {
    document.getElementById('landingPage').classList.remove('active');
    document.getElementById('individualSchedulePage').classList.remove('active');
    document.getElementById('userGuidePage').classList.add('active');
}

// ========== PDF EXPORT FUNCTION ==========
async function exportToPDF() {
    const { jsPDF } = window.jspdf;
    
    // First check if we're on the manual creation page (has container class directly)
    let scheduleContainers = document.querySelectorAll('.schedule-item > .container');
    
    // If not found, we might be on the manual creation page itself
    if (scheduleContainers.length === 0) {
        const singleContainer = document.querySelector('.container');
        if (singleContainer && !singleContainer.closest('.landing-page')) {
            scheduleContainers = [singleContainer];
        }
    }
    
    if (scheduleContainers.length === 0) {
        alert('No schedules to export!\n\nPlease create a schedule first:\n1. Fill in faculty information\n2. Add courses to schedule\n3. Then try exporting again');
        return;
    }
    
    // Show loading message
    const loadingMsg = document.createElement('div');
    loadingMsg.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(5, 41, 118, 0.95); color: white; padding: 2rem 3rem; border-radius: 12px; font-size: 1.2rem; font-weight: bold; z-index: 10000; box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center;';
    loadingMsg.innerHTML = 'ðŸ“„ Creating PDF...<br><small style="font-size: 0.8rem; opacity: 0.9;">Capturing exact screen layout</small>';
    document.body.appendChild(loadingMsg);
    
    // Hide buttons and UI elements temporarily
    const elementsToHide = document.querySelectorAll('#actionButtons, .course-row button, .btn-cancel, .simple-cancel');
    elementsToHide.forEach(el => {
        if (el) el.style.display = 'none';
    });
    
    // Scroll to top for consistent capture
    window.scrollTo(0, 0);
    
    // Add pdf-export-mode class for CSS styling
    document.body.classList.add('pdf-export-mode');
    
    try {
        // Create PDF in landscape A4
        const pdf = new jsPDF({
            orientation: 'landscape',
            unit: 'mm',
            format: 'a4'
        });
        
        let firstPage = true;
        let scheduleNum = 1;
        
        for (let container of scheduleContainers) {
            // Update progress
            loadingMsg.innerHTML = `ðŸ“„ Creating PDF...<br><small style="font-size: 0.8rem; opacity: 0.9;">Processing schedule ${scheduleNum} of ${scheduleContainers.length}</small>`;
            
            // Save original styles and add padding for PDF capture
            const originalPadding = container.style.padding;
            const originalBoxSizing = container.style.boxSizing;
            const originalOverflow = container.style.overflow;
            container.style.padding = '15px 25px';
            container.style.boxSizing = 'border-box';
            container.style.overflow = 'hidden';
            
            // Ensure all sections fit within container
            const sections = container.querySelectorAll('.header, .department-info, .faculty-info, .schedule-table-wrapper, .legend, .summary, .footer');
            sections.forEach(section => {
                section.style.boxSizing = 'border-box';
            });
            
            // Capture each schedule as canvas
            const canvas = await html2canvas(container, {
                scale: 2.5,
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            });
            
            // Restore original styles
            container.style.padding = originalPadding;
            container.style.boxSizing = originalBoxSizing;
            container.style.overflow = originalOverflow;
            
            // Use JPEG with 90% quality
            const imgData = canvas.toDataURL('image/jpeg', 0.9);
            
            // Calculate dimensions to fit A4 landscape
            const pdfWidth = 287;
            const pdfHeight = 200;
            const imgWidth = canvas.width;
            const imgHeight = canvas.height;
            const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
            
            const scaledWidth = imgWidth * ratio;
            const scaledHeight = imgHeight * ratio;
            
            // Center the image on the page
            const xOffset = (297 - scaledWidth) / 2;
            const yOffset = (210 - scaledHeight) / 2;
            
            // Add new page if not first
            if (!firstPage) {
                pdf.addPage();
            }
            firstPage = false;
            
            // Add image to PDF with JPEG compression
            pdf.addImage(imgData, 'JPEG', xOffset, yOffset, scaledWidth, scaledHeight, '', 'FAST');
            
            scheduleNum++;
        }
        
        // Generate filename with timestamp
        const now = new Date();
        const dateStr = now.toISOString().split('T')[0];
        const filename = `Faculty_Schedules_${dateStr}.pdf`;
        
        // Save the PDF
        pdf.save(filename);
        
        // Success message
        loadingMsg.innerHTML = `âœ… PDF Downloaded!<br><small style="font-size: 0.8rem; opacity: 0.9;">Saved as ${filename}</small>`;
        loadingMsg.style.background = 'rgba(32, 206, 118, 0.95)';
        
    } catch (error) {
        console.error('Error creating PDF:', error);
        loadingMsg.innerHTML = `âŒ Error creating PDF<br><small style="font-size: 0.8rem; opacity: 0.9;">${error.message || 'Please try again'}</small>`;
        loadingMsg.style.background = 'rgba(204, 0, 0, 0.95)';
    }
    
    // Remove pdf-export-mode class
    document.body.classList.remove('pdf-export-mode');
    
    setTimeout(() => {
        elementsToHide.forEach(el => {
            if (el && el.id !== 'actionButtons') {
                el.style.display = '';
            }
        });
        loadingMsg.remove();
    }, 3000);
}
</script>



<!-- Schedule Popup Modal -->
<div id="schedulePopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 3px solid #3498db; padding-bottom: 1rem;">
            <h2 style="margin: 0; color: #2c3e50; font-size: 1.8rem;">ðŸ“… Schedule Course</h2>
            <button onclick="closeSchedulePopup()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #e74c3c; font-weight: bold; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">&times;</button>
        </div>
        
        <div style="background: #ecf0f1; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <strong style="color: #2c3e50;">Course:</strong>
            <div id="popupCourseInfo" style="font-size: 1.2rem; color: #34495e; margin-top: 0.5rem; font-weight: 600;"></div>
        </div>
        
        <!-- NUMBER OF TIMES SELECTOR - AT THE TOP -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);">
            <label style="font-weight: bold; display: block; margin-bottom: 0.75rem; color: white; font-size: 1.15rem; display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-size: 1.5rem;">ðŸ”¢</span>
                Number of Times to Schedule This Course:
            </label>
            <select id="popupScheduleCount" onchange="updateScheduleSections()" style="width: 100%; padding: 0.9rem; border: 3px solid white; border-radius: 8px; font-size: 1.15rem; background: white; font-weight: bold; color: #667eea; cursor: pointer; transition: all 0.3s;">
                <option value="1">1 Time</option>
                <option value="2">2 Times</option>
                <option value="3">3 Times</option>
                <option value="4">4 Times</option>
                <option value="5">5 Times</option>
                <option value="6">6 Times</option>
                <option value="7">7 Times</option>
                <option value="8">8 Times</option>
                <option value="9">9 Times</option>
                <option value="10">10 Times</option>
            </select>
            <div id="scheduleCountInfo" style="margin-top: 0.75rem; font-size: 0.95rem; color: white; background: rgba(255,255,255,0.25); padding: 0.75rem; border-radius: 6px; display: none; backdrop-filter: blur(10px);">
                ðŸ“‹ You'll configure each schedule below with different days, times, and sections.
            </div>
        </div>
        
        <!-- DYNAMIC SCHEDULE SECTIONS CONTAINER -->
        <div id="scheduleSectionsContainer" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <!-- Schedule sections will be dynamically added here -->
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; border-top: 3px solid #ecf0f1; padding-top: 1.5rem;">
            <button onclick="closeSchedulePopup()" style="padding: 0.9rem 1.8rem; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.05rem; transition: all 0.3s; box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);" onmouseover="this.style.background='#7f8c8d'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(149, 165, 166, 0.4)'" onmouseout="this.style.background='#95a5a6'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(149, 165, 166, 0.3)'">âœ• Cancel</button>
            <button onclick="applyAllSchedules()" style="padding: 0.9rem 2.5rem; background: linear-gradient(135deg, #27ae60, #229954); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.05rem; box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(39, 174, 96, 0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 6px 20px rgba(39, 174, 96, 0.4)'">âœ“ Apply All Schedules</button>
        </div>
    </div>
</div>
</div>

<script>
let currentCourseCode = '';
let currentCourseName = '';
let popupScheduleData = []; // Store all schedule configurations

function updateScheduleSections() {
    const count = parseInt(document.getElementById('popupScheduleCount').value);
    const container = document.getElementById('scheduleSectionsContainer');
    const info = document.getElementById('scheduleCountInfo');
    
    // Show/hide info message
    if (count > 1) {
        info.style.display = 'block';
    } else {
        info.style.display = 'none';
    }
    
    // Clear existing sections
    container.innerHTML = '';
    
    // Create the specified number of schedule sections
    for (let i = 1; i <= count; i++) {
        const section = createScheduleSection(i, count);
        container.appendChild(section);
    }
}

function createScheduleSection(index, total) {
    const section = document.createElement('div');
    section.className = 'schedule-section';
    section.style.cssText = `
        border: 3px solid ${index % 2 === 0 ? '#3498db' : '#e67e22'};
        border-radius: 10px;
        padding: 1.5rem;
        background: ${index % 2 === 0 ? '#ebf5fb' : '#fef5e7'};
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
    `;
    
    section.innerHTML = `
        <div style="background: ${index % 2 === 0 ? '#3498db' : '#e67e22'}; color: white; padding: 0.75rem 1rem; border-radius: 6px; margin-bottom: 1.25rem; font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; justify-content: space-between;">
            <span>ðŸ“š Schedule #${index} ${total > 1 ? `of ${total}` : ''}</span>
            <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.9rem;">Section ${index}</span>
        </div>
        
        <div style="margin-bottom: 1.25rem;">
            <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50; font-size: 1rem;">ðŸ“… Select Days:</label>
            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <label class="day-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem 1rem; border: 2px solid #bdc3c7; border-radius: 6px; transition: all 0.2s; background: white; font-weight: 600;">
                    <input type="checkbox" value="SUN" class="day-checkbox-${index}" style="width: 18px; height: 18px; cursor: pointer;"/>
                    <span>SUN</span>
                </label>
                <label class="day-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem 1rem; border: 2px solid #bdc3c7; border-radius: 6px; transition: all 0.2s; background: white; font-weight: 600;">
                    <input type="checkbox" value="MON" class="day-checkbox-${index}" style="width: 18px; height: 18px; cursor: pointer;"/>
                    <span>MON</span>
                </label>
                <label class="day-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem 1rem; border: 2px solid #bdc3c7; border-radius: 6px; transition: all 0.2s; background: white; font-weight: 600;">
                    <input type="checkbox" value="TUE" class="day-checkbox-${index}" style="width: 18px; height: 18px; cursor: pointer;"/>
                    <span>TUE</span>
                </label>
                <label class="day-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem 1rem; border: 2px solid #bdc3c7; border-radius: 6px; transition: all 0.2s; background: white; font-weight: 600;">
                    <input type="checkbox" value="WED" class="day-checkbox-${index}" style="width: 18px; height: 18px; cursor: pointer;"/>
                    <span>WED</span>
                </label>
                <label class="day-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.75rem 1rem; border: 2px solid #bdc3c7; border-radius: 6px; transition: all 0.2s; background: white; font-weight: 600;">
                    <input type="checkbox" value="THU" class="day-checkbox-${index}" style="width: 18px; height: 18px; cursor: pointer;"/>
                    <span>THU</span>
                </label>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.25rem;">
            <div>
                <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50;">â° Starting Time:</label>
                <select class="startTime-${index}" style="width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 1rem; cursor: pointer; background: white; transition: border 0.3s;">
                    <option value="">-- Select Time --</option>
                    <option value="07:15-08:05">07:15 - 08:05</option>
                    <option value="08:15-09:05">08:15 - 09:05</option>
                    <option value="09:15-10:05">09:15 - 10:05</option>
                    <option value="10:15-11:05">10:15 - 11:05</option>
                    <option value="11:15-12:05">11:15 - 12:05</option>
                    <option value="12:15-13:05">12:15 - 13:05</option>
                    <option value="13:15-14:05">13:15 - 14:05</option>
                    <option value="14:15-15:05">14:15 - 15:05</option>
                    <option value="15:15-16:05">15:15 - 16:05</option>
                    <option value="16:15-17:05">16:15 - 17:05</option>
                    <option value="17:15-18:05">17:15 - 18:05</option>
                    <option value="18:15-19:05">18:15 - 19:05</option>
                    <option value="19:15-20:05">19:15 - 20:05</option>
                    <option value="20:15-21:05">20:15 - 21:05</option>
                    <option value="21:15-22:05">21:15 - 22:05</option>
                    <option value="22:15-23:05">22:15 - 23:05</option>
                </select>
            </div>
            
            <div>
                <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50;">â±ï¸ Session Length:</label>
                <select class="sessionLength-${index}" style="width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 1rem; cursor: pointer; background: white; transition: border 0.3s;">
                    <option value="1">1 Hour</option>
                    <option value="2">2 Hours</option>
                    <option value="3">3 Hours</option>
                </select>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.25rem;">
            <div>
                <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50;">ðŸ“– Type:</label>
                <select class="type-${index}" style="width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 1rem; cursor: pointer; background: white; transition: border 0.3s;">
                    <option value="LEC">Lecture (LEC)</option>
                    <option value="LAB">Lab (LAB)</option>
                    <option value="TUT">Tutorial (TUT)</option>
                </select>
            </div>
            
            <div>
                <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50;">ðŸ”¢ Section:</label>
                <input type="text" class="section-${index}" placeholder="e.g., 01, 02" value="${index < 10 ? '0' + index : index}" style="width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 1rem; background: white; transition: border 0.3s;"/>
            </div>
        </div>
        
        <div>
            <label style="font-weight: bold; display: block; margin-bottom: 0.6rem; color: #2c3e50;">ðŸ“ Location:</label>
            <input type="text" class="location-${index}" placeholder="e.g., A/3-120B" style="width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 1rem; background: white; transition: border 0.3s;"/>
        </div>
    `;
    
    // Add hover effects for day labels
    section.querySelectorAll('.day-label').forEach(label => {
        label.addEventListener('mouseenter', () => {
            label.style.borderColor = '#3498db';
            label.style.background = '#ebf5fb';
        });
        label.addEventListener('mouseleave', () => {
            const checkbox = label.querySelector('input[type="checkbox"]');
            if (!checkbox.checked) {
                label.style.borderColor = '#bdc3c7';
                label.style.background = 'white';
            }
        });
        
        const checkbox = label.querySelector('input[type="checkbox"]');
        checkbox.addEventListener('change', () => {
            if (checkbox.checked) {
                label.style.borderColor = '#27ae60';
                label.style.background = '#e8f8f5';
            } else {
                label.style.borderColor = '#bdc3c7';
                label.style.background = 'white';
            }
        });
    });
    
    // Add focus effects for inputs
    section.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('focus', () => {
            input.style.borderColor = '#3498db';
            input.style.boxShadow = '0 0 0 3px rgba(52, 152, 219, 0.1)';
        });
        input.addEventListener('blur', () => {
            input.style.borderColor = '#bdc3c7';
            input.style.boxShadow = 'none';
        });
    });
    
    return section;
}

function openSchedulePopup(courseCode, courseName) {
    if (!courseCode || !courseName) {
        alert('Please select a course first!');
        return;
    }
    
    currentCourseCode = courseCode;
    currentCourseName = courseName;
    popupScheduleData = [];
    
    document.getElementById('popupCourseInfo').textContent = `${courseCode} - ${courseName}`;
    document.getElementById('schedulePopup').style.display = 'flex';
    
    // Reset and initialize with 1 schedule section
    document.getElementById('popupScheduleCount').value = '1';
    updateScheduleSections();
}

function closeSchedulePopup() {
    document.getElementById('schedulePopup').style.display = 'none';
    popupScheduleData = [];
}

function applyAllSchedules() {
    const count = parseInt(document.getElementById('popupScheduleCount').value);
    popupScheduleData = [];
    
    console.log('Collecting schedules, count:', count);
    
    // Collect data from all schedule sections
    for (let i = 1; i <= count; i++) {
        const selectedDays = Array.from(document.querySelectorAll(`.day-checkbox-${i}:checked`)).map(cb => cb.value);
        const startTime = document.querySelector(`.startTime-${i}`).value;
        const sessionLength = document.querySelector(`.sessionLength-${i}`).value;
        const type = document.querySelector(`.type-${i}`).value;
        const section = document.querySelector(`.section-${i}`).value.trim();
        const location = document.querySelector(`.location-${i}`).value.trim();
        
        console.log(`Schedule ${i}:`, { selectedDays, startTime, sessionLength, type, section, location });
        
        // Validate each schedule
        if (selectedDays.length === 0) {
            alert(`Schedule #${i}: Please select at least one day!`);
            return;
        }
        
        if (!startTime) {
            alert(`Schedule #${i}: Please select a starting time!`);
            return;
        }
        
        if (!location) {
            alert(`Schedule #${i}: Please enter a location!`);
            return;
        }
        
        popupScheduleData.push({
            days: selectedDays,
            startTime: startTime,
            sessionLength: parseInt(sessionLength),
            type: type,
            section: section,
            location: location
        });
    }
    
    console.log('Total schedules collected:', popupScheduleData.length);
    console.log('Schedule data:', popupScheduleData);
    
    // Store in a temporary variable before closing popup
    const schedulesToApply = [...popupScheduleData];
    
    // Close popup first
    closeSchedulePopup();
    
    // Apply all schedules in the background using the stored data
    applySchedulesInBackground(schedulesToApply);
}

function applySchedulesInBackground(schedulesToApply) {
    // Use the passed data instead of popupScheduleData (which gets cleared on close)
    const scheduleData = schedulesToApply || popupScheduleData;
    
    console.log('Applying schedules, data length:', scheduleData.length);
    console.log('Current course:', currentCourseCode);
    
    if (scheduleData.length === 0) {
        alert('âš ï¸ No schedules to apply. Please try again.');
        return;
    }
    
    let appliedCount = 0;
    
    scheduleData.forEach((schedule, scheduleIndex) => {
        console.log(`Processing schedule ${scheduleIndex + 1}:`, schedule);
        
        schedule.days.forEach(day => {
            // Find the time slot index
            const timeSlots = [
                "07:15-08:05", "08:15-09:05", "09:15-10:05", "10:15-11:05",
                "11:15-12:05", "12:15-13:05", "13:15-14:05", "14:15-15:05",
                "15:15-16:05", "16:15-17:05", "17:15-18:05", "18:15-19:05",
                "19:15-20:05", "20:15-21:05", "21:15-22:05", "22:15-23:05"
            ];
            
            const slotIndex = timeSlots.indexOf(schedule.startTime);
            
            console.log(`Looking for slot index for ${schedule.startTime}:`, slotIndex);
            
            if (slotIndex === -1) {
                console.error(`Invalid time slot: ${schedule.startTime}`);
                return;
            }
            
            // Generate unique session ID
            const sessionId = `session-${Date.now()}-${appliedCount}`;
            appliedCount++;
            
            console.log(`Creating session ${sessionId} for ${day} at slot ${slotIndex}`);
            
            // Create cells array for this session
            const cells = [];
            for (let i = 0; i < schedule.sessionLength; i++) {
                const targetSlot = slotIndex + i;
                const cellId = `cell-${day}-${targetSlot}`;
                const cell = document.getElementById(cellId);
                console.log(`Looking for cell: ${cellId}`, cell ? 'FOUND' : 'NOT FOUND');
                if (cell) {
                    cells.push({ day, slot: targetSlot, element: cell });
                }
            }
            
            if (cells.length === 0) {
                console.error(`No cells found for ${day} starting at slot ${slotIndex}`);
                return;
            }
            
            console.log(`Found ${cells.length} cells for session`);
            
            // Apply the teaching session to all cells
            cells.forEach((cellInfo, index) => {
                const cell = cellInfo.element;
                const isFirstCell = index === 0;
                
                // Check the checkbox
                const checkbox = cell.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.checked = true;
                    console.log(`Checked checkbox for ${cellInfo.day}-${cellInfo.slot}`);
                }
                
                // Mark cell as filled
                cell.classList.add('filled-cell');
                cell.classList.add(`type-${schedule.type}`);
                cell.classList.add('merged-teaching');
                cell.dataset.sessionId = sessionId;
                
                // For continuation cells, add a special class
                if (!isFirstCell) {
                    cell.classList.add('merged-continuation-cell');
                }
                
                // Make cell position relative for absolute positioning of content
                cell.style.position = 'relative';
                
                // Clear existing content
                const cellContent = cell.querySelector('.cell-content');
                if (cellContent) {
                    cellContent.innerHTML = '';
                    cellContent.classList.add('teaching-mode');
                    
                    if (isFirstCell) {
                        // Calculate total height for merged cells
                        // Assuming each cell is approximately 50px tall (adjust if needed)
                        const cellHeight = 50; // Base cell height
                        const totalHeight = (cellHeight * cells.length) + ((cells.length - 1) * 2); // Include borders
                        
                        // First cell - show full information that will span all cells
                        cellContent.style.position = 'absolute';
                        cellContent.style.top = '0';
                        cellContent.style.left = '0';
                        cellContent.style.right = '0';
                        cellContent.style.height = `${totalHeight}px`;
                        cellContent.style.zIndex = '10';
                        
                        cellContent.innerHTML = `
                            <div class="merged-teaching-content" style="
                                padding: 0.75rem;
                                background: white;
                                border-radius: 6px;
                                height: 100%;
                                display: flex;
                                flex-direction: column;
                                justify-content: center;
                                position: relative;
                                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                                border: 2px solid rgba(52, 152, 219, 0.2);
                            ">
                                <button class="delete-session-btn" onclick="deleteTeachingSession('${sessionId}')" style="
                                    position: absolute;
                                    top: 4px;
                                    right: 4px;
                                    background: #e74c3c;
                                    color: white;
                                    border: none;
                                    border-radius: 4px;
                                    width: 24px;
                                    height: 24px;
                                    font-size: 14px;
                                    cursor: pointer;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    z-index: 10;
                                    transition: all 0.2s;
                                " onmouseover="this.style.background='#c0392b'" onmouseout="this.style.background='#e74c3c'">âœ•</button>
                                <div style="font-weight: bold; font-size: 1.1rem; color: #2c3e50; margin-bottom: 0.5rem; text-transform: uppercase;">
                                    ${currentCourseCode}${schedule.type === 'TRANSFER_KNOWLEDGE' ? ' â­' : ''}
                                </div>
                                <div style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 0.3rem; text-transform: uppercase;">
                                    ${schedule.type}${schedule.section ? ' - Section ' + schedule.section : ''}
                                </div>
                                <div style="font-size: 0.85rem; color: #95a5a6; margin-bottom: 0.3rem; text-transform: uppercase;">
                                    ðŸ“ ${schedule.location}
                                </div>
                                <div style="font-size: 0.8rem; color: #bdc3c7; margin-top: 0.3rem; padding: 0.3rem 0.5rem; background: rgba(52, 152, 219, 0.1); border-radius: 4px; display: inline-block; align-self: flex-start; text-transform: uppercase;">
                                    â±ï¸ ${schedule.sessionLength} hour${schedule.sessionLength > 1 ? 's' : ''} session
                                </div>
                            </div>
                        `;
                        console.log(`Created merged first cell content for ${currentCourseCode} spanning ${cells.length} cells`);
                    } else {
                        // Continuation cell - make it visually minimal and transparent
                        cellContent.style.opacity = '0.3';
                        cellContent.style.pointerEvents = 'none';
                        
                        cellContent.innerHTML = `
                            <div class="merged-continuation" style="
                                padding: 0.3rem;
                                background: transparent;
                                height: 100%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 0.75rem;
                                color: #bdc3c7;
                            ">
                                â†‘
                            </div>
                        `;
                    }
                }
            });
            
            // Store in mergedSessions if that structure exists
            if (typeof mergedSessions !== 'undefined') {
                mergedSessions[sessionId] = {
                    courseCode: currentCourseCode,
                    type: schedule.type,
                    section: schedule.section,
                    location: schedule.location,
                    cells: cells.map(c => ({ day: c.day, slot: c.slot }))
                };
                console.log(`Stored in mergedSessions:`, sessionId);
            }
            
            // Store in scheduleData if that structure exists
            if (typeof scheduleData !== 'undefined') {
                cells.forEach(cellInfo => {
                    if (!scheduleData[cellInfo.day]) {
                        scheduleData[cellInfo.day] = {};
                    }
                    scheduleData[cellInfo.day][cellInfo.slot] = {
                        type: 'TEACHING',
                        courseCode: currentCourseCode,
                        sessionId: sessionId
                    };
                });
                console.log(`Updated scheduleData structure`);
            }
        });
    });
    
    console.log(`Total sessions applied: ${appliedCount}`);
    
    // Update calculations if function exists
    if (typeof updateCalculations === 'function') {
        updateCalculations();
        console.log('Calculations updated');
    }
    
    // Apply cell merging after all schedules are applied
    if (typeof mergeCells === 'function') {
        mergeCells();
        console.log('Cell merging applied');
    }
    
    // Show success message
    setTimeout(() => {
        const totalSlots = scheduleData.reduce((sum, s) => sum + s.days.length * s.sessionLength, 0);
        const message = `âœ… Successfully applied ${scheduleData.length} schedule(s) across ${totalSlots} time slot(s)!\n\nCourse: ${currentCourseCode}\n${scheduleData.map((s, i) => `Section ${s.section}: ${s.days.join(', ')} at ${s.startTime} (${s.sessionLength}h)`).join('\n')}`;
        console.log('Success message:', message);
        alert(message);
    }, 300);
}

// Function to delete a teaching session (if it doesn't exist already)
if (typeof deleteTeachingSession === 'undefined') {
    function deleteTeachingSession(sessionId) {
        // Find all cells with this session ID
        const cells = document.querySelectorAll(`[data-session-id="${sessionId}"]`);
        
        cells.forEach(cell => {
            // Uncheck checkbox
            const checkbox = cell.querySelector('input[type="checkbox"]');
            if (checkbox) checkbox.checked = false;
            
            // Remove classes
            cell.classList.remove('filled-cell');
            cell.className = cell.className.replace(/type-\S+/g, '');
            delete cell.dataset.sessionId;
            
            // Clear content - no selector needed, checkbox remains
            const cellContent = cell.querySelector('.cell-content');
            if (cellContent) {
                cellContent.innerHTML = '';
                cellContent.classList.remove('teaching-mode');
            }
        });
        
        // Remove from mergedSessions
        if (typeof mergedSessions !== 'undefined' && mergedSessions[sessionId]) {
            delete mergedSessions[sessionId];
        }
        
        // Update calculations
        if (typeof updateCalculations === 'function') {
            updateCalculations();
        }
    }
    window.deleteTeachingSession = deleteTeachingSession;
}

// ========== CELL MERGING LOGIC ==========
function mergeCells() {
    console.log('Starting cell merge process...');
    
    // Process each day column separately for horizontal merging
    DAYS.forEach(day => {
        console.log(`Processing day: ${day}`);
        let currentMergeGroup = [];
        let lastCourseCode = null;
        let lastType = null;
        let lastSection = null;
        let lastLocation = null;
        
        // Go through each time slot for this day
        TIME_SLOTS.forEach((time, slotIndex) => {
            const cell = document.querySelector(`td.schedule-cell[data-day="${day}"][data-slot="${slotIndex}"]`);
            
            if (!cell) return;
            
            const isFilled = cell.classList.contains('filled-cell');
            const cellContent = cell.querySelector('.cell-content');
            
            if (isFilled && cellContent) {
                // Extract course info from the cell
                const courseCode = cellContent.dataset.courseCode;
                const type = cellContent.dataset.type;
                const section = cellContent.dataset.section;
                const location = cellContent.dataset.location;
                
                // Check if this cell matches the current merge group
                if (courseCode && 
                    courseCode === lastCourseCode && 
                    type === lastType && 
                    section === lastSection && 
                    location === lastLocation) {
                    // Add to current merge group
                    currentMergeGroup.push({ cell, slotIndex, time });
                } else {
                    // Process previous merge group if it exists
                    if (currentMergeGroup.length > 1) {
                        applyMerge(currentMergeGroup, day);
                    }
                    
                    // Start new merge group
                    currentMergeGroup = [{ cell, slotIndex, time }];
                    lastCourseCode = courseCode;
                    lastType = type;
                    lastSection = section;
                    lastLocation = location;
                }
            } else {
                // Non-filled cell, process any pending merge
                if (currentMergeGroup.length > 1) {
                    applyMerge(currentMergeGroup, day);
                }
                currentMergeGroup = [];
                lastCourseCode = null;
                lastType = null;
                lastSection = null;
                lastLocation = null;
            }
        });
        
        // Process final merge group if exists
        if (currentMergeGroup.length > 1) {
            applyMerge(currentMergeGroup, day);
        }
    });
}

function applyMerge(cellGroup, day) {
    if (cellGroup.length < 2) return;
    
    console.log(`Merging ${cellGroup.length} cells on ${day}`);
    
    const firstCell = cellGroup[0].cell;
    const firstContent = firstCell.querySelector('.cell-content');
    
    // Get course information
    const courseCode = firstContent.dataset.courseCode;
    const type = firstContent.dataset.type;
    const section = firstContent.dataset.section;
    const location = firstContent.dataset.location;
    const sessionId = firstCell.dataset.sessionId;
    
    // Calculate time range
    const startTime = cellGroup[0].time;
    const endSlot = cellGroup[cellGroup.length - 1].slotIndex + 1;
    const endTime = endSlot < TIME_SLOTS.length ? TIME_SLOTS[endSlot] : '18:00';
    
    // Mark first cell as merged
    firstCell.classList.add('merged-cell');
    
    // Create merged content for first cell
    firstContent.innerHTML = `
        <div class="merge-indicator">${cellGroup.length}h</div>
        <div class="merged-cell-content">
            <div class="merged-cell-header">${courseCode}</div>
            <div class="merged-cell-time">â° ${startTime} - ${endTime}</div>
            <div class="merged-cell-info">
                ${type} ${section ? `â€¢ Section ${section}` : ''}<br>
                ${location ? `ðŸ“ ${location}` : ''}
            </div>
            <div class="merged-cell-actions">
                <button class="merged-cell-btn merged-cell-edit" onclick="event.stopPropagation(); editMergedSession('${sessionId}')">
                    âœï¸ Edit
                </button>
                <button class="merged-cell-btn merged-cell-delete" onclick="event.stopPropagation(); deleteTeachingSession('${sessionId}')">
                    ðŸ—‘ï¸ Delete
                </button>
                <button class="merged-cell-btn merged-cell-unmerge" onclick="event.stopPropagation(); unmergeSession('${sessionId}')">
                    <span class="unmerge-tooltip">Split into individual cells</span>
                    âš¡ Unmerge
                </button>
            </div>
        </div>
    `;
    
    // Mark continuation cells
    for (let i = 1; i < cellGroup.length; i++) {
        const cell = cellGroup[i].cell;
        cell.classList.add('merged-continuation');
        const content = cell.querySelector('.cell-content');
        content.innerHTML = '';
        
        // Keep the cell clickable but show it's part of a merge
        cell.onclick = () => {
            firstCell.scrollIntoView({ behavior: 'smooth', block: 'center' });
            firstCell.style.animation = 'pulse 0.5s ease';
            setTimeout(() => { firstCell.style.animation = ''; }, 500);
        };
    }
    
    // Store merge information
    if (typeof mergedSessions === 'undefined') {
        window.mergedSessions = {};
    }
    mergedSessions[sessionId] = {
        cells: cellGroup,
        day: day,
        courseCode: courseCode,
        type: type,
        section: section,
        location: location
    };
}

function unmergeSession(sessionId) {
    if (!confirm('Are you sure you want to unmerge this session into individual cells?')) {
        return;
    }
    
    const mergeInfo = mergedSessions[sessionId];
    if (!mergeInfo) return;
    
    // Restore each cell to its individual state
    mergeInfo.cells.forEach(({ cell, time }) => {
        cell.classList.remove('merged-cell', 'merged-continuation');
        const content = cell.querySelector('.cell-content');
        
        // Restore original content
        content.innerHTML = `
            <strong>${mergeInfo.courseCode}</strong><br>
            ${mergeInfo.type}${mergeInfo.section ? ` - ${mergeInfo.section}` : ''}<br>
            ${mergeInfo.location ? `ðŸ“ ${mergeInfo.location}` : ''}
            <button class="delete-session" onclick="event.stopPropagation(); deleteTeachingSession('${sessionId}')">Ã—</button>
        `;
        
        cell.onclick = () => openActivityModal(mergeInfo.day, cell.dataset.slot);
    });
    
    // Remove from merged sessions
    delete mergedSessions[sessionId];
    
    updateCalculations();
}

// ========== UNIVERSAL SCHEDULING MODE ==========
// Uses the teaching modal repeatedly until user cancels

let universalSchedulingMode = {
    active: false,
    courseCode: '',
    courseName: '',
    sessionCount: 0,
    lastScheduledDay: null,
    lastScheduledSlot: null
};

function startUniversalScheduling(courseCode, courseName) {
    universalSchedulingMode = {
        active: true,
        courseCode: courseCode,
        courseName: courseName,
        sessionCount: 0,
        lastScheduledDay: null,
        lastScheduledSlot: null
    };
    
    // Show instruction notification
    const notification = document.createElement('div');
    notification.id = 'universalSchedulingNotification';
    const themeAccent = getThemeAccent();
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, ${themeAccent} 0%, #1ab866 100%);
        color: white;
        padding: 20px 25px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(32, 206, 118, 0.4);
        z-index: 9999;
        max-width: 400px;
        animation: slideInRight 0.5s ease;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 15px;">
            <div style="font-size: 2rem;">ðŸ“…</div>
            <div>
                <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">
                    Universal Scheduling Mode Active
                </div>
                <div style="font-size: 0.9rem; line-height: 1.5; margin-bottom: 10px;">
                    Scheduling: <strong>${courseCode}</strong><br/>
                    Sessions added: <strong><span id="sessionCountDisplay">0</span></strong>
                </div>
                <div style="font-size: 0.85rem; opacity: 0.9; line-height: 1.4;">
                    â„¹ï¸ The Teaching Modal will reopen after each session.<br/>
                    Click <strong>Cancel</strong> in the modal when done.
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Open the first teaching modal - let user choose any available cell
    // We'll use a "dummy" initial call - user will select the actual cell
    openUniversalTeachingModal();
}

function openUniversalTeachingModal() {
    // In universal mode, we don't need to pre-select a cell
    // The user will select cells via checkboxes after filling the modal
    // We'll use a placeholder cell just to open the modal, then let checkboxes handle selection
    
    // Use SUNDAY slot 0 as a placeholder (the actual cell will be selected via checkboxes)
    const placeholderDay = 'SUNDAY';
    const placeholderSlot = 0;
    
    // Open teaching modal with course code pre-filled
    openTeachingModal(placeholderDay, placeholderSlot, {
        courseCode: universalSchedulingMode.courseCode
    });
}

function endUniversalScheduling() {
    if (!universalSchedulingMode.active) return;
    
    const sessionCount = universalSchedulingMode.sessionCount;
    universalSchedulingMode.active = false;
    
    // Remove notification
    const notification = document.getElementById('universalSchedulingNotification');
    if (notification) {
        notification.style.animation = 'slideOutRight 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }
    
    // Show completion message
    if (sessionCount > 0) {
        setTimeout(() => {
            alert(`âœ… Universal Scheduling Complete!\n\n${sessionCount} session(s) added for ${universalSchedulingMode.courseCode}`);
        }, 600);
    }
}

function updateUniversalSchedulingCount() {
    const countDisplay = document.getElementById('sessionCountDisplay');
    if (countDisplay) {
        countDisplay.textContent = universalSchedulingMode.sessionCount;
    }
}

// Override the close teaching modal to check for universal mode
const originalCloseTeachingModal = window.closeTeachingModal || function() {
    document.getElementById('teachingModal').classList.remove('active');
};

window.closeTeachingModal = function() {
    if (universalSchedulingMode.active) {
        // User clicked Cancel - end universal scheduling
        endUniversalScheduling();
    }
    originalCloseTeachingModal();
};

// Initialize with one schedule section when popup opens
document.addEventListener('DOMContentLoaded', function() {
    // Add CSS for the schedule sections
    const style = document.createElement('style');
    style.textContent = `
        .schedule-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15) !important;
        }
    `;
    document.head.appendChild(style);
    
    // Auto-fill Faculty Acknowledgment name from Faculty Name selector
    const facultyNameInput = document.getElementById('facultyName');
    const instructorAckNameInput = document.getElementById('instructorAckName');
    
    if (facultyNameInput && instructorAckNameInput) {
        // Convert to uppercase and sync with acknowledgment as user types
        facultyNameInput.addEventListener('input', function() {
            const cursorPos = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPos, cursorPos);
            // Sync with acknowledgment name
            instructorAckNameInput.value = this.value;
        });
    }
});

// Function to attach faculty name uppercase and sync handler (can be called after recreating the field)
function attachFacultyOtherHandler() {
    const facultyNameInput = document.getElementById('facultyName');
    const instructorAckNameInput = document.getElementById('instructorAckName');
    
    if (!facultyNameInput) return;
    
    // Convert to uppercase and sync with acknowledgment as user types
    facultyNameInput.addEventListener('input', function() {
        const cursorPos = this.selectionStart;
        this.value = this.value.toUpperCase();
        this.setSelectionRange(cursorPos, cursorPos);
        // Sync with acknowledgment name if it exists
        if (instructorAckNameInput) {
            instructorAckNameInput.value = this.value;
        }
    });
}

// Call it initially on page load
attachFacultyOtherHandler();

</script>


</body>
</html>